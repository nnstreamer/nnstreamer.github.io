<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - ML API 1.8.6-0 gichan-jang/api#0524d46ca741983e1ec4a9cf7e4975bcc7dc6238 - capi-machine-learning-inference-1.8.6/c/src/ml-api-inference-single.c</title>
  <link rel="stylesheet" type="text/css" href="../../../gcov.css">
</head>

<body>

          <table width="100%" border=0 cellspacing=0 cellpadding=0>
            <tr><td class="title">LCOV - code coverage report</td></tr>
            <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>

            <tr>
              <td width="100%">
                <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="10%" class="headerValue"><a href="../../../index.html">top level</a> - <a href="index.html">capi-machine-learning-inference-1.8.6/c/src</a> - ml-api-inference-single.c<span style="font-size: 80%;"> (source / <a href="ml-api-inference-single.c.func-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="5%"></td>
            <td width="5%" class="headerCovTableHead">Coverage</td>
            <td width="5%" class="headerCovTableHead" title="Covered + Uncovered code">Total</td>
            <td width="5%" class="headerCovTableHead" title="Exercised code only">Hit</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">ML API 1.8.6-0 gichan-jang/api#0524d46ca741983e1ec4a9cf7e4975bcc7dc6238</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntryMed">76.0&nbsp;%</td>
            <td class="headerCovTableEntry">855</td>
            <td class="headerCovTableEntry">650</td>
          </tr>
          <tr>
            <td class="headerItem">Test Date:</td>
            <td class="headerValue">2024-11-15 05:34:45</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntryHi">94.9&nbsp;%</td>
            <td class="headerCovTableEntry">39</td>
            <td class="headerCovTableEntry">37</td>
          </tr>
                  <tr><td><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
                </table>
              </td>
            </tr>

            <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
          </table>

          <table cellpadding=0 cellspacing=0 border=0>
            <tr>
              <td><br></td>
            </tr>
            <tr>
              <td>
<pre class="sourceHeading">            Line data    Source code</pre>
<pre class="source">
<span id="L1"><span class="lineNum">       1</span>              : /* SPDX-License-Identifier: Apache-2.0 */</span>
<span id="L2"><span class="lineNum">       2</span>              : /**</span>
<span id="L3"><span class="lineNum">       3</span>              :  * Copyright (c) 2019 Samsung Electronics Co., Ltd. All Rights Reserved.</span>
<span id="L4"><span class="lineNum">       4</span>              :  *</span>
<span id="L5"><span class="lineNum">       5</span>              :  * @file ml-api-inference-single.c</span>
<span id="L6"><span class="lineNum">       6</span>              :  * @date 29 Aug 2019</span>
<span id="L7"><span class="lineNum">       7</span>              :  * @brief NNStreamer/Single C-API Wrapper.</span>
<span id="L8"><span class="lineNum">       8</span>              :  *        This allows to invoke individual input frame with NNStreamer.</span>
<span id="L9"><span class="lineNum">       9</span>              :  * @see https://github.com/nnstreamer/nnstreamer</span>
<span id="L10"><span class="lineNum">      10</span>              :  * @author MyungJoo Ham &lt;myungjoo.ham@samsung.com&gt;</span>
<span id="L11"><span class="lineNum">      11</span>              :  * @author Parichay Kapoor &lt;pk.kapoor@samsung.com&gt;</span>
<span id="L12"><span class="lineNum">      12</span>              :  * @bug No known bugs except for NYI items</span>
<span id="L13"><span class="lineNum">      13</span>              :  */</span>
<span id="L14"><span class="lineNum">      14</span>              : </span>
<span id="L15"><span class="lineNum">      15</span>              : #include &lt;string.h&gt;</span>
<span id="L16"><span class="lineNum">      16</span>              : #include &lt;nnstreamer-single.h&gt;</span>
<span id="L17"><span class="lineNum">      17</span>              : #include &lt;nnstreamer-tizen-internal.h&gt;  /* Tizen platform header */</span>
<span id="L18"><span class="lineNum">      18</span>              : #include &lt;nnstreamer_internal.h&gt;</span>
<span id="L19"><span class="lineNum">      19</span>              : #include &lt;nnstreamer_plugin_api_util.h&gt;</span>
<span id="L20"><span class="lineNum">      20</span>              : #include &lt;tensor_filter_single.h&gt;</span>
<span id="L21"><span class="lineNum">      21</span>              : </span>
<span id="L22"><span class="lineNum">      22</span>              : #include &quot;ml-api-inference-internal.h&quot;</span>
<span id="L23"><span class="lineNum">      23</span>              : #include &quot;ml-api-internal.h&quot;</span>
<span id="L24"><span class="lineNum">      24</span>              : #include &quot;ml-api-inference-single-internal.h&quot;</span>
<span id="L25"><span class="lineNum">      25</span>              : </span>
<span id="L26"><span class="lineNum">      26</span>              : #define ML_SINGLE_MAGIC 0xfeedfeed</span>
<span id="L27"><span class="lineNum">      27</span>              : </span>
<span id="L28"><span class="lineNum">      28</span>              : /**</span>
<span id="L29"><span class="lineNum">      29</span>              :  * @brief Default time to wait for an output in milliseconds (0 will wait for the output).</span>
<span id="L30"><span class="lineNum">      30</span>              :  */</span>
<span id="L31"><span class="lineNum">      31</span>              : #define SINGLE_DEFAULT_TIMEOUT 0</span>
<span id="L32"><span class="lineNum">      32</span>              : </span>
<span id="L33"><span class="lineNum">      33</span>              : /**</span>
<span id="L34"><span class="lineNum">      34</span>              :  * @brief Global lock for single shot API</span>
<span id="L35"><span class="lineNum">      35</span>              :  * @detail This lock ensures that ml_single_close is thread safe. All other API</span>
<span id="L36"><span class="lineNum">      36</span>              :  *         functions use the mutex from the single handle. However for close,</span>
<span id="L37"><span class="lineNum">      37</span>              :  *         single handle mutex cannot be used as single handle is destroyed at</span>
<span id="L38"><span class="lineNum">      38</span>              :  *         close</span>
<span id="L39"><span class="lineNum">      39</span>              :  * @note This mutex is automatically initialized as it is statically declared</span>
<span id="L40"><span class="lineNum">      40</span>              :  */</span>
<span id="L41"><span class="lineNum">      41</span>              : G_LOCK_DEFINE_STATIC (magic);</span>
<span id="L42"><span class="lineNum">      42</span>              : </span>
<span id="L43"><span class="lineNum">      43</span>              : /**</span>
<span id="L44"><span class="lineNum">      44</span>              :  * @brief Get valid handle after magic verification</span>
<span id="L45"><span class="lineNum">      45</span>              :  * @note handle's mutex (single_h-&gt;mutex) is acquired after this</span>
<span id="L46"><span class="lineNum">      46</span>              :  * @param[out] single_h The handle properly casted: (ml_single *).</span>
<span id="L47"><span class="lineNum">      47</span>              :  * @param[in] single The handle to be validated: (void *).</span>
<span id="L48"><span class="lineNum">      48</span>              :  * @param[in] reset Set TRUE if the handle is to be reset (magic = 0).</span>
<span id="L49"><span class="lineNum">      49</span>              :  */</span>
<span id="L50"><span class="lineNum">      50</span>              : #define ML_SINGLE_GET_VALID_HANDLE_LOCKED(single_h, single, reset) do { \</span>
<span id="L51"><span class="lineNum">      51</span>              :   G_LOCK (magic); \</span>
<span id="L52"><span class="lineNum">      52</span>              :   single_h = (ml_single *) single; \</span>
<span id="L53"><span class="lineNum">      53</span>              :   if (G_UNLIKELY(single_h-&gt;magic != ML_SINGLE_MAGIC)) { \</span>
<span id="L54"><span class="lineNum">      54</span>              :     _ml_error_report \</span>
<span id="L55"><span class="lineNum">      55</span>              :         (&quot;The given param, %s (ml_single_h), is invalid. It is not a single_h instance or the user thread has modified it.&quot;, \</span>
<span id="L56"><span class="lineNum">      56</span>              :         #single); \</span>
<span id="L57"><span class="lineNum">      57</span>              :     G_UNLOCK (magic); \</span>
<span id="L58"><span class="lineNum">      58</span>              :     return ML_ERROR_INVALID_PARAMETER; \</span>
<span id="L59"><span class="lineNum">      59</span>              :   } \</span>
<span id="L60"><span class="lineNum">      60</span>              :   if (G_UNLIKELY(reset)) \</span>
<span id="L61"><span class="lineNum">      61</span>              :     single_h-&gt;magic = 0; \</span>
<span id="L62"><span class="lineNum">      62</span>              :   g_mutex_lock (&amp;single_h-&gt;mutex); \</span>
<span id="L63"><span class="lineNum">      63</span>              :   G_UNLOCK (magic); \</span>
<span id="L64"><span class="lineNum">      64</span>              : } while (0)</span>
<span id="L65"><span class="lineNum">      65</span>              : </span>
<span id="L66"><span class="lineNum">      66</span>              : /**</span>
<span id="L67"><span class="lineNum">      67</span>              :  * @brief This is for the symmetricity with ML_SINGLE_GET_VALID_HANDLE_LOCKED</span>
<span id="L68"><span class="lineNum">      68</span>              :  * @param[in] single_h The casted handle (ml_single *).</span>
<span id="L69"><span class="lineNum">      69</span>              :  */</span>
<span id="L70"><span class="lineNum">      70</span>              : #define ML_SINGLE_HANDLE_UNLOCK(single_h) g_mutex_unlock (&amp;single_h-&gt;mutex);</span>
<span id="L71"><span class="lineNum">      71</span>              : </span>
<span id="L72"><span class="lineNum">      72</span>              : /** define string names for input/output */</span>
<span id="L73"><span class="lineNum">      73</span>              : #define INPUT_STR &quot;input&quot;</span>
<span id="L74"><span class="lineNum">      74</span>              : #define OUTPUT_STR &quot;output&quot;</span>
<span id="L75"><span class="lineNum">      75</span>              : #define TYPE_STR &quot;type&quot;</span>
<span id="L76"><span class="lineNum">      76</span>              : #define NAME_STR &quot;name&quot;</span>
<span id="L77"><span class="lineNum">      77</span>              : </span>
<span id="L78"><span class="lineNum">      78</span>              : /** concat string from #define */</span>
<span id="L79"><span class="lineNum">      79</span>              : #define CONCAT_MACRO_STR(STR1,STR2) STR1 STR2</span>
<span id="L80"><span class="lineNum">      80</span>              : </span>
<span id="L81"><span class="lineNum">      81</span>              : /** States for invoke thread */</span>
<span id="L82"><span class="lineNum">      82</span>              : typedef enum</span>
<span id="L83"><span class="lineNum">      83</span>              : {</span>
<span id="L84"><span class="lineNum">      84</span>              :   IDLE = 0,           /**&lt; ready to accept next input */</span>
<span id="L85"><span class="lineNum">      85</span>              :   RUNNING,            /**&lt; running an input, cannot accept more input */</span>
<span id="L86"><span class="lineNum">      86</span>              :   JOIN_REQUESTED      /**&lt; should join the thread, will exit soon */</span>
<span id="L87"><span class="lineNum">      87</span>              : } thread_state;</span>
<span id="L88"><span class="lineNum">      88</span>              : </span>
<span id="L89"><span class="lineNum">      89</span>              : /**</span>
<span id="L90"><span class="lineNum">      90</span>              :  * @brief The name of sub-plugin for defined neural net frameworks.</span>
<span id="L91"><span class="lineNum">      91</span>              :  * @note The sub-plugin for Android is not declared (e.g., snap)</span>
<span id="L92"><span class="lineNum">      92</span>              :  */</span>
<span id="L93"><span class="lineNum">      93</span>              : static const char *ml_nnfw_subplugin_name[] = {</span>
<span id="L94"><span class="lineNum">      94</span>              :   [ML_NNFW_TYPE_ANY] = &quot;any&quot;,   /* DO NOT use this name ('any') to get the sub-plugin */</span>
<span id="L95"><span class="lineNum">      95</span>              :   [ML_NNFW_TYPE_CUSTOM_FILTER] = &quot;custom&quot;,</span>
<span id="L96"><span class="lineNum">      96</span>              :   [ML_NNFW_TYPE_TENSORFLOW_LITE] = &quot;tensorflow-lite&quot;,</span>
<span id="L97"><span class="lineNum">      97</span>              :   [ML_NNFW_TYPE_TENSORFLOW] = &quot;tensorflow&quot;,</span>
<span id="L98"><span class="lineNum">      98</span>              :   [ML_NNFW_TYPE_NNFW] = &quot;nnfw&quot;,</span>
<span id="L99"><span class="lineNum">      99</span>              :   [ML_NNFW_TYPE_MVNC] = &quot;movidius-ncsdk2&quot;,</span>
<span id="L100"><span class="lineNum">     100</span>              :   [ML_NNFW_TYPE_OPENVINO] = &quot;openvino&quot;,</span>
<span id="L101"><span class="lineNum">     101</span>              :   [ML_NNFW_TYPE_VIVANTE] = &quot;vivante&quot;,</span>
<span id="L102"><span class="lineNum">     102</span>              :   [ML_NNFW_TYPE_EDGE_TPU] = &quot;edgetpu&quot;,</span>
<span id="L103"><span class="lineNum">     103</span>              :   [ML_NNFW_TYPE_ARMNN] = &quot;armnn&quot;,</span>
<span id="L104"><span class="lineNum">     104</span>              :   [ML_NNFW_TYPE_SNPE] = &quot;snpe&quot;,</span>
<span id="L105"><span class="lineNum">     105</span>              :   [ML_NNFW_TYPE_PYTORCH] = &quot;pytorch&quot;,</span>
<span id="L106"><span class="lineNum">     106</span>              :   [ML_NNFW_TYPE_NNTR_INF] = &quot;nntrainer&quot;,</span>
<span id="L107"><span class="lineNum">     107</span>              :   [ML_NNFW_TYPE_VD_AIFW] = &quot;vd_aifw&quot;,</span>
<span id="L108"><span class="lineNum">     108</span>              :   [ML_NNFW_TYPE_TRIX_ENGINE] = &quot;trix-engine&quot;,</span>
<span id="L109"><span class="lineNum">     109</span>              :   [ML_NNFW_TYPE_MXNET] = &quot;mxnet&quot;,</span>
<span id="L110"><span class="lineNum">     110</span>              :   [ML_NNFW_TYPE_TVM] = &quot;tvm&quot;,</span>
<span id="L111"><span class="lineNum">     111</span>              :   [ML_NNFW_TYPE_ONNX_RUNTIME] = &quot;onnxruntime&quot;,</span>
<span id="L112"><span class="lineNum">     112</span>              :   [ML_NNFW_TYPE_NCNN] = &quot;ncnn&quot;,</span>
<span id="L113"><span class="lineNum">     113</span>              :   [ML_NNFW_TYPE_TENSORRT] = &quot;tensorrt&quot;,</span>
<span id="L114"><span class="lineNum">     114</span>              :   [ML_NNFW_TYPE_QNN] = &quot;qnn&quot;,</span>
<span id="L115"><span class="lineNum">     115</span>              :   NULL</span>
<span id="L116"><span class="lineNum">     116</span>              : };</span>
<span id="L117"><span class="lineNum">     117</span>              : </span>
<span id="L118"><span class="lineNum">     118</span>              : /** ML single api data structure for handle */</span>
<span id="L119"><span class="lineNum">     119</span>              : typedef struct</span>
<span id="L120"><span class="lineNum">     120</span>              : {</span>
<span id="L121"><span class="lineNum">     121</span>              :   GTensorFilterSingleClass *klass;    /**&lt; tensor filter class structure*/</span>
<span id="L122"><span class="lineNum">     122</span>              :   GTensorFilterSingle *filter;        /**&lt; tensor filter element */</span>
<span id="L123"><span class="lineNum">     123</span>              :   GstTensorsInfo in_info;             /**&lt; info about input */</span>
<span id="L124"><span class="lineNum">     124</span>              :   GstTensorsInfo out_info;            /**&lt; info about output */</span>
<span id="L125"><span class="lineNum">     125</span>              :   ml_nnfw_type_e nnfw;                /**&lt; nnfw type for this filter */</span>
<span id="L126"><span class="lineNum">     126</span>              :   guint magic;                        /**&lt; code to verify valid handle */</span>
<span id="L127"><span class="lineNum">     127</span>              : </span>
<span id="L128"><span class="lineNum">     128</span>              :   GThread *thread;                    /**&lt; thread for invoking */</span>
<span id="L129"><span class="lineNum">     129</span>              :   GMutex mutex;                       /**&lt; mutex for synchronization */</span>
<span id="L130"><span class="lineNum">     130</span>              :   GCond cond;                         /**&lt; condition for synchronization */</span>
<span id="L131"><span class="lineNum">     131</span>              :   ml_tensors_data_h input;            /**&lt; input received from user */</span>
<span id="L132"><span class="lineNum">     132</span>              :   ml_tensors_data_h output;           /**&lt; output to be sent back to user */</span>
<span id="L133"><span class="lineNum">     133</span>              :   guint timeout;                      /**&lt; timeout for invoking */</span>
<span id="L134"><span class="lineNum">     134</span>              :   thread_state state;                 /**&lt; current state of the thread */</span>
<span id="L135"><span class="lineNum">     135</span>              :   gboolean free_output;               /**&lt; true if output tensors are allocated in single-shot */</span>
<span id="L136"><span class="lineNum">     136</span>              :   int status;                         /**&lt; status of processing */</span>
<span id="L137"><span class="lineNum">     137</span>              :   gboolean invoking;                  /**&lt; invoke running flag */</span>
<span id="L138"><span class="lineNum">     138</span>              :   ml_tensors_data_h in_tensors;       /**&lt; input tensor wrapper for processing */</span>
<span id="L139"><span class="lineNum">     139</span>              :   ml_tensors_data_h out_tensors;      /**&lt; output tensor wrapper for processing */</span>
<span id="L140"><span class="lineNum">     140</span>              : </span>
<span id="L141"><span class="lineNum">     141</span>              :   GList *destroy_data_list;         /**&lt; data to be freed by filter */</span>
<span id="L142"><span class="lineNum">     142</span>              : } ml_single;</span>
<span id="L143"><span class="lineNum">     143</span>              : </span>
<span id="L144"><span class="lineNum">     144</span>              : /**</span>
<span id="L145"><span class="lineNum">     145</span>              :  * @brief Internal function to get the nnfw type.</span>
<span id="L146"><span class="lineNum">     146</span>              :  */</span>
<span id="L147"><span class="lineNum">     147</span>              : ml_nnfw_type_e</span>
<span id="L148"><span class="lineNum">     148</span> <span class="tlaGNC tlaBgGNC">          96 : _ml_get_nnfw_type_by_subplugin_name (const char *name)</span></span>
<span id="L149"><span class="lineNum">     149</span>              : {</span>
<span id="L150"><span class="lineNum">     150</span> <span class="tlaGNC">          96 :   ml_nnfw_type_e nnfw_type = ML_NNFW_TYPE_ANY;</span></span>
<span id="L151"><span class="lineNum">     151</span> <span class="tlaGNC">          96 :   int idx = -1;</span></span>
<span id="L152"><span class="lineNum">     152</span>              : </span>
<span id="L153"><span class="lineNum">     153</span> <span class="tlaGNC">          96 :   if (name == NULL)</span></span>
<span id="L154"><span class="lineNum">     154</span> <span class="tlaGNC">           2 :     return ML_NNFW_TYPE_ANY;</span></span>
<span id="L155"><span class="lineNum">     155</span>              : </span>
<span id="L156"><span class="lineNum">     156</span> <span class="tlaGNC">          94 :   idx = find_key_strv (ml_nnfw_subplugin_name, name);</span></span>
<span id="L157"><span class="lineNum">     157</span> <span class="tlaGNC">          94 :   if (idx &lt; 0) {</span></span>
<span id="L158"><span class="lineNum">     158</span>              :     /* check sub-plugin for android */</span>
<span id="L159"><span class="lineNum">     159</span> <span class="tlaGNC">           2 :     if (g_ascii_strcasecmp (name, &quot;snap&quot;) == 0)</span></span>
<span id="L160"><span class="lineNum">     160</span> <span class="tlaGNC">           1 :       nnfw_type = ML_NNFW_TYPE_SNAP;</span></span>
<span id="L161"><span class="lineNum">     161</span>              :     else</span>
<span id="L162"><span class="lineNum">     162</span> <span class="tlaGNC">           1 :       _ml_error_report (&quot;Cannot find nnfw, %s is an invalid name.&quot;,</span></span>
<span id="L163"><span class="lineNum">     163</span>              :           _STR_NULL (name));</span>
<span id="L164"><span class="lineNum">     164</span>              :   } else {</span>
<span id="L165"><span class="lineNum">     165</span> <span class="tlaGNC">          92 :     nnfw_type = (ml_nnfw_type_e) idx;</span></span>
<span id="L166"><span class="lineNum">     166</span>              :   }</span>
<span id="L167"><span class="lineNum">     167</span>              : </span>
<span id="L168"><span class="lineNum">     168</span> <span class="tlaGNC">          94 :   return nnfw_type;</span></span>
<span id="L169"><span class="lineNum">     169</span>              : }</span>
<span id="L170"><span class="lineNum">     170</span>              : </span>
<span id="L171"><span class="lineNum">     171</span>              : /**</span>
<span id="L172"><span class="lineNum">     172</span>              :  * @brief Internal function to get the sub-plugin name.</span>
<span id="L173"><span class="lineNum">     173</span>              :  */</span>
<span id="L174"><span class="lineNum">     174</span>              : const char *</span>
<span id="L175"><span class="lineNum">     175</span> <span class="tlaGNC">         370 : _ml_get_nnfw_subplugin_name (ml_nnfw_type_e nnfw)</span></span>
<span id="L176"><span class="lineNum">     176</span>              : {</span>
<span id="L177"><span class="lineNum">     177</span>              :   /* check sub-plugin for android */</span>
<span id="L178"><span class="lineNum">     178</span> <span class="tlaGNC">         370 :   if (nnfw == ML_NNFW_TYPE_SNAP)</span></span>
<span id="L179"><span class="lineNum">     179</span> <span class="tlaGNC">           1 :     return &quot;snap&quot;;</span></span>
<span id="L180"><span class="lineNum">     180</span>              : </span>
<span id="L181"><span class="lineNum">     181</span> <span class="tlaGNC">         369 :   return ml_nnfw_subplugin_name[nnfw];</span></span>
<span id="L182"><span class="lineNum">     182</span>              : }</span>
<span id="L183"><span class="lineNum">     183</span>              : </span>
<span id="L184"><span class="lineNum">     184</span>              : /**</span>
<span id="L185"><span class="lineNum">     185</span>              :  * @brief Convert c-api based hw to internal representation</span>
<span id="L186"><span class="lineNum">     186</span>              :  */</span>
<span id="L187"><span class="lineNum">     187</span>              : accl_hw</span>
<span id="L188"><span class="lineNum">     188</span> <span class="tlaGNC">         271 : _ml_nnfw_to_accl_hw (const ml_nnfw_hw_e hw)</span></span>
<span id="L189"><span class="lineNum">     189</span>              : {</span>
<span id="L190"><span class="lineNum">     190</span> <span class="tlaGNC">         271 :   switch (hw) {</span></span>
<span id="L191"><span class="lineNum">     191</span> <span class="tlaGNC">         249 :     case ML_NNFW_HW_ANY:</span></span>
<span id="L192"><span class="lineNum">     192</span> <span class="tlaGNC">         249 :       return ACCL_DEFAULT;</span></span>
<span id="L193"><span class="lineNum">     193</span> <span class="tlaGNC">           3 :     case ML_NNFW_HW_AUTO:</span></span>
<span id="L194"><span class="lineNum">     194</span> <span class="tlaGNC">           3 :       return ACCL_AUTO;</span></span>
<span id="L195"><span class="lineNum">     195</span> <span class="tlaGNC">           5 :     case ML_NNFW_HW_CPU:</span></span>
<span id="L196"><span class="lineNum">     196</span> <span class="tlaGNC">           5 :       return ACCL_CPU;</span></span>
<span id="L197"><span class="lineNum">     197</span>              : #if defined (__aarch64__) || defined (__arm__)</span>
<span id="L198"><span class="lineNum">     198</span>              :     case ML_NNFW_HW_CPU_NEON:</span>
<span id="L199"><span class="lineNum">     199</span>              :       return ACCL_CPU_NEON;</span>
<span id="L200"><span class="lineNum">     200</span>              : #else</span>
<span id="L201"><span class="lineNum">     201</span> <span class="tlaGNC">           2 :     case ML_NNFW_HW_CPU_SIMD:</span></span>
<span id="L202"><span class="lineNum">     202</span> <span class="tlaGNC">           2 :       return ACCL_CPU_SIMD;</span></span>
<span id="L203"><span class="lineNum">     203</span>              : #endif</span>
<span id="L204"><span class="lineNum">     204</span> <span class="tlaGNC">           3 :     case ML_NNFW_HW_GPU:</span></span>
<span id="L205"><span class="lineNum">     205</span> <span class="tlaGNC">           3 :       return ACCL_GPU;</span></span>
<span id="L206"><span class="lineNum">     206</span> <span class="tlaGNC">           2 :     case ML_NNFW_HW_NPU:</span></span>
<span id="L207"><span class="lineNum">     207</span> <span class="tlaGNC">           2 :       return ACCL_NPU;</span></span>
<span id="L208"><span class="lineNum">     208</span> <span class="tlaGNC">           2 :     case ML_NNFW_HW_NPU_MOVIDIUS:</span></span>
<span id="L209"><span class="lineNum">     209</span> <span class="tlaGNC">           2 :       return ACCL_NPU_MOVIDIUS;</span></span>
<span id="L210"><span class="lineNum">     210</span> <span class="tlaGNC">           1 :     case ML_NNFW_HW_NPU_EDGE_TPU:</span></span>
<span id="L211"><span class="lineNum">     211</span> <span class="tlaGNC">           1 :       return ACCL_NPU_EDGE_TPU;</span></span>
<span id="L212"><span class="lineNum">     212</span> <span class="tlaGNC">           1 :     case ML_NNFW_HW_NPU_VIVANTE:</span></span>
<span id="L213"><span class="lineNum">     213</span> <span class="tlaGNC">           1 :       return ACCL_NPU_VIVANTE;</span></span>
<span id="L214"><span class="lineNum">     214</span> <span class="tlaGNC">           1 :     case ML_NNFW_HW_NPU_SLSI:</span></span>
<span id="L215"><span class="lineNum">     215</span> <span class="tlaGNC">           1 :       return ACCL_NPU_SLSI;</span></span>
<span id="L216"><span class="lineNum">     216</span> <span class="tlaGNC">           2 :     case ML_NNFW_HW_NPU_SR:</span></span>
<span id="L217"><span class="lineNum">     217</span>              :       /** @todo how to get srcn npu */</span>
<span id="L218"><span class="lineNum">     218</span> <span class="tlaGNC">           2 :       return ACCL_NPU_SR;</span></span>
<span id="L219"><span class="lineNum">     219</span> <span class="tlaUNC tlaBgUNC">           0 :     default:</span></span>
<span id="L220"><span class="lineNum">     220</span> <span class="tlaUNC">           0 :       return ACCL_AUTO;</span></span>
<span id="L221"><span class="lineNum">     221</span>              :   }</span>
<span id="L222"><span class="lineNum">     222</span>              : }</span>
<span id="L223"><span class="lineNum">     223</span>              : </span>
<span id="L224"><span class="lineNum">     224</span>              : /**</span>
<span id="L225"><span class="lineNum">     225</span>              :  * @brief Checks the availability of the given execution environments with custom option.</span>
<span id="L226"><span class="lineNum">     226</span>              :  */</span>
<span id="L227"><span class="lineNum">     227</span>              : int</span>
<span id="L228"><span class="lineNum">     228</span> <span class="tlaGNC tlaBgGNC">         193 : ml_check_nnfw_availability_full (ml_nnfw_type_e nnfw, ml_nnfw_hw_e hw,</span></span>
<span id="L229"><span class="lineNum">     229</span>              :     const char *custom, bool *available)</span>
<span id="L230"><span class="lineNum">     230</span>              : {</span>
<span id="L231"><span class="lineNum">     231</span> <span class="tlaGNC">         193 :   const char *fw_name = NULL;</span></span>
<span id="L232"><span class="lineNum">     232</span>              : </span>
<span id="L233"><span class="lineNum">     233</span> <span class="tlaGNC">         193 :   check_feature_state (ML_FEATURE_INFERENCE);</span></span>
<span id="L234"><span class="lineNum">     234</span>              : </span>
<span id="L235"><span class="lineNum">     235</span> <span class="tlaGNC">         193 :   if (!available)</span></span>
<span id="L236"><span class="lineNum">     236</span> <span class="tlaGNC">           2 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L237"><span class="lineNum">     237</span>              :         &quot;The parameter, available (bool *), is NULL. It should be a valid pointer of bool. E.g., bool a; ml_check_nnfw_availability_full (..., &amp;a);&quot;);</span>
<span id="L238"><span class="lineNum">     238</span>              : </span>
<span id="L239"><span class="lineNum">     239</span>              :   /* init false */</span>
<span id="L240"><span class="lineNum">     240</span> <span class="tlaGNC">         191 :   *available = false;</span></span>
<span id="L241"><span class="lineNum">     241</span>              : </span>
<span id="L242"><span class="lineNum">     242</span> <span class="tlaGNC">         191 :   if (nnfw == ML_NNFW_TYPE_ANY)</span></span>
<span id="L243"><span class="lineNum">     243</span> <span class="tlaGNC">           1 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L244"><span class="lineNum">     244</span>              :         &quot;The parameter, nnfw (ml_nnfw_type_e), is ML_NNFW_TYPE_ANY. It should specify the framework to be probed for the hardware availability.&quot;);</span>
<span id="L245"><span class="lineNum">     245</span>              : </span>
<span id="L246"><span class="lineNum">     246</span> <span class="tlaGNC">         190 :   fw_name = _ml_get_nnfw_subplugin_name (nnfw);</span></span>
<span id="L247"><span class="lineNum">     247</span>              : </span>
<span id="L248"><span class="lineNum">     248</span> <span class="tlaGNC">         190 :   if (fw_name) {</span></span>
<span id="L249"><span class="lineNum">     249</span> <span class="tlaGNC">         190 :     if (nnstreamer_filter_find (fw_name) != NULL) {</span></span>
<span id="L250"><span class="lineNum">     250</span> <span class="tlaGNC">         189 :       accl_hw accl = _ml_nnfw_to_accl_hw (hw);</span></span>
<span id="L251"><span class="lineNum">     251</span>              : </span>
<span id="L252"><span class="lineNum">     252</span> <span class="tlaGNC">         189 :       if (gst_tensor_filter_check_hw_availability (fw_name, accl, custom)) {</span></span>
<span id="L253"><span class="lineNum">     253</span> <span class="tlaGNC">         180 :         *available = true;</span></span>
<span id="L254"><span class="lineNum">     254</span>              :       } else {</span>
<span id="L255"><span class="lineNum">     255</span> <span class="tlaGNC">           9 :         _ml_logi (&quot;%s is supported but not with the specified hardware.&quot;,</span></span>
<span id="L256"><span class="lineNum">     256</span>              :             fw_name);</span>
<span id="L257"><span class="lineNum">     257</span>              :       }</span>
<span id="L258"><span class="lineNum">     258</span>              :     } else {</span>
<span id="L259"><span class="lineNum">     259</span> <span class="tlaGNC">           1 :       _ml_logi (&quot;%s is not supported.&quot;, fw_name);</span></span>
<span id="L260"><span class="lineNum">     260</span>              :     }</span>
<span id="L261"><span class="lineNum">     261</span>              :   } else {</span>
<span id="L262"><span class="lineNum">     262</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_logw (&quot;Cannot get the name of sub-plugin for given nnfw.&quot;);</span></span>
<span id="L263"><span class="lineNum">     263</span>              :   }</span>
<span id="L264"><span class="lineNum">     264</span>              : </span>
<span id="L265"><span class="lineNum">     265</span> <span class="tlaGNC tlaBgGNC">         190 :   return ML_ERROR_NONE;</span></span>
<span id="L266"><span class="lineNum">     266</span>              : }</span>
<span id="L267"><span class="lineNum">     267</span>              : </span>
<span id="L268"><span class="lineNum">     268</span>              : /**</span>
<span id="L269"><span class="lineNum">     269</span>              :  * @brief Checks the availability of the given execution environments.</span>
<span id="L270"><span class="lineNum">     270</span>              :  */</span>
<span id="L271"><span class="lineNum">     271</span>              : int</span>
<span id="L272"><span class="lineNum">     272</span> <span class="tlaGNC">         191 : ml_check_nnfw_availability (ml_nnfw_type_e nnfw, ml_nnfw_hw_e hw,</span></span>
<span id="L273"><span class="lineNum">     273</span>              :     bool *available)</span>
<span id="L274"><span class="lineNum">     274</span>              : {</span>
<span id="L275"><span class="lineNum">     275</span> <span class="tlaGNC">         191 :   return ml_check_nnfw_availability_full (nnfw, hw, NULL, available);</span></span>
<span id="L276"><span class="lineNum">     276</span>              : }</span>
<span id="L277"><span class="lineNum">     277</span>              : </span>
<span id="L278"><span class="lineNum">     278</span>              : /**</span>
<span id="L279"><span class="lineNum">     279</span>              :  * @brief setup input and output tensor memory to pass to the tensor_filter.</span>
<span id="L280"><span class="lineNum">     280</span>              :  * @note this tensor memory wrapper will be reused for each invoke.</span>
<span id="L281"><span class="lineNum">     281</span>              :  */</span>
<span id="L282"><span class="lineNum">     282</span>              : static void</span>
<span id="L283"><span class="lineNum">     283</span> <span class="tlaGNC">          98 : __setup_in_out_tensors (ml_single * single_h)</span></span>
<span id="L284"><span class="lineNum">     284</span>              : {</span>
<span id="L285"><span class="lineNum">     285</span>              :   guint i;</span>
<span id="L286"><span class="lineNum">     286</span> <span class="tlaGNC">          98 :   ml_tensors_data_s *in_tensors = (ml_tensors_data_s *) single_h-&gt;in_tensors;</span></span>
<span id="L287"><span class="lineNum">     287</span> <span class="tlaGNC">          98 :   ml_tensors_data_s *out_tensors = (ml_tensors_data_s *) single_h-&gt;out_tensors;</span></span>
<span id="L288"><span class="lineNum">     288</span>              : </span>
<span id="L289"><span class="lineNum">     289</span>              :   /* Setup input buffer */</span>
<span id="L290"><span class="lineNum">     290</span> <span class="tlaGNC">          98 :   if (in_tensors) {</span></span>
<span id="L291"><span class="lineNum">     291</span> <span class="tlaGNC">          20 :     _ml_tensors_info_free (in_tensors-&gt;info);</span></span>
<span id="L292"><span class="lineNum">     292</span> <span class="tlaGNC">          20 :     _ml_tensors_info_copy_from_gst (in_tensors-&gt;info, &amp;single_h-&gt;in_info);</span></span>
<span id="L293"><span class="lineNum">     293</span>              :   } else {</span>
<span id="L294"><span class="lineNum">     294</span>              :     ml_tensors_info_h info;</span>
<span id="L295"><span class="lineNum">     295</span>              : </span>
<span id="L296"><span class="lineNum">     296</span> <span class="tlaGNC">          78 :     _ml_tensors_info_create_from_gst (&amp;info, &amp;single_h-&gt;in_info);</span></span>
<span id="L297"><span class="lineNum">     297</span> <span class="tlaGNC">          78 :     _ml_tensors_data_create_no_alloc (info, &amp;single_h-&gt;in_tensors);</span></span>
<span id="L298"><span class="lineNum">     298</span>              : </span>
<span id="L299"><span class="lineNum">     299</span> <span class="tlaGNC">          78 :     ml_tensors_info_destroy (info);</span></span>
<span id="L300"><span class="lineNum">     300</span> <span class="tlaGNC">          78 :     in_tensors = (ml_tensors_data_s *) single_h-&gt;in_tensors;</span></span>
<span id="L301"><span class="lineNum">     301</span>              :   }</span>
<span id="L302"><span class="lineNum">     302</span>              : </span>
<span id="L303"><span class="lineNum">     303</span> <span class="tlaGNC">          98 :   in_tensors-&gt;num_tensors = single_h-&gt;in_info.num_tensors;</span></span>
<span id="L304"><span class="lineNum">     304</span> <span class="tlaGNC">         229 :   for (i = 0; i &lt; in_tensors-&gt;num_tensors; i++) {</span></span>
<span id="L305"><span class="lineNum">     305</span>              :     /** memory will be allocated by tensor_filter_single */</span>
<span id="L306"><span class="lineNum">     306</span> <span class="tlaGNC">         131 :     in_tensors-&gt;tensors[i].data = NULL;</span></span>
<span id="L307"><span class="lineNum">     307</span> <span class="tlaGNC">         131 :     in_tensors-&gt;tensors[i].size =</span></span>
<span id="L308"><span class="lineNum">     308</span> <span class="tlaGNC">         131 :         gst_tensors_info_get_size (&amp;single_h-&gt;in_info, i);</span></span>
<span id="L309"><span class="lineNum">     309</span>              :   }</span>
<span id="L310"><span class="lineNum">     310</span>              : </span>
<span id="L311"><span class="lineNum">     311</span>              :   /* Setup output buffer */</span>
<span id="L312"><span class="lineNum">     312</span> <span class="tlaGNC">          98 :   if (out_tensors) {</span></span>
<span id="L313"><span class="lineNum">     313</span> <span class="tlaGNC">          20 :     _ml_tensors_info_free (out_tensors-&gt;info);</span></span>
<span id="L314"><span class="lineNum">     314</span> <span class="tlaGNC">          20 :     _ml_tensors_info_copy_from_gst (out_tensors-&gt;info, &amp;single_h-&gt;out_info);</span></span>
<span id="L315"><span class="lineNum">     315</span>              :   } else {</span>
<span id="L316"><span class="lineNum">     316</span>              :     ml_tensors_info_h info;</span>
<span id="L317"><span class="lineNum">     317</span>              : </span>
<span id="L318"><span class="lineNum">     318</span> <span class="tlaGNC">          78 :     _ml_tensors_info_create_from_gst (&amp;info, &amp;single_h-&gt;out_info);</span></span>
<span id="L319"><span class="lineNum">     319</span> <span class="tlaGNC">          78 :     _ml_tensors_data_create_no_alloc (info, &amp;single_h-&gt;out_tensors);</span></span>
<span id="L320"><span class="lineNum">     320</span>              : </span>
<span id="L321"><span class="lineNum">     321</span> <span class="tlaGNC">          78 :     ml_tensors_info_destroy (info);</span></span>
<span id="L322"><span class="lineNum">     322</span> <span class="tlaGNC">          78 :     out_tensors = (ml_tensors_data_s *) single_h-&gt;out_tensors;</span></span>
<span id="L323"><span class="lineNum">     323</span>              :   }</span>
<span id="L324"><span class="lineNum">     324</span>              : </span>
<span id="L325"><span class="lineNum">     325</span> <span class="tlaGNC">          98 :   out_tensors-&gt;num_tensors = single_h-&gt;out_info.num_tensors;</span></span>
<span id="L326"><span class="lineNum">     326</span> <span class="tlaGNC">         227 :   for (i = 0; i &lt; out_tensors-&gt;num_tensors; i++) {</span></span>
<span id="L327"><span class="lineNum">     327</span>              :     /** memory will be allocated by tensor_filter_single */</span>
<span id="L328"><span class="lineNum">     328</span> <span class="tlaGNC">         129 :     out_tensors-&gt;tensors[i].data = NULL;</span></span>
<span id="L329"><span class="lineNum">     329</span> <span class="tlaGNC">         129 :     out_tensors-&gt;tensors[i].size =</span></span>
<span id="L330"><span class="lineNum">     330</span> <span class="tlaGNC">         129 :         gst_tensors_info_get_size (&amp;single_h-&gt;out_info, i);</span></span>
<span id="L331"><span class="lineNum">     331</span>              :   }</span>
<span id="L332"><span class="lineNum">     332</span> <span class="tlaGNC">          98 : }</span></span>
<span id="L333"><span class="lineNum">     333</span>              : </span>
<span id="L334"><span class="lineNum">     334</span>              : /**</span>
<span id="L335"><span class="lineNum">     335</span>              :  * @brief To call the framework to destroy the allocated output data</span>
<span id="L336"><span class="lineNum">     336</span>              :  */</span>
<span id="L337"><span class="lineNum">     337</span>              : static inline void</span>
<span id="L338"><span class="lineNum">     338</span> <span class="tlaGNC">           2 : __destroy_notify (gpointer data_h, gpointer single_data)</span></span>
<span id="L339"><span class="lineNum">     339</span>              : {</span>
<span id="L340"><span class="lineNum">     340</span>              :   ml_single *single_h;</span>
<span id="L341"><span class="lineNum">     341</span>              :   ml_tensors_data_s *data;</span>
<span id="L342"><span class="lineNum">     342</span>              : </span>
<span id="L343"><span class="lineNum">     343</span> <span class="tlaGNC">           2 :   data = (ml_tensors_data_s *) data_h;</span></span>
<span id="L344"><span class="lineNum">     344</span> <span class="tlaGNC">           2 :   single_h = (ml_single *) single_data;</span></span>
<span id="L345"><span class="lineNum">     345</span>              : </span>
<span id="L346"><span class="lineNum">     346</span> <span class="tlaGNC">           2 :   if (G_LIKELY (single_h-&gt;filter)) {</span></span>
<span id="L347"><span class="lineNum">     347</span> <span class="tlaGNC">           2 :     if (single_h-&gt;klass-&gt;allocate_in_invoke (single_h-&gt;filter)) {</span></span>
<span id="L348"><span class="lineNum">     348</span> <span class="tlaUNC tlaBgUNC">           0 :       single_h-&gt;klass-&gt;destroy_notify (single_h-&gt;filter, data-&gt;tensors);</span></span>
<span id="L349"><span class="lineNum">     349</span>              :     }</span>
<span id="L350"><span class="lineNum">     350</span>              :   }</span>
<span id="L351"><span class="lineNum">     351</span>              : </span>
<span id="L352"><span class="lineNum">     352</span>              :   /* reset callback function */</span>
<span id="L353"><span class="lineNum">     353</span> <span class="tlaGNC tlaBgGNC">           2 :   data-&gt;destroy = NULL;</span></span>
<span id="L354"><span class="lineNum">     354</span> <span class="tlaGNC">           2 : }</span></span>
<span id="L355"><span class="lineNum">     355</span>              : </span>
<span id="L356"><span class="lineNum">     356</span>              : /**</span>
<span id="L357"><span class="lineNum">     357</span>              :  * @brief Wrapper function for __destroy_notify</span>
<span id="L358"><span class="lineNum">     358</span>              :  */</span>
<span id="L359"><span class="lineNum">     359</span>              : static int</span>
<span id="L360"><span class="lineNum">     360</span> <span class="tlaUNC tlaBgUNC">           0 : ml_single_destroy_notify_cb (void *handle, void *user_data)</span></span>
<span id="L361"><span class="lineNum">     361</span>              : {</span>
<span id="L362"><span class="lineNum">     362</span> <span class="tlaUNC">           0 :   ml_tensors_data_h data = (ml_tensors_data_h) handle;</span></span>
<span id="L363"><span class="lineNum">     363</span> <span class="tlaUNC">           0 :   ml_single_h single = (ml_single_h) user_data;</span></span>
<span id="L364"><span class="lineNum">     364</span>              :   ml_single *single_h;</span>
<span id="L365"><span class="lineNum">     365</span> <span class="tlaUNC">           0 :   int status = ML_ERROR_NONE;</span></span>
<span id="L366"><span class="lineNum">     366</span>              : </span>
<span id="L367"><span class="lineNum">     367</span> <span class="tlaUNC">           0 :   if (G_UNLIKELY (!single))</span></span>
<span id="L368"><span class="lineNum">     368</span> <span class="tlaUNC">           0 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L369"><span class="lineNum">     369</span>              :         &quot;Failed to destroy data buffer. Callback function argument from _ml_tensors_data_destroy_internal is invalid. The given 'user_data' is NULL. It appears to be an internal error of ML-API or the user thread has touched private data structure.&quot;);</span>
<span id="L370"><span class="lineNum">     370</span> <span class="tlaUNC">           0 :   if (G_UNLIKELY (!data))</span></span>
<span id="L371"><span class="lineNum">     371</span> <span class="tlaUNC">           0 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L372"><span class="lineNum">     372</span>              :         &quot;Failed to destroy data buffer. Callback function argument from _ml_tensors_data_destroy_internal is invalid. The given 'handle' is NULL. It appears to be an internal error of ML-API or the user thread has touched private data structure.&quot;);</span>
<span id="L373"><span class="lineNum">     373</span>              : </span>
<span id="L374"><span class="lineNum">     374</span> <span class="tlaUNC">           0 :   ML_SINGLE_GET_VALID_HANDLE_LOCKED (single_h, single, 0);</span></span>
<span id="L375"><span class="lineNum">     375</span>              : </span>
<span id="L376"><span class="lineNum">     376</span> <span class="tlaUNC">           0 :   if (G_UNLIKELY (!single_h-&gt;filter)) {</span></span>
<span id="L377"><span class="lineNum">     377</span> <span class="tlaUNC">           0 :     status = ML_ERROR_INVALID_PARAMETER;</span></span>
<span id="L378"><span class="lineNum">     378</span> <span class="tlaUNC">           0 :     _ml_error_report</span></span>
<span id="L379"><span class="lineNum">     379</span>              :         (&quot;Failed to destroy the data buffer. The handle instance (single_h) is invalid. It appears to be an internal error of ML-API of the user thread has touched private data structure.&quot;);</span>
<span id="L380"><span class="lineNum">     380</span> <span class="tlaUNC">           0 :     goto exit;</span></span>
<span id="L381"><span class="lineNum">     381</span>              :   }</span>
<span id="L382"><span class="lineNum">     382</span>              : </span>
<span id="L383"><span class="lineNum">     383</span> <span class="tlaUNC">           0 :   single_h-&gt;destroy_data_list =</span></span>
<span id="L384"><span class="lineNum">     384</span> <span class="tlaUNC">           0 :       g_list_remove (single_h-&gt;destroy_data_list, data);</span></span>
<span id="L385"><span class="lineNum">     385</span> <span class="tlaUNC">           0 :   __destroy_notify (data, single_h);</span></span>
<span id="L386"><span class="lineNum">     386</span>              : </span>
<span id="L387"><span class="lineNum">     387</span> <span class="tlaUNC">           0 : exit:</span></span>
<span id="L388"><span class="lineNum">     388</span> <span class="tlaUNC">           0 :   ML_SINGLE_HANDLE_UNLOCK (single_h);</span></span>
<span id="L389"><span class="lineNum">     389</span>              : </span>
<span id="L390"><span class="lineNum">     390</span> <span class="tlaUNC">           0 :   return status;</span></span>
<span id="L391"><span class="lineNum">     391</span>              : }</span>
<span id="L392"><span class="lineNum">     392</span>              : </span>
<span id="L393"><span class="lineNum">     393</span>              : /**</span>
<span id="L394"><span class="lineNum">     394</span>              :  * @brief setup the destroy notify for the allocated output data.</span>
<span id="L395"><span class="lineNum">     395</span>              :  * @note this stores the data entry in the single list.</span>
<span id="L396"><span class="lineNum">     396</span>              :  * @note this has not overhead if the allocation of output is not performed by</span>
<span id="L397"><span class="lineNum">     397</span>              :  * the framework but by tensor filter element.</span>
<span id="L398"><span class="lineNum">     398</span>              :  */</span>
<span id="L399"><span class="lineNum">     399</span>              : static void</span>
<span id="L400"><span class="lineNum">     400</span> <span class="tlaGNC tlaBgGNC">          80 : set_destroy_notify (ml_single * single_h, ml_tensors_data_s * data,</span></span>
<span id="L401"><span class="lineNum">     401</span>              :     gboolean add)</span>
<span id="L402"><span class="lineNum">     402</span>              : {</span>
<span id="L403"><span class="lineNum">     403</span> <span class="tlaGNC">          80 :   if (single_h-&gt;klass-&gt;allocate_in_invoke (single_h-&gt;filter)) {</span></span>
<span id="L404"><span class="lineNum">     404</span> <span class="tlaUNC tlaBgUNC">           0 :     data-&gt;destroy = ml_single_destroy_notify_cb;</span></span>
<span id="L405"><span class="lineNum">     405</span> <span class="tlaUNC">           0 :     data-&gt;user_data = single_h;</span></span>
<span id="L406"><span class="lineNum">     406</span> <span class="tlaUNC">           0 :     add = TRUE;</span></span>
<span id="L407"><span class="lineNum">     407</span>              :   }</span>
<span id="L408"><span class="lineNum">     408</span>              : </span>
<span id="L409"><span class="lineNum">     409</span> <span class="tlaGNC tlaBgGNC">          80 :   if (add) {</span></span>
<span id="L410"><span class="lineNum">     410</span> <span class="tlaGNC">           4 :     single_h-&gt;destroy_data_list = g_list_append (single_h-&gt;destroy_data_list,</span></span>
<span id="L411"><span class="lineNum">     411</span>              :         (gpointer) data);</span>
<span id="L412"><span class="lineNum">     412</span>              :   }</span>
<span id="L413"><span class="lineNum">     413</span> <span class="tlaGNC">          80 : }</span></span>
<span id="L414"><span class="lineNum">     414</span>              : </span>
<span id="L415"><span class="lineNum">     415</span>              : /**</span>
<span id="L416"><span class="lineNum">     416</span>              :  * @brief Internal function to call subplugin's invoke</span>
<span id="L417"><span class="lineNum">     417</span>              :  */</span>
<span id="L418"><span class="lineNum">     418</span>              : static inline int</span>
<span id="L419"><span class="lineNum">     419</span> <span class="tlaGNC">          80 : __invoke (ml_single * single_h, ml_tensors_data_h in, ml_tensors_data_h out,</span></span>
<span id="L420"><span class="lineNum">     420</span>              :     gboolean alloc_output)</span>
<span id="L421"><span class="lineNum">     421</span>              : {</span>
<span id="L422"><span class="lineNum">     422</span>              :   ml_tensors_data_s *in_data, *out_data;</span>
<span id="L423"><span class="lineNum">     423</span> <span class="tlaGNC">          80 :   int status = ML_ERROR_NONE;</span></span>
<span id="L424"><span class="lineNum">     424</span>              : </span>
<span id="L425"><span class="lineNum">     425</span> <span class="tlaGNC">          80 :   in_data = (ml_tensors_data_s *) in;</span></span>
<span id="L426"><span class="lineNum">     426</span> <span class="tlaGNC">          80 :   out_data = (ml_tensors_data_s *) out;</span></span>
<span id="L427"><span class="lineNum">     427</span>              : </span>
<span id="L428"><span class="lineNum">     428</span>              :   /* Prevent error case when input or output is null in invoke thread. */</span>
<span id="L429"><span class="lineNum">     429</span> <span class="tlaGNC">          80 :   if (!in_data || !out_data) {</span></span>
<span id="L430"><span class="lineNum">     430</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report (&quot;Failed to invoke a model, invalid data handle.&quot;);</span></span>
<span id="L431"><span class="lineNum">     431</span> <span class="tlaUNC">           0 :     return ML_ERROR_STREAMS_PIPE;</span></span>
<span id="L432"><span class="lineNum">     432</span>              :   }</span>
<span id="L433"><span class="lineNum">     433</span>              : </span>
<span id="L434"><span class="lineNum">     434</span>              :   /* Invoke the thread. */</span>
<span id="L435"><span class="lineNum">     435</span> <span class="tlaGNC tlaBgGNC">          80 :   if (!single_h-&gt;klass-&gt;invoke (single_h-&gt;filter, in_data-&gt;tensors,</span></span>
<span id="L436"><span class="lineNum">     436</span> <span class="tlaGNC">          80 :           out_data-&gt;tensors, alloc_output)) {</span></span>
<span id="L437"><span class="lineNum">     437</span> <span class="tlaUNC tlaBgUNC">           0 :     const char *fw_name = _ml_get_nnfw_subplugin_name (single_h-&gt;nnfw);</span></span>
<span id="L438"><span class="lineNum">     438</span> <span class="tlaUNC">           0 :     _ml_error_report</span></span>
<span id="L439"><span class="lineNum">     439</span>              :         (&quot;Failed to invoke the tensors. The invoke callback of the tensor-filter subplugin '%s' has failed. Please contact the author of tensor-filter-%s (nnstreamer-%s) or review its source code. Note that this usually happens when the designated framework does not support the given model (e.g., trying to run tf-lite 2.6 model with tf-lite 1.13).&quot;,</span>
<span id="L440"><span class="lineNum">     440</span>              :         fw_name, fw_name, fw_name);</span>
<span id="L441"><span class="lineNum">     441</span> <span class="tlaUNC">           0 :     status = ML_ERROR_STREAMS_PIPE;</span></span>
<span id="L442"><span class="lineNum">     442</span>              :   }</span>
<span id="L443"><span class="lineNum">     443</span>              : </span>
<span id="L444"><span class="lineNum">     444</span> <span class="tlaGNC tlaBgGNC">          80 :   return status;</span></span>
<span id="L445"><span class="lineNum">     445</span>              : }</span>
<span id="L446"><span class="lineNum">     446</span>              : </span>
<span id="L447"><span class="lineNum">     447</span>              : /**</span>
<span id="L448"><span class="lineNum">     448</span>              :  * @brief Internal function to post-process given output.</span>
<span id="L449"><span class="lineNum">     449</span>              :  * @note Do not call this if single_h-&gt;free_output is false (output data is not allocated in single-shot).</span>
<span id="L450"><span class="lineNum">     450</span>              :  */</span>
<span id="L451"><span class="lineNum">     451</span>              : static inline void</span>
<span id="L452"><span class="lineNum">     452</span> <span class="tlaGNC">          77 : __process_output (ml_single * single_h, ml_tensors_data_h output)</span></span>
<span id="L453"><span class="lineNum">     453</span>              : {</span>
<span id="L454"><span class="lineNum">     454</span>              :   ml_tensors_data_s *out_data;</span>
<span id="L455"><span class="lineNum">     455</span>              : </span>
<span id="L456"><span class="lineNum">     456</span> <span class="tlaGNC">          77 :   if (g_list_find (single_h-&gt;destroy_data_list, output)) {</span></span>
<span id="L457"><span class="lineNum">     457</span>              :     /**</span>
<span id="L458"><span class="lineNum">     458</span>              :      * Caller of the invoke thread has returned back with timeout.</span>
<span id="L459"><span class="lineNum">     459</span>              :      * So, free the memory allocated by the invoke as their is no receiver.</span>
<span id="L460"><span class="lineNum">     460</span>              :      */</span>
<span id="L461"><span class="lineNum">     461</span> <span class="tlaGNC">           1 :     single_h-&gt;destroy_data_list =</span></span>
<span id="L462"><span class="lineNum">     462</span> <span class="tlaGNC">           1 :         g_list_remove (single_h-&gt;destroy_data_list, output);</span></span>
<span id="L463"><span class="lineNum">     463</span> <span class="tlaGNC">           1 :     ml_tensors_data_destroy (output);</span></span>
<span id="L464"><span class="lineNum">     464</span>              :   } else {</span>
<span id="L465"><span class="lineNum">     465</span> <span class="tlaGNC">          76 :     out_data = (ml_tensors_data_s *) output;</span></span>
<span id="L466"><span class="lineNum">     466</span> <span class="tlaGNC">          76 :     set_destroy_notify (single_h, out_data, FALSE);</span></span>
<span id="L467"><span class="lineNum">     467</span>              :   }</span>
<span id="L468"><span class="lineNum">     468</span> <span class="tlaGNC">          77 : }</span></span>
<span id="L469"><span class="lineNum">     469</span>              : </span>
<span id="L470"><span class="lineNum">     470</span>              : /**</span>
<span id="L471"><span class="lineNum">     471</span>              :  * @brief thread to execute calls to invoke</span>
<span id="L472"><span class="lineNum">     472</span>              :  *</span>
<span id="L473"><span class="lineNum">     473</span>              :  * @details The thread behavior is detailed as below:</span>
<span id="L474"><span class="lineNum">     474</span>              :  *          - Starting with IDLE state, the thread waits for an input or change</span>
<span id="L475"><span class="lineNum">     475</span>              :  *          in state externally.</span>
<span id="L476"><span class="lineNum">     476</span>              :  *          - If state is not RUNNING, exit this thread, else process the</span>
<span id="L477"><span class="lineNum">     477</span>              :  *          request.</span>
<span id="L478"><span class="lineNum">     478</span>              :  *          - Process input, call invoke, process output. Any error in this</span>
<span id="L479"><span class="lineNum">     479</span>              :  *          state sets the status to be used by ml_single_invoke().</span>
<span id="L480"><span class="lineNum">     480</span>              :  *          - State is set back to IDLE and thread moves back to start.</span>
<span id="L481"><span class="lineNum">     481</span>              :  *</span>
<span id="L482"><span class="lineNum">     482</span>              :  *          State changes performed by this function when:</span>
<span id="L483"><span class="lineNum">     483</span>              :  *          RUNNING -&gt; IDLE - processing is finished.</span>
<span id="L484"><span class="lineNum">     484</span>              :  *          JOIN_REQUESTED -&gt; IDLE - close is requested.</span>
<span id="L485"><span class="lineNum">     485</span>              :  *</span>
<span id="L486"><span class="lineNum">     486</span>              :  * @note Error while processing an input is provided back to requesting</span>
<span id="L487"><span class="lineNum">     487</span>              :  *       function, and further processing of invoke_thread is not affected.</span>
<span id="L488"><span class="lineNum">     488</span>              :  */</span>
<span id="L489"><span class="lineNum">     489</span>              : static void *</span>
<span id="L490"><span class="lineNum">     490</span> <span class="tlaGNC">          82 : invoke_thread (void *arg)</span></span>
<span id="L491"><span class="lineNum">     491</span>              : {</span>
<span id="L492"><span class="lineNum">     492</span>              :   ml_single *single_h;</span>
<span id="L493"><span class="lineNum">     493</span>              :   ml_tensors_data_h input, output;</span>
<span id="L494"><span class="lineNum">     494</span> <span class="tlaGNC">          82 :   gboolean alloc_output = FALSE;</span></span>
<span id="L495"><span class="lineNum">     495</span>              : </span>
<span id="L496"><span class="lineNum">     496</span> <span class="tlaGNC">          82 :   single_h = (ml_single *) arg;</span></span>
<span id="L497"><span class="lineNum">     497</span>              : </span>
<span id="L498"><span class="lineNum">     498</span> <span class="tlaGNC">          82 :   g_mutex_lock (&amp;single_h-&gt;mutex);</span></span>
<span id="L499"><span class="lineNum">     499</span>              : </span>
<span id="L500"><span class="lineNum">     500</span> <span class="tlaGNC">         101 :   while (single_h-&gt;state &lt;= RUNNING) {</span></span>
<span id="L501"><span class="lineNum">     501</span> <span class="tlaGNC">          99 :     int status = ML_ERROR_NONE;</span></span>
<span id="L502"><span class="lineNum">     502</span>              : </span>
<span id="L503"><span class="lineNum">     503</span>              :     /** wait for data */</span>
<span id="L504"><span class="lineNum">     504</span> <span class="tlaGNC">         120 :     while (single_h-&gt;state != RUNNING) {</span></span>
<span id="L505"><span class="lineNum">     505</span> <span class="tlaGNC">          99 :       g_cond_wait (&amp;single_h-&gt;cond, &amp;single_h-&gt;mutex);</span></span>
<span id="L506"><span class="lineNum">     506</span> <span class="tlaGNC">          97 :       if (single_h-&gt;state == JOIN_REQUESTED)</span></span>
<span id="L507"><span class="lineNum">     507</span> <span class="tlaGNC">          76 :         goto exit;</span></span>
<span id="L508"><span class="lineNum">     508</span>              :     }</span>
<span id="L509"><span class="lineNum">     509</span>              : </span>
<span id="L510"><span class="lineNum">     510</span> <span class="tlaGNC">          21 :     input = single_h-&gt;input;</span></span>
<span id="L511"><span class="lineNum">     511</span> <span class="tlaGNC">          21 :     output = single_h-&gt;output;</span></span>
<span id="L512"><span class="lineNum">     512</span>              :     /* Set null to prevent double-free. */</span>
<span id="L513"><span class="lineNum">     513</span> <span class="tlaGNC">          21 :     single_h-&gt;input = single_h-&gt;output = NULL;</span></span>
<span id="L514"><span class="lineNum">     514</span>              : </span>
<span id="L515"><span class="lineNum">     515</span> <span class="tlaGNC">          21 :     single_h-&gt;invoking = TRUE;</span></span>
<span id="L516"><span class="lineNum">     516</span> <span class="tlaGNC">          21 :     alloc_output = single_h-&gt;free_output;</span></span>
<span id="L517"><span class="lineNum">     517</span> <span class="tlaGNC">          21 :     g_mutex_unlock (&amp;single_h-&gt;mutex);</span></span>
<span id="L518"><span class="lineNum">     518</span> <span class="tlaGNC">          21 :     status = __invoke (single_h, input, output, alloc_output);</span></span>
<span id="L519"><span class="lineNum">     519</span> <span class="tlaGNC">          21 :     g_mutex_lock (&amp;single_h-&gt;mutex);</span></span>
<span id="L520"><span class="lineNum">     520</span>              :     /* Clear input data after invoke is done. */</span>
<span id="L521"><span class="lineNum">     521</span> <span class="tlaGNC">          21 :     ml_tensors_data_destroy (input);</span></span>
<span id="L522"><span class="lineNum">     522</span> <span class="tlaGNC">          21 :     single_h-&gt;invoking = FALSE;</span></span>
<span id="L523"><span class="lineNum">     523</span>              : </span>
<span id="L524"><span class="lineNum">     524</span> <span class="tlaGNC">          21 :     if (status != ML_ERROR_NONE || single_h-&gt;state == JOIN_REQUESTED) {</span></span>
<span id="L525"><span class="lineNum">     525</span> <span class="tlaGNC">           2 :       if (alloc_output) {</span></span>
<span id="L526"><span class="lineNum">     526</span> <span class="tlaGNC">           2 :         single_h-&gt;destroy_data_list =</span></span>
<span id="L527"><span class="lineNum">     527</span> <span class="tlaGNC">           2 :             g_list_remove (single_h-&gt;destroy_data_list, output);</span></span>
<span id="L528"><span class="lineNum">     528</span> <span class="tlaGNC">           2 :         ml_tensors_data_destroy (output);</span></span>
<span id="L529"><span class="lineNum">     529</span>              :       }</span>
<span id="L530"><span class="lineNum">     530</span>              : </span>
<span id="L531"><span class="lineNum">     531</span> <span class="tlaGNC">           2 :       if (single_h-&gt;state == JOIN_REQUESTED)</span></span>
<span id="L532"><span class="lineNum">     532</span> <span class="tlaGNC">           2 :         goto exit;</span></span>
<span id="L533"><span class="lineNum">     533</span> <span class="tlaUNC tlaBgUNC">           0 :       goto wait_for_next;</span></span>
<span id="L534"><span class="lineNum">     534</span>              :     }</span>
<span id="L535"><span class="lineNum">     535</span>              : </span>
<span id="L536"><span class="lineNum">     536</span> <span class="tlaGNC tlaBgGNC">          19 :     if (alloc_output)</span></span>
<span id="L537"><span class="lineNum">     537</span> <span class="tlaGNC">          19 :       __process_output (single_h, output);</span></span>
<span id="L538"><span class="lineNum">     538</span>              : </span>
<span id="L539"><span class="lineNum">     539</span>              :     /** loop over to wait for the next element */</span>
<span id="L540"><span class="lineNum">     540</span> <span class="tlaUNC tlaBgUNC">           0 :   wait_for_next:</span></span>
<span id="L541"><span class="lineNum">     541</span> <span class="tlaGNC tlaBgGNC">          19 :     single_h-&gt;status = status;</span></span>
<span id="L542"><span class="lineNum">     542</span> <span class="tlaGNC">          19 :     if (single_h-&gt;state == RUNNING)</span></span>
<span id="L543"><span class="lineNum">     543</span> <span class="tlaGNC">          19 :       single_h-&gt;state = IDLE;</span></span>
<span id="L544"><span class="lineNum">     544</span> <span class="tlaGNC">          19 :     g_cond_broadcast (&amp;single_h-&gt;cond);</span></span>
<span id="L545"><span class="lineNum">     545</span>              :   }</span>
<span id="L546"><span class="lineNum">     546</span>              : </span>
<span id="L547"><span class="lineNum">     547</span> <span class="tlaGNC">           2 : exit:</span></span>
<span id="L548"><span class="lineNum">     548</span>              :   /* Do not set IDLE if JOIN_REQUESTED */</span>
<span id="L549"><span class="lineNum">     549</span> <span class="tlaGNC">          80 :   if (single_h-&gt;state == JOIN_REQUESTED) {</span></span>
<span id="L550"><span class="lineNum">     550</span>              :     /* Release input and output data */</span>
<span id="L551"><span class="lineNum">     551</span> <span class="tlaGNC">          80 :     if (single_h-&gt;input)</span></span>
<span id="L552"><span class="lineNum">     552</span> <span class="tlaUNC tlaBgUNC">           0 :       ml_tensors_data_destroy (single_h-&gt;input);</span></span>
<span id="L553"><span class="lineNum">     553</span>              : </span>
<span id="L554"><span class="lineNum">     554</span> <span class="tlaGNC tlaBgGNC">          80 :     if (alloc_output &amp;&amp; single_h-&gt;output) {</span></span>
<span id="L555"><span class="lineNum">     555</span> <span class="tlaUNC tlaBgUNC">           0 :       single_h-&gt;destroy_data_list =</span></span>
<span id="L556"><span class="lineNum">     556</span> <span class="tlaUNC">           0 :           g_list_remove (single_h-&gt;destroy_data_list, single_h-&gt;output);</span></span>
<span id="L557"><span class="lineNum">     557</span> <span class="tlaUNC">           0 :       ml_tensors_data_destroy (single_h-&gt;output);</span></span>
<span id="L558"><span class="lineNum">     558</span>              :     }</span>
<span id="L559"><span class="lineNum">     559</span>              : </span>
<span id="L560"><span class="lineNum">     560</span> <span class="tlaGNC tlaBgGNC">          80 :     single_h-&gt;input = single_h-&gt;output = NULL;</span></span>
<span id="L561"><span class="lineNum">     561</span> <span class="tlaUNC tlaBgUNC">           0 :   } else if (single_h-&gt;state == RUNNING)</span></span>
<span id="L562"><span class="lineNum">     562</span> <span class="tlaUNC">           0 :     single_h-&gt;state = IDLE;</span></span>
<span id="L563"><span class="lineNum">     563</span> <span class="tlaGNC tlaBgGNC">          80 :   g_mutex_unlock (&amp;single_h-&gt;mutex);</span></span>
<span id="L564"><span class="lineNum">     564</span> <span class="tlaGNC">          80 :   return NULL;</span></span>
<span id="L565"><span class="lineNum">     565</span>              : }</span>
<span id="L566"><span class="lineNum">     566</span>              : </span>
<span id="L567"><span class="lineNum">     567</span>              : /**</span>
<span id="L568"><span class="lineNum">     568</span>              :  * @brief Sets the information (tensor dimension, type, name and so on) of required input data for the given model, and get updated output data information.</span>
<span id="L569"><span class="lineNum">     569</span>              :  * @details Note that a model/framework may not support setting such information.</span>
<span id="L570"><span class="lineNum">     570</span>              :  * @since_tizen 6.0</span>
<span id="L571"><span class="lineNum">     571</span>              :  * @param[in] single The model handle.</span>
<span id="L572"><span class="lineNum">     572</span>              :  * @param[in] in_info The handle of input tensors information.</span>
<span id="L573"><span class="lineNum">     573</span>              :  * @param[out] out_info The handle of output tensors information. The caller is responsible for freeing the information with ml_tensors_info_destroy().</span>
<span id="L574"><span class="lineNum">     574</span>              :  * @return @c 0 on success. Otherwise a negative error value.</span>
<span id="L575"><span class="lineNum">     575</span>              :  * @retval #ML_ERROR_NONE Successful</span>
<span id="L576"><span class="lineNum">     576</span>              :  * @retval #ML_ERROR_NOT_SUPPORTED This implies that the given framework does not support dynamic dimensions.</span>
<span id="L577"><span class="lineNum">     577</span>              :  *         Use ml_single_get_input_info() and ml_single_get_output_info() instead for this framework.</span>
<span id="L578"><span class="lineNum">     578</span>              :  * @retval #ML_ERROR_INVALID_PARAMETER Fail. The parameter is invalid.</span>
<span id="L579"><span class="lineNum">     579</span>              :  */</span>
<span id="L580"><span class="lineNum">     580</span>              : static int</span>
<span id="L581"><span class="lineNum">     581</span> <span class="tlaGNC">           7 : ml_single_update_info (ml_single_h single,</span></span>
<span id="L582"><span class="lineNum">     582</span>              :     const ml_tensors_info_h in_info, ml_tensors_info_h * out_info)</span>
<span id="L583"><span class="lineNum">     583</span>              : {</span>
<span id="L584"><span class="lineNum">     584</span> <span class="tlaGNC">           7 :   if (!single)</span></span>
<span id="L585"><span class="lineNum">     585</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L586"><span class="lineNum">     586</span>              :         &quot;The parameter, single (ml_single_h), is NULL. It should be a valid ml_single_h instance, usually created by ml_single_open().&quot;);</span>
<span id="L587"><span class="lineNum">     587</span> <span class="tlaGNC tlaBgGNC">           7 :   if (!in_info)</span></span>
<span id="L588"><span class="lineNum">     588</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L589"><span class="lineNum">     589</span>              :         &quot;The parameter, in_info (const ml_tensors_info_h), is NULL. It should be a valid instance of ml_tensors_info_h, usually created by ml_tensors_info_create() and configured by the application.&quot;);</span>
<span id="L590"><span class="lineNum">     590</span> <span class="tlaGNC tlaBgGNC">           7 :   if (!out_info)</span></span>
<span id="L591"><span class="lineNum">     591</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L592"><span class="lineNum">     592</span>              :         &quot;The parameter, out_info (ml_tensors_info_h *), is NULL. It should be a valid pointer to an instance ml_tensors_info_h, usually created by ml_tensors_info_h(). Note that out_info is supposed to be overwritten by this API call.&quot;);</span>
<span id="L593"><span class="lineNum">     593</span>              : </span>
<span id="L594"><span class="lineNum">     594</span>              :   /* init null */</span>
<span id="L595"><span class="lineNum">     595</span> <span class="tlaGNC tlaBgGNC">           7 :   *out_info = NULL;</span></span>
<span id="L596"><span class="lineNum">     596</span>              : </span>
<span id="L597"><span class="lineNum">     597</span> <span class="tlaGNC">           7 :   _ml_error_report_return_continue_iferr (ml_single_set_input_info (single,</span></span>
<span id="L598"><span class="lineNum">     598</span>              :           in_info),</span>
<span id="L599"><span class="lineNum">     599</span>              :       &quot;Configuring the neural network model with the given input information has failed with %d error code. The given input information ('in_info' parameter) might be invalid or the given neural network cannot accept it as its input data.&quot;,</span>
<span id="L600"><span class="lineNum">     600</span>              :       _ERRNO);</span>
<span id="L601"><span class="lineNum">     601</span>              : </span>
<span id="L602"><span class="lineNum">     602</span> <span class="tlaGNC">           5 :   __setup_in_out_tensors (single);</span></span>
<span id="L603"><span class="lineNum">     603</span> <span class="tlaGNC">           5 :   _ml_error_report_return_continue_iferr (ml_single_get_output_info (single,</span></span>
<span id="L604"><span class="lineNum">     604</span>              :           out_info),</span>
<span id="L605"><span class="lineNum">     605</span>              :       &quot;Fetching output info after configuring input information has failed with %d error code.&quot;,</span>
<span id="L606"><span class="lineNum">     606</span>              :       _ERRNO);</span>
<span id="L607"><span class="lineNum">     607</span>              : </span>
<span id="L608"><span class="lineNum">     608</span> <span class="tlaGNC">           5 :   return ML_ERROR_NONE;</span></span>
<span id="L609"><span class="lineNum">     609</span>              : }</span>
<span id="L610"><span class="lineNum">     610</span>              : </span>
<span id="L611"><span class="lineNum">     611</span>              : /**</span>
<span id="L612"><span class="lineNum">     612</span>              :  * @brief Internal function to get the gst info from tensor-filter.</span>
<span id="L613"><span class="lineNum">     613</span>              :  */</span>
<span id="L614"><span class="lineNum">     614</span>              : static void</span>
<span id="L615"><span class="lineNum">     615</span> <span class="tlaGNC">         169 : ml_single_get_gst_info (ml_single * single_h, gboolean is_input,</span></span>
<span id="L616"><span class="lineNum">     616</span>              :     GstTensorsInfo * gst_info)</span>
<span id="L617"><span class="lineNum">     617</span>              : {</span>
<span id="L618"><span class="lineNum">     618</span>              :   const gchar *prop_prefix, *prop_name, *prop_type;</span>
<span id="L619"><span class="lineNum">     619</span>              :   gchar *val;</span>
<span id="L620"><span class="lineNum">     620</span>              :   guint num;</span>
<span id="L621"><span class="lineNum">     621</span>              : </span>
<span id="L622"><span class="lineNum">     622</span> <span class="tlaGNC">         169 :   if (is_input) {</span></span>
<span id="L623"><span class="lineNum">     623</span> <span class="tlaGNC">          89 :     prop_prefix = INPUT_STR;</span></span>
<span id="L624"><span class="lineNum">     624</span> <span class="tlaGNC">          89 :     prop_type = CONCAT_MACRO_STR (INPUT_STR, TYPE_STR);</span></span>
<span id="L625"><span class="lineNum">     625</span> <span class="tlaGNC">          89 :     prop_name = CONCAT_MACRO_STR (INPUT_STR, NAME_STR);</span></span>
<span id="L626"><span class="lineNum">     626</span>              :   } else {</span>
<span id="L627"><span class="lineNum">     627</span> <span class="tlaGNC">          80 :     prop_prefix = OUTPUT_STR;</span></span>
<span id="L628"><span class="lineNum">     628</span> <span class="tlaGNC">          80 :     prop_type = CONCAT_MACRO_STR (OUTPUT_STR, TYPE_STR);</span></span>
<span id="L629"><span class="lineNum">     629</span> <span class="tlaGNC">          80 :     prop_name = CONCAT_MACRO_STR (OUTPUT_STR, NAME_STR);</span></span>
<span id="L630"><span class="lineNum">     630</span>              :   }</span>
<span id="L631"><span class="lineNum">     631</span>              : </span>
<span id="L632"><span class="lineNum">     632</span> <span class="tlaGNC">         169 :   gst_tensors_info_init (gst_info);</span></span>
<span id="L633"><span class="lineNum">     633</span>              : </span>
<span id="L634"><span class="lineNum">     634</span>              :   /* get dimensions */</span>
<span id="L635"><span class="lineNum">     635</span> <span class="tlaGNC">         169 :   g_object_get (single_h-&gt;filter, prop_prefix, &amp;val, NULL);</span></span>
<span id="L636"><span class="lineNum">     636</span> <span class="tlaGNC">         169 :   num = gst_tensors_info_parse_dimensions_string (gst_info, val);</span></span>
<span id="L637"><span class="lineNum">     637</span> <span class="tlaGNC">         169 :   g_free (val);</span></span>
<span id="L638"><span class="lineNum">     638</span>              : </span>
<span id="L639"><span class="lineNum">     639</span>              :   /* set the number of tensors */</span>
<span id="L640"><span class="lineNum">     640</span> <span class="tlaGNC">         169 :   gst_info-&gt;num_tensors = num;</span></span>
<span id="L641"><span class="lineNum">     641</span>              : </span>
<span id="L642"><span class="lineNum">     642</span>              :   /* get types */</span>
<span id="L643"><span class="lineNum">     643</span> <span class="tlaGNC">         169 :   g_object_get (single_h-&gt;filter, prop_type, &amp;val, NULL);</span></span>
<span id="L644"><span class="lineNum">     644</span> <span class="tlaGNC">         169 :   num = gst_tensors_info_parse_types_string (gst_info, val);</span></span>
<span id="L645"><span class="lineNum">     645</span> <span class="tlaGNC">         169 :   g_free (val);</span></span>
<span id="L646"><span class="lineNum">     646</span>              : </span>
<span id="L647"><span class="lineNum">     647</span> <span class="tlaGNC">         169 :   if (gst_info-&gt;num_tensors != num) {</span></span>
<span id="L648"><span class="lineNum">     648</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_logw (&quot;The number of tensor type is mismatched in filter.&quot;);</span></span>
<span id="L649"><span class="lineNum">     649</span>              :   }</span>
<span id="L650"><span class="lineNum">     650</span>              : </span>
<span id="L651"><span class="lineNum">     651</span>              :   /* get names */</span>
<span id="L652"><span class="lineNum">     652</span> <span class="tlaGNC tlaBgGNC">         169 :   g_object_get (single_h-&gt;filter, prop_name, &amp;val, NULL);</span></span>
<span id="L653"><span class="lineNum">     653</span> <span class="tlaGNC">         169 :   num = gst_tensors_info_parse_names_string (gst_info, val);</span></span>
<span id="L654"><span class="lineNum">     654</span> <span class="tlaGNC">         169 :   g_free (val);</span></span>
<span id="L655"><span class="lineNum">     655</span>              : </span>
<span id="L656"><span class="lineNum">     656</span> <span class="tlaGNC">         169 :   if (gst_info-&gt;num_tensors != num) {</span></span>
<span id="L657"><span class="lineNum">     657</span> <span class="tlaGNC">           8 :     _ml_logw (&quot;The number of tensor name is mismatched in filter.&quot;);</span></span>
<span id="L658"><span class="lineNum">     658</span>              :   }</span>
<span id="L659"><span class="lineNum">     659</span> <span class="tlaGNC">         169 : }</span></span>
<span id="L660"><span class="lineNum">     660</span>              : </span>
<span id="L661"><span class="lineNum">     661</span>              : /**</span>
<span id="L662"><span class="lineNum">     662</span>              :  * @brief Internal function to set the gst info in tensor-filter.</span>
<span id="L663"><span class="lineNum">     663</span>              :  */</span>
<span id="L664"><span class="lineNum">     664</span>              : static int</span>
<span id="L665"><span class="lineNum">     665</span> <span class="tlaGNC">          21 : ml_single_set_gst_info (ml_single * single_h, const GstTensorsInfo * in_info)</span></span>
<span id="L666"><span class="lineNum">     666</span>              : {</span>
<span id="L667"><span class="lineNum">     667</span>              :   GstTensorsInfo out_info;</span>
<span id="L668"><span class="lineNum">     668</span> <span class="tlaGNC">          21 :   int status = ML_ERROR_NONE;</span></span>
<span id="L669"><span class="lineNum">     669</span> <span class="tlaGNC">          21 :   int ret = -EINVAL;</span></span>
<span id="L670"><span class="lineNum">     670</span>              : </span>
<span id="L671"><span class="lineNum">     671</span> <span class="tlaGNC">          21 :   gst_tensors_info_init (&amp;out_info);</span></span>
<span id="L672"><span class="lineNum">     672</span> <span class="tlaGNC">          21 :   ret = single_h-&gt;klass-&gt;set_input_info (single_h-&gt;filter, in_info, &amp;out_info);</span></span>
<span id="L673"><span class="lineNum">     673</span> <span class="tlaGNC">          21 :   if (ret == 0) {</span></span>
<span id="L674"><span class="lineNum">     674</span> <span class="tlaGNC">          15 :     gst_tensors_info_free (&amp;single_h-&gt;in_info);</span></span>
<span id="L675"><span class="lineNum">     675</span> <span class="tlaGNC">          15 :     gst_tensors_info_free (&amp;single_h-&gt;out_info);</span></span>
<span id="L676"><span class="lineNum">     676</span> <span class="tlaGNC">          15 :     gst_tensors_info_copy (&amp;single_h-&gt;in_info, in_info);</span></span>
<span id="L677"><span class="lineNum">     677</span> <span class="tlaGNC">          15 :     gst_tensors_info_copy (&amp;single_h-&gt;out_info, &amp;out_info);</span></span>
<span id="L678"><span class="lineNum">     678</span>              : </span>
<span id="L679"><span class="lineNum">     679</span> <span class="tlaGNC">          15 :     __setup_in_out_tensors (single_h);</span></span>
<span id="L680"><span class="lineNum">     680</span> <span class="tlaGNC">           6 :   } else if (ret == -ENOENT) {</span></span>
<span id="L681"><span class="lineNum">     681</span> <span class="tlaUNC tlaBgUNC">           0 :     status = ML_ERROR_NOT_SUPPORTED;</span></span>
<span id="L682"><span class="lineNum">     682</span>              :   } else {</span>
<span id="L683"><span class="lineNum">     683</span> <span class="tlaGNC tlaBgGNC">           6 :     status = ML_ERROR_INVALID_PARAMETER;</span></span>
<span id="L684"><span class="lineNum">     684</span>              :   }</span>
<span id="L685"><span class="lineNum">     685</span>              : </span>
<span id="L686"><span class="lineNum">     686</span> <span class="tlaGNC">          21 :   gst_tensors_info_free (&amp;out_info);</span></span>
<span id="L687"><span class="lineNum">     687</span>              : </span>
<span id="L688"><span class="lineNum">     688</span> <span class="tlaGNC">          21 :   return status;</span></span>
<span id="L689"><span class="lineNum">     689</span>              : }</span>
<span id="L690"><span class="lineNum">     690</span>              : </span>
<span id="L691"><span class="lineNum">     691</span>              : /**</span>
<span id="L692"><span class="lineNum">     692</span>              :  * @brief Set the info for input/output tensors</span>
<span id="L693"><span class="lineNum">     693</span>              :  */</span>
<span id="L694"><span class="lineNum">     694</span>              : static int</span>
<span id="L695"><span class="lineNum">     695</span> <span class="tlaUNC tlaBgUNC">           0 : ml_single_set_inout_tensors_info (GObject * object,</span></span>
<span id="L696"><span class="lineNum">     696</span>              :     const gboolean is_input, ml_tensors_info_s * tensors_info)</span>
<span id="L697"><span class="lineNum">     697</span>              : {</span>
<span id="L698"><span class="lineNum">     698</span> <span class="tlaUNC">           0 :   int status = ML_ERROR_NONE;</span></span>
<span id="L699"><span class="lineNum">     699</span>              :   GstTensorsInfo info;</span>
<span id="L700"><span class="lineNum">     700</span>              :   gchar *str_dim, *str_type, *str_name;</span>
<span id="L701"><span class="lineNum">     701</span>              :   const gchar *str_type_name, *str_name_name;</span>
<span id="L702"><span class="lineNum">     702</span>              :   const gchar *prefix;</span>
<span id="L703"><span class="lineNum">     703</span>              : </span>
<span id="L704"><span class="lineNum">     704</span> <span class="tlaUNC">           0 :   if (is_input) {</span></span>
<span id="L705"><span class="lineNum">     705</span> <span class="tlaUNC">           0 :     prefix = INPUT_STR;</span></span>
<span id="L706"><span class="lineNum">     706</span> <span class="tlaUNC">           0 :     str_type_name = CONCAT_MACRO_STR (INPUT_STR, TYPE_STR);</span></span>
<span id="L707"><span class="lineNum">     707</span> <span class="tlaUNC">           0 :     str_name_name = CONCAT_MACRO_STR (INPUT_STR, NAME_STR);</span></span>
<span id="L708"><span class="lineNum">     708</span>              :   } else {</span>
<span id="L709"><span class="lineNum">     709</span> <span class="tlaUNC">           0 :     prefix = OUTPUT_STR;</span></span>
<span id="L710"><span class="lineNum">     710</span> <span class="tlaUNC">           0 :     str_type_name = CONCAT_MACRO_STR (OUTPUT_STR, TYPE_STR);</span></span>
<span id="L711"><span class="lineNum">     711</span> <span class="tlaUNC">           0 :     str_name_name = CONCAT_MACRO_STR (OUTPUT_STR, NAME_STR);</span></span>
<span id="L712"><span class="lineNum">     712</span>              :   }</span>
<span id="L713"><span class="lineNum">     713</span>              : </span>
<span id="L714"><span class="lineNum">     714</span> <span class="tlaUNC">           0 :   _ml_error_report_return_continue_iferr</span></span>
<span id="L715"><span class="lineNum">     715</span>              :       (_ml_tensors_info_copy_from_ml (&amp;info, tensors_info),</span>
<span id="L716"><span class="lineNum">     716</span>              :       &quot;Cannot fetch tensor-info from the given information. Error code: %d&quot;,</span>
<span id="L717"><span class="lineNum">     717</span>              :       _ERRNO);</span>
<span id="L718"><span class="lineNum">     718</span>              : </span>
<span id="L719"><span class="lineNum">     719</span>              :   /* Set input option */</span>
<span id="L720"><span class="lineNum">     720</span> <span class="tlaUNC">           0 :   str_dim = gst_tensors_info_get_dimensions_string (&amp;info);</span></span>
<span id="L721"><span class="lineNum">     721</span> <span class="tlaUNC">           0 :   str_type = gst_tensors_info_get_types_string (&amp;info);</span></span>
<span id="L722"><span class="lineNum">     722</span> <span class="tlaUNC">           0 :   str_name = gst_tensors_info_get_names_string (&amp;info);</span></span>
<span id="L723"><span class="lineNum">     723</span>              : </span>
<span id="L724"><span class="lineNum">     724</span> <span class="tlaUNC">           0 :   if (!str_dim || !str_type || !str_name) {</span></span>
<span id="L725"><span class="lineNum">     725</span> <span class="tlaUNC">           0 :     if (!str_dim)</span></span>
<span id="L726"><span class="lineNum">     726</span> <span class="tlaUNC">           0 :       _ml_error_report</span></span>
<span id="L727"><span class="lineNum">     727</span>              :           (&quot;Cannot fetch specific tensor-info from the given information: cannot fetch tensor dimension information.&quot;);</span>
<span id="L728"><span class="lineNum">     728</span> <span class="tlaUNC">           0 :     if (!str_type)</span></span>
<span id="L729"><span class="lineNum">     729</span> <span class="tlaUNC">           0 :       _ml_error_report</span></span>
<span id="L730"><span class="lineNum">     730</span>              :           (&quot;Cannot fetch specific tensor-info from the given information: cannot fetch tensor type information.&quot;);</span>
<span id="L731"><span class="lineNum">     731</span> <span class="tlaUNC">           0 :     if (!str_name)</span></span>
<span id="L732"><span class="lineNum">     732</span> <span class="tlaUNC">           0 :       _ml_error_report</span></span>
<span id="L733"><span class="lineNum">     733</span>              :           (&quot;Cannot fetch specific tensor-info from the given information: cannot fetch tensor name information. Even if tensor names are not defined, this should be able to fetch a list of empty strings.&quot;);</span>
<span id="L734"><span class="lineNum">     734</span>              : </span>
<span id="L735"><span class="lineNum">     735</span> <span class="tlaUNC">           0 :     status = ML_ERROR_INVALID_PARAMETER;</span></span>
<span id="L736"><span class="lineNum">     736</span>              :   } else {</span>
<span id="L737"><span class="lineNum">     737</span> <span class="tlaUNC">           0 :     g_object_set (object, prefix, str_dim, str_type_name, str_type,</span></span>
<span id="L738"><span class="lineNum">     738</span>              :         str_name_name, str_name, NULL);</span>
<span id="L739"><span class="lineNum">     739</span>              :   }</span>
<span id="L740"><span class="lineNum">     740</span>              : </span>
<span id="L741"><span class="lineNum">     741</span> <span class="tlaUNC">           0 :   g_free (str_dim);</span></span>
<span id="L742"><span class="lineNum">     742</span> <span class="tlaUNC">           0 :   g_free (str_type);</span></span>
<span id="L743"><span class="lineNum">     743</span> <span class="tlaUNC">           0 :   g_free (str_name);</span></span>
<span id="L744"><span class="lineNum">     744</span>              : </span>
<span id="L745"><span class="lineNum">     745</span> <span class="tlaUNC">           0 :   gst_tensors_info_free (&amp;info);</span></span>
<span id="L746"><span class="lineNum">     746</span>              : </span>
<span id="L747"><span class="lineNum">     747</span> <span class="tlaUNC">           0 :   return status;</span></span>
<span id="L748"><span class="lineNum">     748</span>              : }</span>
<span id="L749"><span class="lineNum">     749</span>              : </span>
<span id="L750"><span class="lineNum">     750</span>              : /**</span>
<span id="L751"><span class="lineNum">     751</span>              :  * @brief Internal static function to set tensors info in the handle.</span>
<span id="L752"><span class="lineNum">     752</span>              :  */</span>
<span id="L753"><span class="lineNum">     753</span>              : static gboolean</span>
<span id="L754"><span class="lineNum">     754</span> <span class="tlaGNC tlaBgGNC">         162 : ml_single_set_info_in_handle (ml_single_h single, gboolean is_input,</span></span>
<span id="L755"><span class="lineNum">     755</span>              :     ml_tensors_info_s * tensors_info)</span>
<span id="L756"><span class="lineNum">     756</span>              : {</span>
<span id="L757"><span class="lineNum">     757</span>              :   int status;</span>
<span id="L758"><span class="lineNum">     758</span>              :   ml_single *single_h;</span>
<span id="L759"><span class="lineNum">     759</span>              :   GstTensorsInfo *dest;</span>
<span id="L760"><span class="lineNum">     760</span> <span class="tlaGNC">         162 :   gboolean configured = FALSE;</span></span>
<span id="L761"><span class="lineNum">     761</span> <span class="tlaGNC">         162 :   gboolean is_valid = FALSE;</span></span>
<span id="L762"><span class="lineNum">     762</span>              :   GObject *filter_obj;</span>
<span id="L763"><span class="lineNum">     763</span>              : </span>
<span id="L764"><span class="lineNum">     764</span> <span class="tlaGNC">         162 :   single_h = (ml_single *) single;</span></span>
<span id="L765"><span class="lineNum">     765</span> <span class="tlaGNC">         162 :   filter_obj = G_OBJECT (single_h-&gt;filter);</span></span>
<span id="L766"><span class="lineNum">     766</span>              : </span>
<span id="L767"><span class="lineNum">     767</span> <span class="tlaGNC">         162 :   if (is_input) {</span></span>
<span id="L768"><span class="lineNum">     768</span> <span class="tlaGNC">          82 :     dest = &amp;single_h-&gt;in_info;</span></span>
<span id="L769"><span class="lineNum">     769</span> <span class="tlaGNC">          82 :     configured = single_h-&gt;klass-&gt;input_configured (single_h-&gt;filter);</span></span>
<span id="L770"><span class="lineNum">     770</span>              :   } else {</span>
<span id="L771"><span class="lineNum">     771</span> <span class="tlaGNC">          80 :     dest = &amp;single_h-&gt;out_info;</span></span>
<span id="L772"><span class="lineNum">     772</span> <span class="tlaGNC">          80 :     configured = single_h-&gt;klass-&gt;output_configured (single_h-&gt;filter);</span></span>
<span id="L773"><span class="lineNum">     773</span>              :   }</span>
<span id="L774"><span class="lineNum">     774</span>              : </span>
<span id="L775"><span class="lineNum">     775</span> <span class="tlaGNC">         162 :   if (configured) {</span></span>
<span id="L776"><span class="lineNum">     776</span>              :     /* get configured info and compare with input info */</span>
<span id="L777"><span class="lineNum">     777</span>              :     GstTensorsInfo gst_info;</span>
<span id="L778"><span class="lineNum">     778</span> <span class="tlaGNC">         162 :     ml_tensors_info_h info = NULL;</span></span>
<span id="L779"><span class="lineNum">     779</span>              : </span>
<span id="L780"><span class="lineNum">     780</span> <span class="tlaGNC">         162 :     ml_single_get_gst_info (single_h, is_input, &amp;gst_info);</span></span>
<span id="L781"><span class="lineNum">     781</span> <span class="tlaGNC">         162 :     _ml_tensors_info_create_from_gst (&amp;info, &amp;gst_info);</span></span>
<span id="L782"><span class="lineNum">     782</span>              : </span>
<span id="L783"><span class="lineNum">     783</span> <span class="tlaGNC">         162 :     gst_tensors_info_free (&amp;gst_info);</span></span>
<span id="L784"><span class="lineNum">     784</span>              : </span>
<span id="L785"><span class="lineNum">     785</span> <span class="tlaGNC">         162 :     if (tensors_info &amp;&amp; !ml_tensors_info_is_equal (tensors_info, info)) {</span></span>
<span id="L786"><span class="lineNum">     786</span>              :       /* given input info is not matched with configured */</span>
<span id="L787"><span class="lineNum">     787</span> <span class="tlaGNC">           5 :       ml_tensors_info_destroy (info);</span></span>
<span id="L788"><span class="lineNum">     788</span> <span class="tlaGNC">           5 :       if (is_input) {</span></span>
<span id="L789"><span class="lineNum">     789</span>              :         /* try to update tensors info */</span>
<span id="L790"><span class="lineNum">     790</span> <span class="tlaGNC">           3 :         status = ml_single_update_info (single, tensors_info, &amp;info);</span></span>
<span id="L791"><span class="lineNum">     791</span> <span class="tlaGNC">           3 :         if (status != ML_ERROR_NONE)</span></span>
<span id="L792"><span class="lineNum">     792</span> <span class="tlaGNC">           4 :           goto done;</span></span>
<span id="L793"><span class="lineNum">     793</span>              :       } else {</span>
<span id="L794"><span class="lineNum">     794</span> <span class="tlaGNC">           2 :         goto done;</span></span>
<span id="L795"><span class="lineNum">     795</span>              :       }</span>
<span id="L796"><span class="lineNum">     796</span>              :     }</span>
<span id="L797"><span class="lineNum">     797</span>              : </span>
<span id="L798"><span class="lineNum">     798</span> <span class="tlaGNC">         158 :     gst_tensors_info_free (dest);</span></span>
<span id="L799"><span class="lineNum">     799</span> <span class="tlaGNC">         158 :     _ml_tensors_info_copy_from_ml (dest, info);</span></span>
<span id="L800"><span class="lineNum">     800</span> <span class="tlaGNC">         158 :     ml_tensors_info_destroy (info);</span></span>
<span id="L801"><span class="lineNum">     801</span> <span class="tlaUNC tlaBgUNC">           0 :   } else if (tensors_info) {</span></span>
<span id="L802"><span class="lineNum">     802</span>              :     status =</span>
<span id="L803"><span class="lineNum">     803</span> <span class="tlaUNC">           0 :         ml_single_set_inout_tensors_info (filter_obj, is_input, tensors_info);</span></span>
<span id="L804"><span class="lineNum">     804</span> <span class="tlaUNC">           0 :     if (status != ML_ERROR_NONE)</span></span>
<span id="L805"><span class="lineNum">     805</span> <span class="tlaUNC">           0 :       goto done;</span></span>
<span id="L806"><span class="lineNum">     806</span>              : </span>
<span id="L807"><span class="lineNum">     807</span> <span class="tlaUNC">           0 :     gst_tensors_info_free (dest);</span></span>
<span id="L808"><span class="lineNum">     808</span> <span class="tlaUNC">           0 :     _ml_tensors_info_copy_from_ml (dest, tensors_info);</span></span>
<span id="L809"><span class="lineNum">     809</span>              :   }</span>
<span id="L810"><span class="lineNum">     810</span>              : </span>
<span id="L811"><span class="lineNum">     811</span> <span class="tlaGNC tlaBgGNC">         158 :   is_valid = gst_tensors_info_validate (dest);</span></span>
<span id="L812"><span class="lineNum">     812</span>              : </span>
<span id="L813"><span class="lineNum">     813</span> <span class="tlaGNC">         162 : done:</span></span>
<span id="L814"><span class="lineNum">     814</span> <span class="tlaGNC">         162 :   return is_valid;</span></span>
<span id="L815"><span class="lineNum">     815</span>              : }</span>
<span id="L816"><span class="lineNum">     816</span>              : </span>
<span id="L817"><span class="lineNum">     817</span>              : /**</span>
<span id="L818"><span class="lineNum">     818</span>              :  * @brief Internal function to create and initialize the single handle.</span>
<span id="L819"><span class="lineNum">     819</span>              :  */</span>
<span id="L820"><span class="lineNum">     820</span>              : static ml_single *</span>
<span id="L821"><span class="lineNum">     821</span> <span class="tlaGNC">          82 : ml_single_create_handle (ml_nnfw_type_e nnfw)</span></span>
<span id="L822"><span class="lineNum">     822</span>              : {</span>
<span id="L823"><span class="lineNum">     823</span>              :   ml_single *single_h;</span>
<span id="L824"><span class="lineNum">     824</span>              :   GError *error;</span>
<span id="L825"><span class="lineNum">     825</span> <span class="tlaGNC">          82 :   gboolean created = FALSE;</span></span>
<span id="L826"><span class="lineNum">     826</span>              : </span>
<span id="L827"><span class="lineNum">     827</span> <span class="tlaGNC">          82 :   single_h = g_new0 (ml_single, 1);</span></span>
<span id="L828"><span class="lineNum">     828</span> <span class="tlaGNC">          82 :   if (single_h == NULL)</span></span>
<span id="L829"><span class="lineNum">     829</span> <span class="tlaGNC">          82 :     _ml_error_report_return (NULL,</span></span>
<span id="L830"><span class="lineNum">     830</span>              :         &quot;Failed to allocate memory for the single_h handle. Out of memory?&quot;);</span>
<span id="L831"><span class="lineNum">     831</span>              : </span>
<span id="L832"><span class="lineNum">     832</span> <span class="tlaGNC">          82 :   single_h-&gt;filter = g_object_new (G_TYPE_TENSOR_FILTER_SINGLE, NULL);</span></span>
<span id="L833"><span class="lineNum">     833</span> <span class="tlaGNC">          82 :   if (single_h-&gt;filter == NULL) {</span></span>
<span id="L834"><span class="lineNum">     834</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report</span></span>
<span id="L835"><span class="lineNum">     835</span>              :         (&quot;Failed to create a new instance for filter. Out of memory?&quot;);</span>
<span id="L836"><span class="lineNum">     836</span> <span class="tlaUNC">           0 :     g_free (single_h);</span></span>
<span id="L837"><span class="lineNum">     837</span> <span class="tlaUNC">           0 :     return NULL;</span></span>
<span id="L838"><span class="lineNum">     838</span>              :   }</span>
<span id="L839"><span class="lineNum">     839</span>              : </span>
<span id="L840"><span class="lineNum">     840</span> <span class="tlaGNC tlaBgGNC">          82 :   single_h-&gt;magic = ML_SINGLE_MAGIC;</span></span>
<span id="L841"><span class="lineNum">     841</span> <span class="tlaGNC">          82 :   single_h-&gt;timeout = SINGLE_DEFAULT_TIMEOUT;</span></span>
<span id="L842"><span class="lineNum">     842</span> <span class="tlaGNC">          82 :   single_h-&gt;nnfw = nnfw;</span></span>
<span id="L843"><span class="lineNum">     843</span> <span class="tlaGNC">          82 :   single_h-&gt;state = IDLE;</span></span>
<span id="L844"><span class="lineNum">     844</span> <span class="tlaGNC">          82 :   single_h-&gt;thread = NULL;</span></span>
<span id="L845"><span class="lineNum">     845</span> <span class="tlaGNC">          82 :   single_h-&gt;input = NULL;</span></span>
<span id="L846"><span class="lineNum">     846</span> <span class="tlaGNC">          82 :   single_h-&gt;output = NULL;</span></span>
<span id="L847"><span class="lineNum">     847</span> <span class="tlaGNC">          82 :   single_h-&gt;destroy_data_list = NULL;</span></span>
<span id="L848"><span class="lineNum">     848</span> <span class="tlaGNC">          82 :   single_h-&gt;invoking = FALSE;</span></span>
<span id="L849"><span class="lineNum">     849</span>              : </span>
<span id="L850"><span class="lineNum">     850</span> <span class="tlaGNC">          82 :   gst_tensors_info_init (&amp;single_h-&gt;in_info);</span></span>
<span id="L851"><span class="lineNum">     851</span> <span class="tlaGNC">          82 :   gst_tensors_info_init (&amp;single_h-&gt;out_info);</span></span>
<span id="L852"><span class="lineNum">     852</span> <span class="tlaGNC">          82 :   g_mutex_init (&amp;single_h-&gt;mutex);</span></span>
<span id="L853"><span class="lineNum">     853</span> <span class="tlaGNC">          82 :   g_cond_init (&amp;single_h-&gt;cond);</span></span>
<span id="L854"><span class="lineNum">     854</span>              : </span>
<span id="L855"><span class="lineNum">     855</span> <span class="tlaGNC">          82 :   single_h-&gt;klass = g_type_class_ref (G_TYPE_TENSOR_FILTER_SINGLE);</span></span>
<span id="L856"><span class="lineNum">     856</span> <span class="tlaGNC">          82 :   if (single_h-&gt;klass == NULL) {</span></span>
<span id="L857"><span class="lineNum">     857</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report</span></span>
<span id="L858"><span class="lineNum">     858</span>              :         (&quot;Failed to get class of the tensor-filter of single API. This binary is not compiled properly or required libraries are not loaded.&quot;);</span>
<span id="L859"><span class="lineNum">     859</span> <span class="tlaUNC">           0 :     goto done;</span></span>
<span id="L860"><span class="lineNum">     860</span>              :   }</span>
<span id="L861"><span class="lineNum">     861</span>              : </span>
<span id="L862"><span class="lineNum">     862</span> <span class="tlaGNC tlaBgGNC">          82 :   single_h-&gt;thread =</span></span>
<span id="L863"><span class="lineNum">     863</span> <span class="tlaGNC">          82 :       g_thread_try_new (NULL, invoke_thread, (gpointer) single_h, &amp;error);</span></span>
<span id="L864"><span class="lineNum">     864</span> <span class="tlaGNC">          82 :   if (single_h-&gt;thread == NULL) {</span></span>
<span id="L865"><span class="lineNum">     865</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report</span></span>
<span id="L866"><span class="lineNum">     866</span>              :         (&quot;Failed to create the invoke thread of single API, g_thread_try_new has reported an error: %s.&quot;,</span>
<span id="L867"><span class="lineNum">     867</span>              :         error-&gt;message);</span>
<span id="L868"><span class="lineNum">     868</span> <span class="tlaUNC">           0 :     g_clear_error (&amp;error);</span></span>
<span id="L869"><span class="lineNum">     869</span> <span class="tlaUNC">           0 :     goto done;</span></span>
<span id="L870"><span class="lineNum">     870</span>              :   }</span>
<span id="L871"><span class="lineNum">     871</span>              : </span>
<span id="L872"><span class="lineNum">     872</span> <span class="tlaGNC tlaBgGNC">          82 :   created = TRUE;</span></span>
<span id="L873"><span class="lineNum">     873</span>              : </span>
<span id="L874"><span class="lineNum">     874</span> <span class="tlaGNC">          82 : done:</span></span>
<span id="L875"><span class="lineNum">     875</span> <span class="tlaGNC">          82 :   if (!created) {</span></span>
<span id="L876"><span class="lineNum">     876</span> <span class="tlaUNC tlaBgUNC">           0 :     ml_single_close (single_h);</span></span>
<span id="L877"><span class="lineNum">     877</span> <span class="tlaUNC">           0 :     single_h = NULL;</span></span>
<span id="L878"><span class="lineNum">     878</span>              :   }</span>
<span id="L879"><span class="lineNum">     879</span>              : </span>
<span id="L880"><span class="lineNum">     880</span> <span class="tlaGNC tlaBgGNC">          82 :   return single_h;</span></span>
<span id="L881"><span class="lineNum">     881</span>              : }</span>
<span id="L882"><span class="lineNum">     882</span>              : </span>
<span id="L883"><span class="lineNum">     883</span>              : /**</span>
<span id="L884"><span class="lineNum">     884</span>              :  * @brief Validate arguments for open</span>
<span id="L885"><span class="lineNum">     885</span>              :  */</span>
<span id="L886"><span class="lineNum">     886</span>              : static int</span>
<span id="L887"><span class="lineNum">     887</span> <span class="tlaGNC">          91 : _ml_single_open_custom_validate_arguments (ml_single_h * single,</span></span>
<span id="L888"><span class="lineNum">     888</span>              :     ml_single_preset * info)</span>
<span id="L889"><span class="lineNum">     889</span>              : {</span>
<span id="L890"><span class="lineNum">     890</span> <span class="tlaGNC">          91 :   if (!single)</span></span>
<span id="L891"><span class="lineNum">     891</span> <span class="tlaGNC">           1 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L892"><span class="lineNum">     892</span>              :         &quot;The parameter, 'single' (ml_single_h *), is NULL. It should be a valid pointer to an instance of ml_single_h.&quot;);</span>
<span id="L893"><span class="lineNum">     893</span> <span class="tlaGNC">          90 :   if (!info)</span></span>
<span id="L894"><span class="lineNum">     894</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L895"><span class="lineNum">     895</span>              :         &quot;The parameter, 'info' (ml_single_preset *), is NULL. It should be a valid pointer to a valid instance of ml_single_preset.&quot;);</span>
<span id="L896"><span class="lineNum">     896</span>              : </span>
<span id="L897"><span class="lineNum">     897</span>              :   /* Validate input tensor info. */</span>
<span id="L898"><span class="lineNum">     898</span> <span class="tlaGNC tlaBgGNC">          90 :   if (info-&gt;input_info &amp;&amp; !ml_tensors_info_is_valid (info-&gt;input_info))</span></span>
<span id="L899"><span class="lineNum">     899</span> <span class="tlaGNC">           1 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L900"><span class="lineNum">     900</span>              :         &quot;The parameter, 'info' (ml_single_preset *), is not valid. It has 'input_info' entry that cannot be validated. ml_tensors_info_is_valid(info-&gt;input_info) has failed while info-&gt;input_info exists.&quot;);</span>
<span id="L901"><span class="lineNum">     901</span>              : </span>
<span id="L902"><span class="lineNum">     902</span>              :   /* Validate output tensor info. */</span>
<span id="L903"><span class="lineNum">     903</span> <span class="tlaGNC">          89 :   if (info-&gt;output_info &amp;&amp; !ml_tensors_info_is_valid (info-&gt;output_info))</span></span>
<span id="L904"><span class="lineNum">     904</span> <span class="tlaGNC">           1 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L905"><span class="lineNum">     905</span>              :         &quot;The parameter, 'info' (ml_single_preset *), is not valid. It has 'output_info' entry that cannot be validated. ml_tensors_info_is_valid(info-&gt;output_info) has failed while info-&gt;output_info exists.&quot;);</span>
<span id="L906"><span class="lineNum">     906</span>              : </span>
<span id="L907"><span class="lineNum">     907</span> <span class="tlaGNC">          88 :   if (!info-&gt;models)</span></span>
<span id="L908"><span class="lineNum">     908</span> <span class="tlaGNC">           2 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L909"><span class="lineNum">     909</span>              :         &quot;The parameter, 'info' (ml_single_preset *), is not valid. Its models entry if NULL (info-&gt;models is NULL).&quot;);</span>
<span id="L910"><span class="lineNum">     910</span>              : </span>
<span id="L911"><span class="lineNum">     911</span> <span class="tlaGNC">          86 :   return ML_ERROR_NONE;</span></span>
<span id="L912"><span class="lineNum">     912</span>              : }</span>
<span id="L913"><span class="lineNum">     913</span>              : </span>
<span id="L914"><span class="lineNum">     914</span>              : /**</span>
<span id="L915"><span class="lineNum">     915</span>              :  * @brief Internal function to convert accelerator as tensor_filter property format.</span>
<span id="L916"><span class="lineNum">     916</span>              :  * @note returned value must be freed by the caller</span>
<span id="L917"><span class="lineNum">     917</span>              :  * @note More details on format can be found in gst_tensor_filter_install_properties() in tensor_filter_common.c.</span>
<span id="L918"><span class="lineNum">     918</span>              :  */</span>
<span id="L919"><span class="lineNum">     919</span>              : char *</span>
<span id="L920"><span class="lineNum">     920</span> <span class="tlaGNC">          82 : _ml_nnfw_to_str_prop (const ml_nnfw_hw_e hw)</span></span>
<span id="L921"><span class="lineNum">     921</span>              : {</span>
<span id="L922"><span class="lineNum">     922</span>              :   const gchar *hw_name;</span>
<span id="L923"><span class="lineNum">     923</span> <span class="tlaGNC">          82 :   const gchar *use_accl = &quot;true:&quot;;</span></span>
<span id="L924"><span class="lineNum">     924</span> <span class="tlaGNC">          82 :   gchar *str_prop = NULL;</span></span>
<span id="L925"><span class="lineNum">     925</span>              : </span>
<span id="L926"><span class="lineNum">     926</span> <span class="tlaGNC">          82 :   hw_name = get_accl_hw_str (_ml_nnfw_to_accl_hw (hw));</span></span>
<span id="L927"><span class="lineNum">     927</span> <span class="tlaGNC">          82 :   str_prop = g_strdup_printf (&quot;%s%s&quot;, use_accl, hw_name);</span></span>
<span id="L928"><span class="lineNum">     928</span>              : </span>
<span id="L929"><span class="lineNum">     929</span> <span class="tlaGNC">          82 :   return str_prop;</span></span>
<span id="L930"><span class="lineNum">     930</span>              : }</span>
<span id="L931"><span class="lineNum">     931</span>              : </span>
<span id="L932"><span class="lineNum">     932</span>              : /**</span>
<span id="L933"><span class="lineNum">     933</span>              :  * @brief Opens an ML model with the custom options and returns the instance as a handle.</span>
<span id="L934"><span class="lineNum">     934</span>              :  */</span>
<span id="L935"><span class="lineNum">     935</span>              : int</span>
<span id="L936"><span class="lineNum">     936</span> <span class="tlaGNC">          91 : ml_single_open_custom (ml_single_h * single, ml_single_preset * info)</span></span>
<span id="L937"><span class="lineNum">     937</span>              : {</span>
<span id="L938"><span class="lineNum">     938</span>              :   ml_single *single_h;</span>
<span id="L939"><span class="lineNum">     939</span>              :   GObject *filter_obj;</span>
<span id="L940"><span class="lineNum">     940</span> <span class="tlaGNC">          91 :   int status = ML_ERROR_NONE;</span></span>
<span id="L941"><span class="lineNum">     941</span>              :   ml_tensors_info_s *in_tensors_info, *out_tensors_info;</span>
<span id="L942"><span class="lineNum">     942</span>              :   ml_nnfw_type_e nnfw;</span>
<span id="L943"><span class="lineNum">     943</span>              :   ml_nnfw_hw_e hw;</span>
<span id="L944"><span class="lineNum">     944</span>              :   const gchar *fw_name;</span>
<span id="L945"><span class="lineNum">     945</span>              :   gchar **list_models;</span>
<span id="L946"><span class="lineNum">     946</span>              :   guint i, num_models;</span>
<span id="L947"><span class="lineNum">     947</span>              :   char *hw_name;</span>
<span id="L948"><span class="lineNum">     948</span>              : </span>
<span id="L949"><span class="lineNum">     949</span> <span class="tlaGNC">         182 :   check_feature_state (ML_FEATURE_INFERENCE);</span></span>
<span id="L950"><span class="lineNum">     950</span>              : </span>
<span id="L951"><span class="lineNum">     951</span>              :   /* Validate the params */</span>
<span id="L952"><span class="lineNum">     952</span> <span class="tlaGNC">          91 :   _ml_error_report_return_continue_iferr</span></span>
<span id="L953"><span class="lineNum">     953</span>              :       (_ml_single_open_custom_validate_arguments (single, info),</span>
<span id="L954"><span class="lineNum">     954</span>              :       &quot;The parameter, 'info' (ml_single_preset *), cannot be validated. Please provide valid information for this object.&quot;);</span>
<span id="L955"><span class="lineNum">     955</span>              : </span>
<span id="L956"><span class="lineNum">     956</span>              :   /* init null */</span>
<span id="L957"><span class="lineNum">     957</span> <span class="tlaGNC">          86 :   *single = NULL;</span></span>
<span id="L958"><span class="lineNum">     958</span>              : </span>
<span id="L959"><span class="lineNum">     959</span> <span class="tlaGNC">          86 :   in_tensors_info = (ml_tensors_info_s *) info-&gt;input_info;</span></span>
<span id="L960"><span class="lineNum">     960</span> <span class="tlaGNC">          86 :   out_tensors_info = (ml_tensors_info_s *) info-&gt;output_info;</span></span>
<span id="L961"><span class="lineNum">     961</span> <span class="tlaGNC">          86 :   nnfw = info-&gt;nnfw;</span></span>
<span id="L962"><span class="lineNum">     962</span> <span class="tlaGNC">          86 :   hw = info-&gt;hw;</span></span>
<span id="L963"><span class="lineNum">     963</span> <span class="tlaGNC">          86 :   fw_name = _ml_get_nnfw_subplugin_name (nnfw);</span></span>
<span id="L964"><span class="lineNum">     964</span>              : </span>
<span id="L965"><span class="lineNum">     965</span>              :   /**</span>
<span id="L966"><span class="lineNum">     966</span>              :    * 1. Determine nnfw and validate model file</span>
<span id="L967"><span class="lineNum">     967</span>              :    */</span>
<span id="L968"><span class="lineNum">     968</span> <span class="tlaGNC">          86 :   list_models = g_strsplit (info-&gt;models, &quot;,&quot;, -1);</span></span>
<span id="L969"><span class="lineNum">     969</span> <span class="tlaGNC">          86 :   num_models = g_strv_length (list_models);</span></span>
<span id="L970"><span class="lineNum">     970</span> <span class="tlaGNC">         172 :   for (i = 0; i &lt; num_models; i++)</span></span>
<span id="L971"><span class="lineNum">     971</span> <span class="tlaGNC">          86 :     g_strstrip (list_models[i]);</span></span>
<span id="L972"><span class="lineNum">     972</span>              : </span>
<span id="L973"><span class="lineNum">     973</span> <span class="tlaGNC">          86 :   status = _ml_validate_model_file ((const char **) list_models, num_models,</span></span>
<span id="L974"><span class="lineNum">     974</span>              :       &amp;nnfw);</span>
<span id="L975"><span class="lineNum">     975</span> <span class="tlaGNC">          86 :   if (status != ML_ERROR_NONE) {</span></span>
<span id="L976"><span class="lineNum">     976</span> <span class="tlaGNC">           4 :     _ml_error_report_continue</span></span>
<span id="L977"><span class="lineNum">     977</span>              :         (&quot;Cannot validate the model (1st model: %s. # models: %d). Error code: %d&quot;,</span>
<span id="L978"><span class="lineNum">     978</span>              :         list_models[0], num_models, status);</span>
<span id="L979"><span class="lineNum">     979</span> <span class="tlaGNC">           4 :     g_strfreev (list_models);</span></span>
<span id="L980"><span class="lineNum">     980</span> <span class="tlaGNC">           4 :     return status;</span></span>
<span id="L981"><span class="lineNum">     981</span>              :   }</span>
<span id="L982"><span class="lineNum">     982</span>              : </span>
<span id="L983"><span class="lineNum">     983</span> <span class="tlaGNC">          82 :   g_strfreev (list_models);</span></span>
<span id="L984"><span class="lineNum">     984</span>              : </span>
<span id="L985"><span class="lineNum">     985</span>              :   /**</span>
<span id="L986"><span class="lineNum">     986</span>              :    * 2. Determine hw</span>
<span id="L987"><span class="lineNum">     987</span>              :    * (Supposed CPU only) Support others later.</span>
<span id="L988"><span class="lineNum">     988</span>              :    */</span>
<span id="L989"><span class="lineNum">     989</span> <span class="tlaGNC">          82 :   if (!_ml_nnfw_is_available (nnfw, hw)) {</span></span>
<span id="L990"><span class="lineNum">     990</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_return (ML_ERROR_NOT_SUPPORTED,</span></span>
<span id="L991"><span class="lineNum">     991</span>              :         &quot;The given nnfw, '%s', is not supported. There is no corresponding tensor-filter subplugin available or the given hardware requirement is not supported for the given nnfw.&quot;,</span>
<span id="L992"><span class="lineNum">     992</span>              :         fw_name);</span>
<span id="L993"><span class="lineNum">     993</span>              :   }</span>
<span id="L994"><span class="lineNum">     994</span>              : </span>
<span id="L995"><span class="lineNum">     995</span>              :   /* Create ml_single object */</span>
<span id="L996"><span class="lineNum">     996</span> <span class="tlaGNC tlaBgGNC">          82 :   if ((single_h = ml_single_create_handle (nnfw)) == NULL) {</span></span>
<span id="L997"><span class="lineNum">     997</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_return_continue (ML_ERROR_OUT_OF_MEMORY,</span></span>
<span id="L998"><span class="lineNum">     998</span>              :         &quot;Cannot create handle for the given nnfw, %s&quot;, fw_name);</span>
<span id="L999"><span class="lineNum">     999</span>              :   }</span>
<span id="L1000"><span class="lineNum">    1000</span>              : </span>
<span id="L1001"><span class="lineNum">    1001</span> <span class="tlaGNC tlaBgGNC">          82 :   filter_obj = G_OBJECT (single_h-&gt;filter);</span></span>
<span id="L1002"><span class="lineNum">    1002</span>              : </span>
<span id="L1003"><span class="lineNum">    1003</span>              :   /**</span>
<span id="L1004"><span class="lineNum">    1004</span>              :    * 3. Construct a direct connection with the nnfw.</span>
<span id="L1005"><span class="lineNum">    1005</span>              :    * Note that we do not construct a pipeline since 2019.12.</span>
<span id="L1006"><span class="lineNum">    1006</span>              :    */</span>
<span id="L1007"><span class="lineNum">    1007</span> <span class="tlaGNC">          82 :   if (nnfw == ML_NNFW_TYPE_TENSORFLOW || nnfw == ML_NNFW_TYPE_SNAP ||</span></span>
<span id="L1008"><span class="lineNum">    1008</span> <span class="tlaGNC">          82 :       nnfw == ML_NNFW_TYPE_PYTORCH || nnfw == ML_NNFW_TYPE_TRIX_ENGINE ||</span></span>
<span id="L1009"><span class="lineNum">    1009</span> <span class="tlaGNC">          82 :       nnfw == ML_NNFW_TYPE_NCNN) {</span></span>
<span id="L1010"><span class="lineNum">    1010</span>              :     /* set input and output tensors information */</span>
<span id="L1011"><span class="lineNum">    1011</span> <span class="tlaUNC tlaBgUNC">           0 :     if (in_tensors_info &amp;&amp; out_tensors_info) {</span></span>
<span id="L1012"><span class="lineNum">    1012</span>              :       status =</span>
<span id="L1013"><span class="lineNum">    1013</span> <span class="tlaUNC">           0 :           ml_single_set_inout_tensors_info (filter_obj, TRUE, in_tensors_info);</span></span>
<span id="L1014"><span class="lineNum">    1014</span> <span class="tlaUNC">           0 :       if (status != ML_ERROR_NONE) {</span></span>
<span id="L1015"><span class="lineNum">    1015</span> <span class="tlaUNC">           0 :         _ml_error_report_continue</span></span>
<span id="L1016"><span class="lineNum">    1016</span>              :             (&quot;Input tensors info is given; however, failed to set input tensors info. Error code: %d&quot;,</span>
<span id="L1017"><span class="lineNum">    1017</span>              :             status);</span>
<span id="L1018"><span class="lineNum">    1018</span> <span class="tlaUNC">           0 :         goto error;</span></span>
<span id="L1019"><span class="lineNum">    1019</span>              :       }</span>
<span id="L1020"><span class="lineNum">    1020</span>              : </span>
<span id="L1021"><span class="lineNum">    1021</span>              :       status =</span>
<span id="L1022"><span class="lineNum">    1022</span> <span class="tlaUNC">           0 :           ml_single_set_inout_tensors_info (filter_obj, FALSE,</span></span>
<span id="L1023"><span class="lineNum">    1023</span>              :           out_tensors_info);</span>
<span id="L1024"><span class="lineNum">    1024</span> <span class="tlaUNC">           0 :       if (status != ML_ERROR_NONE) {</span></span>
<span id="L1025"><span class="lineNum">    1025</span> <span class="tlaUNC">           0 :         _ml_error_report_continue</span></span>
<span id="L1026"><span class="lineNum">    1026</span>              :             (&quot;Output tensors info is given; however, failed to set output tensors info. Error code: %d&quot;,</span>
<span id="L1027"><span class="lineNum">    1027</span>              :             status);</span>
<span id="L1028"><span class="lineNum">    1028</span> <span class="tlaUNC">           0 :         goto error;</span></span>
<span id="L1029"><span class="lineNum">    1029</span>              :       }</span>
<span id="L1030"><span class="lineNum">    1030</span>              :     } else {</span>
<span id="L1031"><span class="lineNum">    1031</span> <span class="tlaUNC">           0 :       _ml_error_report</span></span>
<span id="L1032"><span class="lineNum">    1032</span>              :           (&quot;To run the given nnfw, '%s', with a neural network model, both input and output information should be provided.&quot;,</span>
<span id="L1033"><span class="lineNum">    1033</span>              :           fw_name);</span>
<span id="L1034"><span class="lineNum">    1034</span> <span class="tlaUNC">           0 :       status = ML_ERROR_INVALID_PARAMETER;</span></span>
<span id="L1035"><span class="lineNum">    1035</span> <span class="tlaUNC">           0 :       goto error;</span></span>
<span id="L1036"><span class="lineNum">    1036</span>              :     }</span>
<span id="L1037"><span class="lineNum">    1037</span> <span class="tlaGNC tlaBgGNC">          82 :   } else if (nnfw == ML_NNFW_TYPE_ARMNN) {</span></span>
<span id="L1038"><span class="lineNum">    1038</span>              :     /* set input and output tensors information, if available */</span>
<span id="L1039"><span class="lineNum">    1039</span> <span class="tlaUNC tlaBgUNC">           0 :     if (in_tensors_info) {</span></span>
<span id="L1040"><span class="lineNum">    1040</span>              :       status =</span>
<span id="L1041"><span class="lineNum">    1041</span> <span class="tlaUNC">           0 :           ml_single_set_inout_tensors_info (filter_obj, TRUE, in_tensors_info);</span></span>
<span id="L1042"><span class="lineNum">    1042</span> <span class="tlaUNC">           0 :       if (status != ML_ERROR_NONE) {</span></span>
<span id="L1043"><span class="lineNum">    1043</span> <span class="tlaUNC">           0 :         _ml_error_report_continue</span></span>
<span id="L1044"><span class="lineNum">    1044</span>              :             (&quot;With nnfw '%s', input tensors info is optional. However, the user has provided an invalid input tensors info. Error code: %d&quot;,</span>
<span id="L1045"><span class="lineNum">    1045</span>              :             fw_name, status);</span>
<span id="L1046"><span class="lineNum">    1046</span> <span class="tlaUNC">           0 :         goto error;</span></span>
<span id="L1047"><span class="lineNum">    1047</span>              :       }</span>
<span id="L1048"><span class="lineNum">    1048</span>              :     }</span>
<span id="L1049"><span class="lineNum">    1049</span> <span class="tlaUNC">           0 :     if (out_tensors_info) {</span></span>
<span id="L1050"><span class="lineNum">    1050</span>              :       status =</span>
<span id="L1051"><span class="lineNum">    1051</span> <span class="tlaUNC">           0 :           ml_single_set_inout_tensors_info (filter_obj, FALSE,</span></span>
<span id="L1052"><span class="lineNum">    1052</span>              :           out_tensors_info);</span>
<span id="L1053"><span class="lineNum">    1053</span> <span class="tlaUNC">           0 :       if (status != ML_ERROR_NONE) {</span></span>
<span id="L1054"><span class="lineNum">    1054</span> <span class="tlaUNC">           0 :         _ml_error_report_continue</span></span>
<span id="L1055"><span class="lineNum">    1055</span>              :             (&quot;With nnfw '%s', output tensors info is optional. However, the user has provided an invalid output tensors info. Error code: %d&quot;,</span>
<span id="L1056"><span class="lineNum">    1056</span>              :             fw_name, status);</span>
<span id="L1057"><span class="lineNum">    1057</span> <span class="tlaUNC">           0 :         goto error;</span></span>
<span id="L1058"><span class="lineNum">    1058</span>              :       }</span>
<span id="L1059"><span class="lineNum">    1059</span>              :     }</span>
<span id="L1060"><span class="lineNum">    1060</span>              :   }</span>
<span id="L1061"><span class="lineNum">    1061</span>              : </span>
<span id="L1062"><span class="lineNum">    1062</span>              :   /* set accelerator, framework, model files and custom option */</span>
<span id="L1063"><span class="lineNum">    1063</span> <span class="tlaGNC tlaBgGNC">          82 :   if (info-&gt;fw_name) {</span></span>
<span id="L1064"><span class="lineNum">    1064</span> <span class="tlaGNC">          33 :     fw_name = (const char *) info-&gt;fw_name;</span></span>
<span id="L1065"><span class="lineNum">    1065</span>              :   } else {</span>
<span id="L1066"><span class="lineNum">    1066</span> <span class="tlaGNC">          49 :     fw_name = _ml_get_nnfw_subplugin_name (nnfw);       /* retry for &quot;auto&quot; */</span></span>
<span id="L1067"><span class="lineNum">    1067</span>              :   }</span>
<span id="L1068"><span class="lineNum">    1068</span> <span class="tlaGNC">          82 :   hw_name = _ml_nnfw_to_str_prop (hw);</span></span>
<span id="L1069"><span class="lineNum">    1069</span> <span class="tlaGNC">          82 :   g_object_set (filter_obj, &quot;framework&quot;, fw_name, &quot;accelerator&quot;, hw_name,</span></span>
<span id="L1070"><span class="lineNum">    1070</span>              :       &quot;model&quot;, info-&gt;models, NULL);</span>
<span id="L1071"><span class="lineNum">    1071</span> <span class="tlaGNC">          82 :   g_free (hw_name);</span></span>
<span id="L1072"><span class="lineNum">    1072</span>              : </span>
<span id="L1073"><span class="lineNum">    1073</span> <span class="tlaGNC">          82 :   if (info-&gt;custom_option) {</span></span>
<span id="L1074"><span class="lineNum">    1074</span> <span class="tlaUNC tlaBgUNC">           0 :     g_object_set (filter_obj, &quot;custom&quot;, info-&gt;custom_option, NULL);</span></span>
<span id="L1075"><span class="lineNum">    1075</span>              :   }</span>
<span id="L1076"><span class="lineNum">    1076</span>              : </span>
<span id="L1077"><span class="lineNum">    1077</span>              :   /* 4. Start the nnfw to get inout configurations if needed */</span>
<span id="L1078"><span class="lineNum">    1078</span> <span class="tlaGNC tlaBgGNC">          82 :   if (!single_h-&gt;klass-&gt;start (single_h-&gt;filter)) {</span></span>
<span id="L1079"><span class="lineNum">    1079</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report</span></span>
<span id="L1080"><span class="lineNum">    1080</span>              :         (&quot;Failed to start NNFW, '%s', to get inout configurations. Subplugin class method has failed to start.&quot;,</span>
<span id="L1081"><span class="lineNum">    1081</span>              :         fw_name);</span>
<span id="L1082"><span class="lineNum">    1082</span> <span class="tlaUNC">           0 :     status = ML_ERROR_STREAMS_PIPE;</span></span>
<span id="L1083"><span class="lineNum">    1083</span> <span class="tlaUNC">           0 :     goto error;</span></span>
<span id="L1084"><span class="lineNum">    1084</span>              :   }</span>
<span id="L1085"><span class="lineNum">    1085</span>              : </span>
<span id="L1086"><span class="lineNum">    1086</span> <span class="tlaGNC tlaBgGNC">          82 :   if (nnfw == ML_NNFW_TYPE_NNTR_INF) {</span></span>
<span id="L1087"><span class="lineNum">    1087</span> <span class="tlaUNC tlaBgUNC">           0 :     if (!in_tensors_info || !out_tensors_info) {</span></span>
<span id="L1088"><span class="lineNum">    1088</span> <span class="tlaUNC">           0 :       if (!in_tensors_info) {</span></span>
<span id="L1089"><span class="lineNum">    1089</span>              :         GstTensorsInfo in_info;</span>
<span id="L1090"><span class="lineNum">    1090</span>              : </span>
<span id="L1091"><span class="lineNum">    1091</span> <span class="tlaUNC">           0 :         gst_tensors_info_init (&amp;in_info);</span></span>
<span id="L1092"><span class="lineNum">    1092</span>              : </span>
<span id="L1093"><span class="lineNum">    1093</span>              :         /* ml_single_set_input_info() can't be done as it checks num_tensors */</span>
<span id="L1094"><span class="lineNum">    1094</span> <span class="tlaUNC">           0 :         status = ml_single_set_gst_info (single_h, &amp;in_info);</span></span>
<span id="L1095"><span class="lineNum">    1095</span> <span class="tlaUNC">           0 :         if (status != ML_ERROR_NONE) {</span></span>
<span id="L1096"><span class="lineNum">    1096</span> <span class="tlaUNC">           0 :           _ml_error_report_continue</span></span>
<span id="L1097"><span class="lineNum">    1097</span>              :               (&quot;NNTrainer-inference-single cannot configure single_h handle instance with the given in_info. This might be an ML-API / NNTrainer internal error. Error Code: %d&quot;,</span>
<span id="L1098"><span class="lineNum">    1098</span>              :               status);</span>
<span id="L1099"><span class="lineNum">    1099</span> <span class="tlaUNC">           0 :           goto error;</span></span>
<span id="L1100"><span class="lineNum">    1100</span>              :         }</span>
<span id="L1101"><span class="lineNum">    1101</span>              :       } else {</span>
<span id="L1102"><span class="lineNum">    1102</span> <span class="tlaUNC">           0 :         status = ml_single_set_input_info (single_h, in_tensors_info);</span></span>
<span id="L1103"><span class="lineNum">    1103</span> <span class="tlaUNC">           0 :         if (status != ML_ERROR_NONE) {</span></span>
<span id="L1104"><span class="lineNum">    1104</span> <span class="tlaUNC">           0 :           _ml_error_report_continue</span></span>
<span id="L1105"><span class="lineNum">    1105</span>              :               (&quot;NNTrainer-inference-single cannot configure single_h handle instance with the given in_info from the user. Error code: %d&quot;,</span>
<span id="L1106"><span class="lineNum">    1106</span>              :               status);</span>
<span id="L1107"><span class="lineNum">    1107</span> <span class="tlaUNC">           0 :           goto error;</span></span>
<span id="L1108"><span class="lineNum">    1108</span>              :         }</span>
<span id="L1109"><span class="lineNum">    1109</span>              :       }</span>
<span id="L1110"><span class="lineNum">    1110</span>              :     }</span>
<span id="L1111"><span class="lineNum">    1111</span>              :   }</span>
<span id="L1112"><span class="lineNum">    1112</span>              : </span>
<span id="L1113"><span class="lineNum">    1113</span>              :   /* 5. Set in/out configs and metadata */</span>
<span id="L1114"><span class="lineNum">    1114</span> <span class="tlaGNC tlaBgGNC">          82 :   if (!ml_single_set_info_in_handle (single_h, TRUE, in_tensors_info)) {</span></span>
<span id="L1115"><span class="lineNum">    1115</span> <span class="tlaGNC">           2 :     _ml_error_report</span></span>
<span id="L1116"><span class="lineNum">    1116</span>              :         (&quot;The input tensors info is invalid. Cannot configure single_h handle with the given input tensors info.&quot;);</span>
<span id="L1117"><span class="lineNum">    1117</span> <span class="tlaGNC">           2 :     status = ML_ERROR_INVALID_PARAMETER;</span></span>
<span id="L1118"><span class="lineNum">    1118</span> <span class="tlaGNC">           2 :     goto error;</span></span>
<span id="L1119"><span class="lineNum">    1119</span>              :   }</span>
<span id="L1120"><span class="lineNum">    1120</span>              : </span>
<span id="L1121"><span class="lineNum">    1121</span> <span class="tlaGNC">          80 :   if (!ml_single_set_info_in_handle (single_h, FALSE, out_tensors_info)) {</span></span>
<span id="L1122"><span class="lineNum">    1122</span> <span class="tlaGNC">           2 :     _ml_error_report</span></span>
<span id="L1123"><span class="lineNum">    1123</span>              :         (&quot;The output tensors info is invalid. Cannot configure single_h handle with the given output tensors info.&quot;);</span>
<span id="L1124"><span class="lineNum">    1124</span> <span class="tlaGNC">           2 :     status = ML_ERROR_INVALID_PARAMETER;</span></span>
<span id="L1125"><span class="lineNum">    1125</span> <span class="tlaGNC">           2 :     goto error;</span></span>
<span id="L1126"><span class="lineNum">    1126</span>              :   }</span>
<span id="L1127"><span class="lineNum">    1127</span>              : </span>
<span id="L1128"><span class="lineNum">    1128</span>              :   /* Setup input and output memory buffers for invoke */</span>
<span id="L1129"><span class="lineNum">    1129</span> <span class="tlaGNC">          78 :   __setup_in_out_tensors (single_h);</span></span>
<span id="L1130"><span class="lineNum">    1130</span>              : </span>
<span id="L1131"><span class="lineNum">    1131</span> <span class="tlaGNC">          78 :   *single = single_h;</span></span>
<span id="L1132"><span class="lineNum">    1132</span> <span class="tlaGNC">          78 :   return ML_ERROR_NONE;</span></span>
<span id="L1133"><span class="lineNum">    1133</span>              : </span>
<span id="L1134"><span class="lineNum">    1134</span> <span class="tlaGNC">           4 : error:</span></span>
<span id="L1135"><span class="lineNum">    1135</span> <span class="tlaGNC">           4 :   ml_single_close (single_h);</span></span>
<span id="L1136"><span class="lineNum">    1136</span> <span class="tlaGNC">           4 :   return status;</span></span>
<span id="L1137"><span class="lineNum">    1137</span>              : }</span>
<span id="L1138"><span class="lineNum">    1138</span>              : </span>
<span id="L1139"><span class="lineNum">    1139</span>              : /**</span>
<span id="L1140"><span class="lineNum">    1140</span>              :  * @brief Opens an ML model and returns the instance as a handle.</span>
<span id="L1141"><span class="lineNum">    1141</span>              :  */</span>
<span id="L1142"><span class="lineNum">    1142</span>              : int</span>
<span id="L1143"><span class="lineNum">    1143</span> <span class="tlaGNC">          53 : ml_single_open (ml_single_h * single, const char *model,</span></span>
<span id="L1144"><span class="lineNum">    1144</span>              :     const ml_tensors_info_h input_info, const ml_tensors_info_h output_info,</span>
<span id="L1145"><span class="lineNum">    1145</span>              :     ml_nnfw_type_e nnfw, ml_nnfw_hw_e hw)</span>
<span id="L1146"><span class="lineNum">    1146</span>              : {</span>
<span id="L1147"><span class="lineNum">    1147</span> <span class="tlaGNC">          53 :   return ml_single_open_full (single, model, input_info, output_info, nnfw, hw,</span></span>
<span id="L1148"><span class="lineNum">    1148</span>              :       NULL);</span>
<span id="L1149"><span class="lineNum">    1149</span>              : }</span>
<span id="L1150"><span class="lineNum">    1150</span>              : </span>
<span id="L1151"><span class="lineNum">    1151</span>              : /**</span>
<span id="L1152"><span class="lineNum">    1152</span>              :  * @brief Opens an ML model and returns the instance as a handle.</span>
<span id="L1153"><span class="lineNum">    1153</span>              :  */</span>
<span id="L1154"><span class="lineNum">    1154</span>              : int</span>
<span id="L1155"><span class="lineNum">    1155</span> <span class="tlaGNC">          53 : ml_single_open_full (ml_single_h * single, const char *model,</span></span>
<span id="L1156"><span class="lineNum">    1156</span>              :     const ml_tensors_info_h input_info, const ml_tensors_info_h output_info,</span>
<span id="L1157"><span class="lineNum">    1157</span>              :     ml_nnfw_type_e nnfw, ml_nnfw_hw_e hw, const char *custom_option)</span>
<span id="L1158"><span class="lineNum">    1158</span>              : {</span>
<span id="L1159"><span class="lineNum">    1159</span> <span class="tlaGNC">          53 :   ml_single_preset info = { 0, };</span></span>
<span id="L1160"><span class="lineNum">    1160</span>              : </span>
<span id="L1161"><span class="lineNum">    1161</span> <span class="tlaGNC">          53 :   info.input_info = input_info;</span></span>
<span id="L1162"><span class="lineNum">    1162</span> <span class="tlaGNC">          53 :   info.output_info = output_info;</span></span>
<span id="L1163"><span class="lineNum">    1163</span> <span class="tlaGNC">          53 :   info.nnfw = nnfw;</span></span>
<span id="L1164"><span class="lineNum">    1164</span> <span class="tlaGNC">          53 :   info.hw = hw;</span></span>
<span id="L1165"><span class="lineNum">    1165</span> <span class="tlaGNC">          53 :   info.models = (char *) model;</span></span>
<span id="L1166"><span class="lineNum">    1166</span> <span class="tlaGNC">          53 :   info.custom_option = (char *) custom_option;</span></span>
<span id="L1167"><span class="lineNum">    1167</span>              : </span>
<span id="L1168"><span class="lineNum">    1168</span> <span class="tlaGNC">          53 :   return ml_single_open_custom (single, &amp;info);</span></span>
<span id="L1169"><span class="lineNum">    1169</span>              : }</span>
<span id="L1170"><span class="lineNum">    1170</span>              : </span>
<span id="L1171"><span class="lineNum">    1171</span>              : /**</span>
<span id="L1172"><span class="lineNum">    1172</span>              :  * @brief Open new single handle with given option.</span>
<span id="L1173"><span class="lineNum">    1173</span>              :  */</span>
<span id="L1174"><span class="lineNum">    1174</span>              : int</span>
<span id="L1175"><span class="lineNum">    1175</span> <span class="tlaGNC">          39 : ml_single_open_with_option (ml_single_h * single, const ml_option_h option)</span></span>
<span id="L1176"><span class="lineNum">    1176</span>              : {</span>
<span id="L1177"><span class="lineNum">    1177</span>              :   void *value;</span>
<span id="L1178"><span class="lineNum">    1178</span> <span class="tlaGNC">          39 :   ml_single_preset info = { 0, };</span></span>
<span id="L1179"><span class="lineNum">    1179</span>              : </span>
<span id="L1180"><span class="lineNum">    1180</span> <span class="tlaGNC">          78 :   check_feature_state (ML_FEATURE_INFERENCE);</span></span>
<span id="L1181"><span class="lineNum">    1181</span>              : </span>
<span id="L1182"><span class="lineNum">    1182</span> <span class="tlaGNC">          39 :   if (!option) {</span></span>
<span id="L1183"><span class="lineNum">    1183</span> <span class="tlaGNC">           1 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1184"><span class="lineNum">    1184</span>              :         &quot;The parameter, 'option' is NULL. It should be a valid ml_option_h, which should be created by ml_option_create().&quot;);</span>
<span id="L1185"><span class="lineNum">    1185</span>              :   }</span>
<span id="L1186"><span class="lineNum">    1186</span>              : </span>
<span id="L1187"><span class="lineNum">    1187</span> <span class="tlaGNC">          38 :   if (!single)</span></span>
<span id="L1188"><span class="lineNum">    1188</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1189"><span class="lineNum">    1189</span>              :         &quot;The parameter, 'single' (ml_single_h), is NULL. It should be a valid ml_single_h instance, usually created by ml_single_open().&quot;);</span>
<span id="L1190"><span class="lineNum">    1190</span>              : </span>
<span id="L1191"><span class="lineNum">    1191</span> <span class="tlaGNC tlaBgGNC">          38 :   if (ML_ERROR_NONE == ml_option_get (option, &quot;input_info&quot;, &amp;value))</span></span>
<span id="L1192"><span class="lineNum">    1192</span> <span class="tlaGNC">          16 :     info.input_info = value;</span></span>
<span id="L1193"><span class="lineNum">    1193</span> <span class="tlaGNC">          38 :   if (ML_ERROR_NONE == ml_option_get (option, &quot;output_info&quot;, &amp;value))</span></span>
<span id="L1194"><span class="lineNum">    1194</span> <span class="tlaGNC">          16 :     info.output_info = value;</span></span>
<span id="L1195"><span class="lineNum">    1195</span> <span class="tlaGNC">          38 :   if (ML_ERROR_NONE == ml_option_get (option, &quot;nnfw&quot;, &amp;value))</span></span>
<span id="L1196"><span class="lineNum">    1196</span> <span class="tlaGNC">           2 :     info.nnfw = *((ml_nnfw_type_e *) value);</span></span>
<span id="L1197"><span class="lineNum">    1197</span> <span class="tlaGNC">          38 :   if (ML_ERROR_NONE == ml_option_get (option, &quot;hw&quot;, &amp;value))</span></span>
<span id="L1198"><span class="lineNum">    1198</span> <span class="tlaUNC tlaBgUNC">           0 :     info.hw = *((ml_nnfw_hw_e *) value);</span></span>
<span id="L1199"><span class="lineNum">    1199</span> <span class="tlaGNC tlaBgGNC">          38 :   if (ML_ERROR_NONE == ml_option_get (option, &quot;models&quot;, &amp;value))</span></span>
<span id="L1200"><span class="lineNum">    1200</span> <span class="tlaGNC">          37 :     info.models = (gchar *) value;</span></span>
<span id="L1201"><span class="lineNum">    1201</span> <span class="tlaGNC">          38 :   if (ML_ERROR_NONE == ml_option_get (option, &quot;custom&quot;, &amp;value))</span></span>
<span id="L1202"><span class="lineNum">    1202</span> <span class="tlaUNC tlaBgUNC">           0 :     info.custom_option = (gchar *) value;</span></span>
<span id="L1203"><span class="lineNum">    1203</span> <span class="tlaGNC tlaBgGNC">          38 :   if (ML_ERROR_NONE == ml_option_get (option, &quot;framework_name&quot;, &amp;value) ||</span></span>
<span id="L1204"><span class="lineNum">    1204</span> <span class="tlaGNC">           5 :       ML_ERROR_NONE == ml_option_get (option, &quot;framework&quot;, &amp;value))</span></span>
<span id="L1205"><span class="lineNum">    1205</span> <span class="tlaGNC">          33 :     info.fw_name = (gchar *) value;</span></span>
<span id="L1206"><span class="lineNum">    1206</span>              : </span>
<span id="L1207"><span class="lineNum">    1207</span> <span class="tlaGNC">          38 :   return ml_single_open_custom (single, &amp;info);</span></span>
<span id="L1208"><span class="lineNum">    1208</span>              : }</span>
<span id="L1209"><span class="lineNum">    1209</span>              : </span>
<span id="L1210"><span class="lineNum">    1210</span>              : /**</span>
<span id="L1211"><span class="lineNum">    1211</span>              :  * @brief Closes the opened model handle.</span>
<span id="L1212"><span class="lineNum">    1212</span>              :  *</span>
<span id="L1213"><span class="lineNum">    1213</span>              :  * @details State changes performed by this function:</span>
<span id="L1214"><span class="lineNum">    1214</span>              :  *          ANY STATE -&gt; JOIN REQUESTED - on receiving a request to close</span>
<span id="L1215"><span class="lineNum">    1215</span>              :  *</span>
<span id="L1216"><span class="lineNum">    1216</span>              :  *          Once requested to close, invoke_thread() will exit after processing</span>
<span id="L1217"><span class="lineNum">    1217</span>              :  *          the current input (if any).</span>
<span id="L1218"><span class="lineNum">    1218</span>              :  */</span>
<span id="L1219"><span class="lineNum">    1219</span>              : int</span>
<span id="L1220"><span class="lineNum">    1220</span> <span class="tlaGNC">          82 : ml_single_close (ml_single_h single)</span></span>
<span id="L1221"><span class="lineNum">    1221</span>              : {</span>
<span id="L1222"><span class="lineNum">    1222</span>              :   ml_single *single_h;</span>
<span id="L1223"><span class="lineNum">    1223</span>              :   gboolean invoking;</span>
<span id="L1224"><span class="lineNum">    1224</span>              : </span>
<span id="L1225"><span class="lineNum">    1225</span> <span class="tlaGNC">          82 :   check_feature_state (ML_FEATURE_INFERENCE);</span></span>
<span id="L1226"><span class="lineNum">    1226</span>              : </span>
<span id="L1227"><span class="lineNum">    1227</span> <span class="tlaGNC">          82 :   if (!single)</span></span>
<span id="L1228"><span class="lineNum">    1228</span> <span class="tlaGNC">           1 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1229"><span class="lineNum">    1229</span>              :         &quot;The parameter, 'single' (ml_single_h), is NULL. It should be a valid ml_single_h instance, usually created by ml_single_open().&quot;);</span>
<span id="L1230"><span class="lineNum">    1230</span>              : </span>
<span id="L1231"><span class="lineNum">    1231</span> <span class="tlaGNC">          81 :   ML_SINGLE_GET_VALID_HANDLE_LOCKED (single_h, single, 1);</span></span>
<span id="L1232"><span class="lineNum">    1232</span>              : </span>
<span id="L1233"><span class="lineNum">    1233</span> <span class="tlaGNC">          80 :   single_h-&gt;state = JOIN_REQUESTED;</span></span>
<span id="L1234"><span class="lineNum">    1234</span> <span class="tlaGNC">          80 :   g_cond_broadcast (&amp;single_h-&gt;cond);</span></span>
<span id="L1235"><span class="lineNum">    1235</span> <span class="tlaGNC">          80 :   invoking = single_h-&gt;invoking;</span></span>
<span id="L1236"><span class="lineNum">    1236</span> <span class="tlaGNC">          80 :   ML_SINGLE_HANDLE_UNLOCK (single_h);</span></span>
<span id="L1237"><span class="lineNum">    1237</span>              : </span>
<span id="L1238"><span class="lineNum">    1238</span>              :   /** Wait until invoke process is finished */</span>
<span id="L1239"><span class="lineNum">    1239</span> <span class="tlaGNC">         406 :   while (invoking) {</span></span>
<span id="L1240"><span class="lineNum">    1240</span> <span class="tlaGNC">         326 :     _ml_logd (&quot;Wait 1 ms until invoke is finished and close the handle.&quot;);</span></span>
<span id="L1241"><span class="lineNum">    1241</span> <span class="tlaGNC">         326 :     g_usleep (1000);</span></span>
<span id="L1242"><span class="lineNum">    1242</span> <span class="tlaGNC">         326 :     invoking = single_h-&gt;invoking;</span></span>
<span id="L1243"><span class="lineNum">    1243</span>              :     /**</span>
<span id="L1244"><span class="lineNum">    1244</span>              :      * single_h-&gt;invoking is the only protected value here and we are</span>
<span id="L1245"><span class="lineNum">    1245</span>              :      * doing a read-only operation and do not need to project its value</span>
<span id="L1246"><span class="lineNum">    1246</span>              :      * after the assignment.</span>
<span id="L1247"><span class="lineNum">    1247</span>              :      * Thus, we do not need to lock single_h here.</span>
<span id="L1248"><span class="lineNum">    1248</span>              :      */</span>
<span id="L1249"><span class="lineNum">    1249</span>              :   }</span>
<span id="L1250"><span class="lineNum">    1250</span>              : </span>
<span id="L1251"><span class="lineNum">    1251</span> <span class="tlaGNC">          80 :   if (single_h-&gt;thread != NULL)</span></span>
<span id="L1252"><span class="lineNum">    1252</span> <span class="tlaGNC">          80 :     g_thread_join (single_h-&gt;thread);</span></span>
<span id="L1253"><span class="lineNum">    1253</span>              : </span>
<span id="L1254"><span class="lineNum">    1254</span>              :   /** locking ensures correctness with parallel calls on close */</span>
<span id="L1255"><span class="lineNum">    1255</span> <span class="tlaGNC">          80 :   if (single_h-&gt;filter) {</span></span>
<span id="L1256"><span class="lineNum">    1256</span> <span class="tlaGNC">          80 :     g_list_foreach (single_h-&gt;destroy_data_list, __destroy_notify, single_h);</span></span>
<span id="L1257"><span class="lineNum">    1257</span> <span class="tlaGNC">          80 :     g_list_free (single_h-&gt;destroy_data_list);</span></span>
<span id="L1258"><span class="lineNum">    1258</span>              : </span>
<span id="L1259"><span class="lineNum">    1259</span> <span class="tlaGNC">          80 :     if (single_h-&gt;klass)</span></span>
<span id="L1260"><span class="lineNum">    1260</span> <span class="tlaGNC">          80 :       single_h-&gt;klass-&gt;stop (single_h-&gt;filter);</span></span>
<span id="L1261"><span class="lineNum">    1261</span>              : </span>
<span id="L1262"><span class="lineNum">    1262</span> <span class="tlaGNC">          80 :     g_object_unref (single_h-&gt;filter);</span></span>
<span id="L1263"><span class="lineNum">    1263</span> <span class="tlaGNC">          80 :     single_h-&gt;filter = NULL;</span></span>
<span id="L1264"><span class="lineNum">    1264</span>              :   }</span>
<span id="L1265"><span class="lineNum">    1265</span>              : </span>
<span id="L1266"><span class="lineNum">    1266</span> <span class="tlaGNC">          80 :   if (single_h-&gt;klass) {</span></span>
<span id="L1267"><span class="lineNum">    1267</span> <span class="tlaGNC">          80 :     g_type_class_unref (single_h-&gt;klass);</span></span>
<span id="L1268"><span class="lineNum">    1268</span> <span class="tlaGNC">          80 :     single_h-&gt;klass = NULL;</span></span>
<span id="L1269"><span class="lineNum">    1269</span>              :   }</span>
<span id="L1270"><span class="lineNum">    1270</span>              : </span>
<span id="L1271"><span class="lineNum">    1271</span> <span class="tlaGNC">          80 :   gst_tensors_info_free (&amp;single_h-&gt;in_info);</span></span>
<span id="L1272"><span class="lineNum">    1272</span> <span class="tlaGNC">          80 :   gst_tensors_info_free (&amp;single_h-&gt;out_info);</span></span>
<span id="L1273"><span class="lineNum">    1273</span>              : </span>
<span id="L1274"><span class="lineNum">    1274</span> <span class="tlaGNC">          80 :   ml_tensors_data_destroy (single_h-&gt;in_tensors);</span></span>
<span id="L1275"><span class="lineNum">    1275</span> <span class="tlaGNC">          80 :   ml_tensors_data_destroy (single_h-&gt;out_tensors);</span></span>
<span id="L1276"><span class="lineNum">    1276</span>              : </span>
<span id="L1277"><span class="lineNum">    1277</span> <span class="tlaGNC">          80 :   g_cond_clear (&amp;single_h-&gt;cond);</span></span>
<span id="L1278"><span class="lineNum">    1278</span> <span class="tlaGNC">          80 :   g_mutex_clear (&amp;single_h-&gt;mutex);</span></span>
<span id="L1279"><span class="lineNum">    1279</span>              : </span>
<span id="L1280"><span class="lineNum">    1280</span> <span class="tlaGNC">          80 :   g_free (single_h);</span></span>
<span id="L1281"><span class="lineNum">    1281</span> <span class="tlaGNC">          80 :   return ML_ERROR_NONE;</span></span>
<span id="L1282"><span class="lineNum">    1282</span>              : }</span>
<span id="L1283"><span class="lineNum">    1283</span>              : </span>
<span id="L1284"><span class="lineNum">    1284</span>              : /**</span>
<span id="L1285"><span class="lineNum">    1285</span>              :  * @brief Internal function to validate input/output data.</span>
<span id="L1286"><span class="lineNum">    1286</span>              :  */</span>
<span id="L1287"><span class="lineNum">    1287</span>              : static int</span>
<span id="L1288"><span class="lineNum">    1288</span> <span class="tlaGNC">          94 : _ml_single_invoke_validate_data (ml_single_h single,</span></span>
<span id="L1289"><span class="lineNum">    1289</span>              :     const ml_tensors_data_h data, const gboolean is_input)</span>
<span id="L1290"><span class="lineNum">    1290</span>              : {</span>
<span id="L1291"><span class="lineNum">    1291</span>              :   ml_single *single_h;</span>
<span id="L1292"><span class="lineNum">    1292</span>              :   ml_tensors_data_s *_data;</span>
<span id="L1293"><span class="lineNum">    1293</span>              :   ml_tensors_data_s *_model;</span>
<span id="L1294"><span class="lineNum">    1294</span>              :   guint i;</span>
<span id="L1295"><span class="lineNum">    1295</span>              :   size_t raw_size;</span>
<span id="L1296"><span class="lineNum">    1296</span>              : </span>
<span id="L1297"><span class="lineNum">    1297</span> <span class="tlaGNC">          94 :   single_h = (ml_single *) single;</span></span>
<span id="L1298"><span class="lineNum">    1298</span> <span class="tlaGNC">          94 :   _data = (ml_tensors_data_s *) data;</span></span>
<span id="L1299"><span class="lineNum">    1299</span>              : </span>
<span id="L1300"><span class="lineNum">    1300</span> <span class="tlaGNC">          94 :   if (G_UNLIKELY (!_data))</span></span>
<span id="L1301"><span class="lineNum">    1301</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1302"><span class="lineNum">    1302</span>              :         &quot;(internal function) The parameter, 'data' (const ml_tensors_data_h), is NULL. It should be a valid instance of ml_tensors_data_h.&quot;);</span>
<span id="L1303"><span class="lineNum">    1303</span>              : </span>
<span id="L1304"><span class="lineNum">    1304</span> <span class="tlaGNC tlaBgGNC">          94 :   if (is_input)</span></span>
<span id="L1305"><span class="lineNum">    1305</span> <span class="tlaGNC">          93 :     _model = (ml_tensors_data_s *) single_h-&gt;in_tensors;</span></span>
<span id="L1306"><span class="lineNum">    1306</span>              :   else</span>
<span id="L1307"><span class="lineNum">    1307</span> <span class="tlaGNC">           1 :     _model = (ml_tensors_data_s *) single_h-&gt;out_tensors;</span></span>
<span id="L1308"><span class="lineNum">    1308</span>              : </span>
<span id="L1309"><span class="lineNum">    1309</span> <span class="tlaGNC">          94 :   if (G_UNLIKELY (_data-&gt;num_tensors != _model-&gt;num_tensors))</span></span>
<span id="L1310"><span class="lineNum">    1310</span> <span class="tlaGNC">           1 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1311"><span class="lineNum">    1311</span>              :         &quot;(internal function) The number of %s tensors is not compatible with model. Given: %u, Expected: %u.&quot;,</span>
<span id="L1312"><span class="lineNum">    1312</span>              :         (is_input) ? &quot;input&quot; : &quot;output&quot;, _data-&gt;num_tensors,</span>
<span id="L1313"><span class="lineNum">    1313</span>              :         _model-&gt;num_tensors);</span>
<span id="L1314"><span class="lineNum">    1314</span>              : </span>
<span id="L1315"><span class="lineNum">    1315</span> <span class="tlaGNC">         339 :   for (i = 0; i &lt; _data-&gt;num_tensors; i++) {</span></span>
<span id="L1316"><span class="lineNum">    1316</span> <span class="tlaGNC">         249 :     if (G_UNLIKELY (!_data-&gt;tensors[i].data))</span></span>
<span id="L1317"><span class="lineNum">    1317</span> <span class="tlaGNC">           1 :       _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1318"><span class="lineNum">    1318</span>              :           &quot;The %d-th input tensor is not valid. There is no valid dimension metadata for this tensor.&quot;,</span>
<span id="L1319"><span class="lineNum">    1319</span>              :           i);</span>
<span id="L1320"><span class="lineNum">    1320</span>              : </span>
<span id="L1321"><span class="lineNum">    1321</span> <span class="tlaGNC">         248 :     raw_size = _model-&gt;tensors[i].size;</span></span>
<span id="L1322"><span class="lineNum">    1322</span> <span class="tlaGNC">         248 :     if (G_UNLIKELY (_data-&gt;tensors[i].size != raw_size))</span></span>
<span id="L1323"><span class="lineNum">    1323</span> <span class="tlaGNC">           2 :       _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1324"><span class="lineNum">    1324</span>              :           &quot;The size of %d-th %s tensor is not compatible with model. Given: %zu, Expected: %zu.&quot;,</span>
<span id="L1325"><span class="lineNum">    1325</span>              :           i, (is_input) ? &quot;input&quot; : &quot;output&quot;, _data-&gt;tensors[i].size, raw_size);</span>
<span id="L1326"><span class="lineNum">    1326</span>              :   }</span>
<span id="L1327"><span class="lineNum">    1327</span>              : </span>
<span id="L1328"><span class="lineNum">    1328</span> <span class="tlaGNC">          90 :   return ML_ERROR_NONE;</span></span>
<span id="L1329"><span class="lineNum">    1329</span>              : }</span>
<span id="L1330"><span class="lineNum">    1330</span>              : </span>
<span id="L1331"><span class="lineNum">    1331</span>              : /**</span>
<span id="L1332"><span class="lineNum">    1332</span>              :  * @brief Internal function to invoke the model.</span>
<span id="L1333"><span class="lineNum">    1333</span>              :  *</span>
<span id="L1334"><span class="lineNum">    1334</span>              :  * @details State changes performed by this function:</span>
<span id="L1335"><span class="lineNum">    1335</span>              :  *          IDLE -&gt; RUNNING - on receiving a valid request</span>
<span id="L1336"><span class="lineNum">    1336</span>              :  *</span>
<span id="L1337"><span class="lineNum">    1337</span>              :  *          Invoke returns error if the current state is not IDLE.</span>
<span id="L1338"><span class="lineNum">    1338</span>              :  *          If IDLE, then invoke is requested to the thread.</span>
<span id="L1339"><span class="lineNum">    1339</span>              :  *          Invoke waits for the processing to be complete, and returns back</span>
<span id="L1340"><span class="lineNum">    1340</span>              :  *          the result once notified by the processing thread.</span>
<span id="L1341"><span class="lineNum">    1341</span>              :  *</span>
<span id="L1342"><span class="lineNum">    1342</span>              :  * @note IDLE is the valid thread state before and after this function call.</span>
<span id="L1343"><span class="lineNum">    1343</span>              :  */</span>
<span id="L1344"><span class="lineNum">    1344</span>              : static int</span>
<span id="L1345"><span class="lineNum">    1345</span> <span class="tlaGNC">         106 : _ml_single_invoke_internal (ml_single_h single,</span></span>
<span id="L1346"><span class="lineNum">    1346</span>              :     const ml_tensors_data_h input, ml_tensors_data_h * output,</span>
<span id="L1347"><span class="lineNum">    1347</span>              :     const gboolean need_alloc)</span>
<span id="L1348"><span class="lineNum">    1348</span>              : {</span>
<span id="L1349"><span class="lineNum">    1349</span>              :   ml_single *single_h;</span>
<span id="L1350"><span class="lineNum">    1350</span>              :   ml_tensors_data_h _in, _out;</span>
<span id="L1351"><span class="lineNum">    1351</span>              :   gint64 end_time;</span>
<span id="L1352"><span class="lineNum">    1352</span> <span class="tlaGNC">         106 :   int status = ML_ERROR_NONE;</span></span>
<span id="L1353"><span class="lineNum">    1353</span>              : </span>
<span id="L1354"><span class="lineNum">    1354</span> <span class="tlaGNC">         212 :   check_feature_state (ML_FEATURE_INFERENCE);</span></span>
<span id="L1355"><span class="lineNum">    1355</span>              : </span>
<span id="L1356"><span class="lineNum">    1356</span> <span class="tlaGNC">         106 :   if (G_UNLIKELY (!single))</span></span>
<span id="L1357"><span class="lineNum">    1357</span> <span class="tlaGNC">           2 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1358"><span class="lineNum">    1358</span>              :         &quot;(internal function) The parameter, single (ml_single_h), is NULL. It should be a valid instance of ml_single_h, usually created by ml_single_open().&quot;);</span>
<span id="L1359"><span class="lineNum">    1359</span>              : </span>
<span id="L1360"><span class="lineNum">    1360</span> <span class="tlaGNC">         104 :   if (G_UNLIKELY (!input))</span></span>
<span id="L1361"><span class="lineNum">    1361</span> <span class="tlaGNC">           1 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1362"><span class="lineNum">    1362</span>              :         &quot;(internal function) The parameter, input (ml_tensors_data_h), is NULL. It should be a valid instance of ml_tensors_data_h.&quot;);</span>
<span id="L1363"><span class="lineNum">    1363</span>              : </span>
<span id="L1364"><span class="lineNum">    1364</span> <span class="tlaGNC">         103 :   if (G_UNLIKELY (!output))</span></span>
<span id="L1365"><span class="lineNum">    1365</span> <span class="tlaGNC">           1 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1366"><span class="lineNum">    1366</span>              :         &quot;(internal function) The parameter, output (ml_tensors_data_h *), is NULL. It should be a valid pointer to an instance of ml_tensors_data_h to store the inference results.&quot;);</span>
<span id="L1367"><span class="lineNum">    1367</span>              : </span>
<span id="L1368"><span class="lineNum">    1368</span> <span class="tlaGNC">         102 :   ML_SINGLE_GET_VALID_HANDLE_LOCKED (single_h, single, 0);</span></span>
<span id="L1369"><span class="lineNum">    1369</span>              : </span>
<span id="L1370"><span class="lineNum">    1370</span> <span class="tlaGNC">          93 :   if (G_UNLIKELY (!single_h-&gt;filter)) {</span></span>
<span id="L1371"><span class="lineNum">    1371</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report</span></span>
<span id="L1372"><span class="lineNum">    1372</span>              :         (&quot;The tensor_filter element of this single handle (single_h) is not valid. It appears that the handle (ml_single_h single) is not appropriately created by ml_single_open(), user thread has touched its internal data, or the handle is already closed or freed by user.&quot;);</span>
<span id="L1373"><span class="lineNum">    1373</span> <span class="tlaUNC">           0 :     status = ML_ERROR_INVALID_PARAMETER;</span></span>
<span id="L1374"><span class="lineNum">    1374</span> <span class="tlaUNC">           0 :     goto exit;</span></span>
<span id="L1375"><span class="lineNum">    1375</span>              :   }</span>
<span id="L1376"><span class="lineNum">    1376</span>              : </span>
<span id="L1377"><span class="lineNum">    1377</span>              :   /* Validate input/output data */</span>
<span id="L1378"><span class="lineNum">    1378</span> <span class="tlaGNC tlaBgGNC">          93 :   status = _ml_single_invoke_validate_data (single, input, TRUE);</span></span>
<span id="L1379"><span class="lineNum">    1379</span> <span class="tlaGNC">          93 :   if (status != ML_ERROR_NONE) {</span></span>
<span id="L1380"><span class="lineNum">    1380</span> <span class="tlaGNC">           4 :     _ml_error_report_continue</span></span>
<span id="L1381"><span class="lineNum">    1381</span>              :         (&quot;The input data for the inference is not valid: error code %d. Please check the dimensions, type, number-of-tensors, and size information of the input data.&quot;,</span>
<span id="L1382"><span class="lineNum">    1382</span>              :         status);</span>
<span id="L1383"><span class="lineNum">    1383</span> <span class="tlaGNC">           4 :     goto exit;</span></span>
<span id="L1384"><span class="lineNum">    1384</span>              :   }</span>
<span id="L1385"><span class="lineNum">    1385</span>              : </span>
<span id="L1386"><span class="lineNum">    1386</span> <span class="tlaGNC">          89 :   if (!need_alloc) {</span></span>
<span id="L1387"><span class="lineNum">    1387</span> <span class="tlaGNC">           1 :     status = _ml_single_invoke_validate_data (single, *output, FALSE);</span></span>
<span id="L1388"><span class="lineNum">    1388</span> <span class="tlaGNC">           1 :     if (status != ML_ERROR_NONE) {</span></span>
<span id="L1389"><span class="lineNum">    1389</span> <span class="tlaUNC tlaBgUNC">           0 :       _ml_error_report_continue</span></span>
<span id="L1390"><span class="lineNum">    1390</span>              :           (&quot;The output data buffer provided by the user is not valid for the given neural network mode: error code %d. Please check the dimensions, type, number-of-tensors, and size information of the output data buffer.&quot;,</span>
<span id="L1391"><span class="lineNum">    1391</span>              :           status);</span>
<span id="L1392"><span class="lineNum">    1392</span> <span class="tlaUNC">           0 :       goto exit;</span></span>
<span id="L1393"><span class="lineNum">    1393</span>              :     }</span>
<span id="L1394"><span class="lineNum">    1394</span>              :   }</span>
<span id="L1395"><span class="lineNum">    1395</span>              : </span>
<span id="L1396"><span class="lineNum">    1396</span> <span class="tlaGNC tlaBgGNC">          89 :   if (single_h-&gt;state != IDLE) {</span></span>
<span id="L1397"><span class="lineNum">    1397</span> <span class="tlaGNC">           7 :     if (G_UNLIKELY (single_h-&gt;state == JOIN_REQUESTED)) {</span></span>
<span id="L1398"><span class="lineNum">    1398</span> <span class="tlaUNC tlaBgUNC">           0 :       _ml_error_report</span></span>
<span id="L1399"><span class="lineNum">    1399</span>              :           (&quot;The handle (single_h single) is closed or being closed awaiting for the last ongoing invocation. Invoking with such a handle is not allowed. Please open another single_h handle to invoke.&quot;);</span>
<span id="L1400"><span class="lineNum">    1400</span> <span class="tlaUNC">           0 :       status = ML_ERROR_STREAMS_PIPE;</span></span>
<span id="L1401"><span class="lineNum">    1401</span> <span class="tlaUNC">           0 :       goto exit;</span></span>
<span id="L1402"><span class="lineNum">    1402</span>              :     }</span>
<span id="L1403"><span class="lineNum">    1403</span> <span class="tlaGNC tlaBgGNC">           7 :     _ml_error_report</span></span>
<span id="L1404"><span class="lineNum">    1404</span>              :         (&quot;The handle (single_h single) is busy. There is another thread waiting for inference results with this handle. Please retry invoking again later when the handle becomes idle after completing the current inference task.&quot;);</span>
<span id="L1405"><span class="lineNum">    1405</span> <span class="tlaGNC">           7 :     status = ML_ERROR_TRY_AGAIN;</span></span>
<span id="L1406"><span class="lineNum">    1406</span> <span class="tlaGNC">           7 :     goto exit;</span></span>
<span id="L1407"><span class="lineNum">    1407</span>              :   }</span>
<span id="L1408"><span class="lineNum">    1408</span>              : </span>
<span id="L1409"><span class="lineNum">    1409</span>              :   /* prepare output data */</span>
<span id="L1410"><span class="lineNum">    1410</span> <span class="tlaGNC">          82 :   if (need_alloc) {</span></span>
<span id="L1411"><span class="lineNum">    1411</span> <span class="tlaGNC">          81 :     *output = NULL;</span></span>
<span id="L1412"><span class="lineNum">    1412</span>              : </span>
<span id="L1413"><span class="lineNum">    1413</span> <span class="tlaGNC">          81 :     status = _ml_tensors_data_clone_no_alloc (single_h-&gt;out_tensors, &amp;_out);</span></span>
<span id="L1414"><span class="lineNum">    1414</span> <span class="tlaGNC">          81 :     if (status != ML_ERROR_NONE)</span></span>
<span id="L1415"><span class="lineNum">    1415</span> <span class="tlaUNC tlaBgUNC">           0 :       goto exit;</span></span>
<span id="L1416"><span class="lineNum">    1416</span>              :   } else {</span>
<span id="L1417"><span class="lineNum">    1417</span> <span class="tlaGNC tlaBgGNC">           1 :     _out = *output;</span></span>
<span id="L1418"><span class="lineNum">    1418</span>              :   }</span>
<span id="L1419"><span class="lineNum">    1419</span>              : </span>
<span id="L1420"><span class="lineNum">    1420</span>              :   /**</span>
<span id="L1421"><span class="lineNum">    1421</span>              :    * Clone input data here to prevent use-after-free case.</span>
<span id="L1422"><span class="lineNum">    1422</span>              :    * We should release single_h-&gt;input after calling __invoke() function.</span>
<span id="L1423"><span class="lineNum">    1423</span>              :    */</span>
<span id="L1424"><span class="lineNum">    1424</span> <span class="tlaGNC">          82 :   status = ml_tensors_data_clone (input, &amp;_in);</span></span>
<span id="L1425"><span class="lineNum">    1425</span> <span class="tlaGNC">          82 :   if (status != ML_ERROR_NONE)</span></span>
<span id="L1426"><span class="lineNum">    1426</span> <span class="tlaUNC tlaBgUNC">           0 :     goto exit;</span></span>
<span id="L1427"><span class="lineNum">    1427</span>              : </span>
<span id="L1428"><span class="lineNum">    1428</span> <span class="tlaGNC tlaBgGNC">          82 :   single_h-&gt;state = RUNNING;</span></span>
<span id="L1429"><span class="lineNum">    1429</span> <span class="tlaGNC">          82 :   single_h-&gt;free_output = need_alloc;</span></span>
<span id="L1430"><span class="lineNum">    1430</span> <span class="tlaGNC">          82 :   single_h-&gt;input = _in;</span></span>
<span id="L1431"><span class="lineNum">    1431</span> <span class="tlaGNC">          82 :   single_h-&gt;output = _out;</span></span>
<span id="L1432"><span class="lineNum">    1432</span>              : </span>
<span id="L1433"><span class="lineNum">    1433</span> <span class="tlaGNC">          82 :   if (single_h-&gt;timeout &gt; 0) {</span></span>
<span id="L1434"><span class="lineNum">    1434</span>              :     /* Wake up &quot;invoke_thread&quot; */</span>
<span id="L1435"><span class="lineNum">    1435</span> <span class="tlaGNC">          23 :     g_cond_broadcast (&amp;single_h-&gt;cond);</span></span>
<span id="L1436"><span class="lineNum">    1436</span>              : </span>
<span id="L1437"><span class="lineNum">    1437</span>              :     /* set timeout */</span>
<span id="L1438"><span class="lineNum">    1438</span> <span class="tlaGNC">          23 :     end_time = g_get_monotonic_time () +</span></span>
<span id="L1439"><span class="lineNum">    1439</span> <span class="tlaGNC">          23 :         single_h-&gt;timeout * G_TIME_SPAN_MILLISECOND;</span></span>
<span id="L1440"><span class="lineNum">    1440</span>              : </span>
<span id="L1441"><span class="lineNum">    1441</span> <span class="tlaGNC">          23 :     if (g_cond_wait_until (&amp;single_h-&gt;cond, &amp;single_h-&gt;mutex, end_time)) {</span></span>
<span id="L1442"><span class="lineNum">    1442</span> <span class="tlaGNC">          19 :       status = single_h-&gt;status;</span></span>
<span id="L1443"><span class="lineNum">    1443</span>              :     } else {</span>
<span id="L1444"><span class="lineNum">    1444</span> <span class="tlaGNC">           4 :       _ml_logw (&quot;Wait for invoke has timed out&quot;);</span></span>
<span id="L1445"><span class="lineNum">    1445</span> <span class="tlaGNC">           4 :       status = ML_ERROR_TIMED_OUT;</span></span>
<span id="L1446"><span class="lineNum">    1446</span>              :       /** This is set to notify invoke_thread to not process if timed out */</span>
<span id="L1447"><span class="lineNum">    1447</span> <span class="tlaGNC">           4 :       if (need_alloc)</span></span>
<span id="L1448"><span class="lineNum">    1448</span> <span class="tlaGNC">           4 :         set_destroy_notify (single_h, _out, TRUE);</span></span>
<span id="L1449"><span class="lineNum">    1449</span>              :     }</span>
<span id="L1450"><span class="lineNum">    1450</span>              :   } else {</span>
<span id="L1451"><span class="lineNum">    1451</span>              :     /**</span>
<span id="L1452"><span class="lineNum">    1452</span>              :      * Don't worry. We have locked single_h-&gt;mutex, thus there is no</span>
<span id="L1453"><span class="lineNum">    1453</span>              :      * other thread with ml_single_invoke function on the same handle</span>
<span id="L1454"><span class="lineNum">    1454</span>              :      * that are in this if-then-else block, which means that there is</span>
<span id="L1455"><span class="lineNum">    1455</span>              :      * no other thread with active invoke-thread (calling __invoke())</span>
<span id="L1456"><span class="lineNum">    1456</span>              :      * with the same handle. Thus we can call __invoke without</span>
<span id="L1457"><span class="lineNum">    1457</span>              :      * having yet another mutex for __invoke.</span>
<span id="L1458"><span class="lineNum">    1458</span>              :      */</span>
<span id="L1459"><span class="lineNum">    1459</span> <span class="tlaGNC">          59 :     single_h-&gt;invoking = TRUE;</span></span>
<span id="L1460"><span class="lineNum">    1460</span> <span class="tlaGNC">          59 :     status = __invoke (single_h, _in, _out, need_alloc);</span></span>
<span id="L1461"><span class="lineNum">    1461</span> <span class="tlaGNC">          59 :     ml_tensors_data_destroy (_in);</span></span>
<span id="L1462"><span class="lineNum">    1462</span> <span class="tlaGNC">          59 :     single_h-&gt;invoking = FALSE;</span></span>
<span id="L1463"><span class="lineNum">    1463</span> <span class="tlaGNC">          59 :     single_h-&gt;state = IDLE;</span></span>
<span id="L1464"><span class="lineNum">    1464</span>              : </span>
<span id="L1465"><span class="lineNum">    1465</span> <span class="tlaGNC">          59 :     if (status != ML_ERROR_NONE) {</span></span>
<span id="L1466"><span class="lineNum">    1466</span> <span class="tlaUNC tlaBgUNC">           0 :       if (need_alloc)</span></span>
<span id="L1467"><span class="lineNum">    1467</span> <span class="tlaUNC">           0 :         ml_tensors_data_destroy (_out);</span></span>
<span id="L1468"><span class="lineNum">    1468</span> <span class="tlaUNC">           0 :       goto exit;</span></span>
<span id="L1469"><span class="lineNum">    1469</span>              :     }</span>
<span id="L1470"><span class="lineNum">    1470</span>              : </span>
<span id="L1471"><span class="lineNum">    1471</span> <span class="tlaGNC tlaBgGNC">          59 :     if (need_alloc)</span></span>
<span id="L1472"><span class="lineNum">    1472</span> <span class="tlaGNC">          58 :       __process_output (single_h, _out);</span></span>
<span id="L1473"><span class="lineNum">    1473</span>              :   }</span>
<span id="L1474"><span class="lineNum">    1474</span>              : </span>
<span id="L1475"><span class="lineNum">    1475</span> <span class="tlaGNC">           1 : exit:</span></span>
<span id="L1476"><span class="lineNum">    1476</span> <span class="tlaGNC">          93 :   if (status == ML_ERROR_NONE) {</span></span>
<span id="L1477"><span class="lineNum">    1477</span> <span class="tlaGNC">          78 :     if (need_alloc)</span></span>
<span id="L1478"><span class="lineNum">    1478</span> <span class="tlaGNC">          77 :       *output = _out;</span></span>
<span id="L1479"><span class="lineNum">    1479</span>              :   }</span>
<span id="L1480"><span class="lineNum">    1480</span>              : </span>
<span id="L1481"><span class="lineNum">    1481</span> <span class="tlaGNC">          93 :   single_h-&gt;input = single_h-&gt;output = NULL;</span></span>
<span id="L1482"><span class="lineNum">    1482</span> <span class="tlaGNC">          93 :   ML_SINGLE_HANDLE_UNLOCK (single_h);</span></span>
<span id="L1483"><span class="lineNum">    1483</span> <span class="tlaGNC">          93 :   return status;</span></span>
<span id="L1484"><span class="lineNum">    1484</span>              : }</span>
<span id="L1485"><span class="lineNum">    1485</span>              : </span>
<span id="L1486"><span class="lineNum">    1486</span>              : /**</span>
<span id="L1487"><span class="lineNum">    1487</span>              :  * @brief Invokes the model with the given input data.</span>
<span id="L1488"><span class="lineNum">    1488</span>              :  */</span>
<span id="L1489"><span class="lineNum">    1489</span>              : int</span>
<span id="L1490"><span class="lineNum">    1490</span> <span class="tlaGNC">         105 : ml_single_invoke (ml_single_h single,</span></span>
<span id="L1491"><span class="lineNum">    1491</span>              :     const ml_tensors_data_h input, ml_tensors_data_h * output)</span>
<span id="L1492"><span class="lineNum">    1492</span>              : {</span>
<span id="L1493"><span class="lineNum">    1493</span> <span class="tlaGNC">         105 :   return _ml_single_invoke_internal (single, input, output, TRUE);</span></span>
<span id="L1494"><span class="lineNum">    1494</span>              : }</span>
<span id="L1495"><span class="lineNum">    1495</span>              : </span>
<span id="L1496"><span class="lineNum">    1496</span>              : /**</span>
<span id="L1497"><span class="lineNum">    1497</span>              :  * @brief Invokes the model with the given input data and fills the output data handle.</span>
<span id="L1498"><span class="lineNum">    1498</span>              :  */</span>
<span id="L1499"><span class="lineNum">    1499</span>              : int</span>
<span id="L1500"><span class="lineNum">    1500</span> <span class="tlaGNC">           1 : ml_single_invoke_fast (ml_single_h single,</span></span>
<span id="L1501"><span class="lineNum">    1501</span>              :     const ml_tensors_data_h input, ml_tensors_data_h output)</span>
<span id="L1502"><span class="lineNum">    1502</span>              : {</span>
<span id="L1503"><span class="lineNum">    1503</span> <span class="tlaGNC">           1 :   return _ml_single_invoke_internal (single, input, &amp;output, FALSE);</span></span>
<span id="L1504"><span class="lineNum">    1504</span>              : }</span>
<span id="L1505"><span class="lineNum">    1505</span>              : </span>
<span id="L1506"><span class="lineNum">    1506</span>              : /**</span>
<span id="L1507"><span class="lineNum">    1507</span>              :  * @brief Gets the tensors info for the given handle.</span>
<span id="L1508"><span class="lineNum">    1508</span>              :  * @param[out] info A pointer to a NULL (unallocated) instance.</span>
<span id="L1509"><span class="lineNum">    1509</span>              :  */</span>
<span id="L1510"><span class="lineNum">    1510</span>              : static int</span>
<span id="L1511"><span class="lineNum">    1511</span> <span class="tlaGNC">          61 : ml_single_get_tensors_info (ml_single_h single, gboolean is_input,</span></span>
<span id="L1512"><span class="lineNum">    1512</span>              :     ml_tensors_info_h * info)</span>
<span id="L1513"><span class="lineNum">    1513</span>              : {</span>
<span id="L1514"><span class="lineNum">    1514</span>              :   ml_single *single_h;</span>
<span id="L1515"><span class="lineNum">    1515</span> <span class="tlaGNC">          61 :   int status = ML_ERROR_NONE;</span></span>
<span id="L1516"><span class="lineNum">    1516</span>              : </span>
<span id="L1517"><span class="lineNum">    1517</span> <span class="tlaGNC">          61 :   check_feature_state (ML_FEATURE_INFERENCE);</span></span>
<span id="L1518"><span class="lineNum">    1518</span>              : </span>
<span id="L1519"><span class="lineNum">    1519</span> <span class="tlaGNC">          61 :   if (!single)</span></span>
<span id="L1520"><span class="lineNum">    1520</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1521"><span class="lineNum">    1521</span>              :         &quot;(internal function) The parameter, 'single' (ml_single_h), is NULL. It should be a valid ml_single_h instance, usually created by ml_single_open().&quot;);</span>
<span id="L1522"><span class="lineNum">    1522</span> <span class="tlaGNC tlaBgGNC">          61 :   if (!info)</span></span>
<span id="L1523"><span class="lineNum">    1523</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1524"><span class="lineNum">    1524</span>              :         &quot;(internal function) The parameter, 'info' (ml_tensors_info_h *) is NULL. It should be a valid pointer to an empty (NULL) instance of ml_tensor_info_h, which is supposed to be filled with the fetched info by this function.&quot;);</span>
<span id="L1525"><span class="lineNum">    1525</span>              : </span>
<span id="L1526"><span class="lineNum">    1526</span> <span class="tlaGNC tlaBgGNC">          61 :   ML_SINGLE_GET_VALID_HANDLE_LOCKED (single_h, single, 0);</span></span>
<span id="L1527"><span class="lineNum">    1527</span>              : </span>
<span id="L1528"><span class="lineNum">    1528</span> <span class="tlaGNC">          61 :   if (is_input)</span></span>
<span id="L1529"><span class="lineNum">    1529</span> <span class="tlaGNC">          39 :     status = _ml_tensors_info_create_from_gst (info, &amp;single_h-&gt;in_info);</span></span>
<span id="L1530"><span class="lineNum">    1530</span>              :   else</span>
<span id="L1531"><span class="lineNum">    1531</span> <span class="tlaGNC">          22 :     status = _ml_tensors_info_create_from_gst (info, &amp;single_h-&gt;out_info);</span></span>
<span id="L1532"><span class="lineNum">    1532</span>              : </span>
<span id="L1533"><span class="lineNum">    1533</span> <span class="tlaGNC">          61 :   if (status != ML_ERROR_NONE) {</span></span>
<span id="L1534"><span class="lineNum">    1534</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_continue</span></span>
<span id="L1535"><span class="lineNum">    1535</span>              :         (&quot;(internal function) Failed to create an entry for the ml_tensors_info_h instance. Error code: %d&quot;,</span>
<span id="L1536"><span class="lineNum">    1536</span>              :         status);</span>
<span id="L1537"><span class="lineNum">    1537</span>              :   }</span>
<span id="L1538"><span class="lineNum">    1538</span>              : </span>
<span id="L1539"><span class="lineNum">    1539</span> <span class="tlaGNC tlaBgGNC">          61 :   ML_SINGLE_HANDLE_UNLOCK (single_h);</span></span>
<span id="L1540"><span class="lineNum">    1540</span> <span class="tlaGNC">          61 :   return status;</span></span>
<span id="L1541"><span class="lineNum">    1541</span>              : }</span>
<span id="L1542"><span class="lineNum">    1542</span>              : </span>
<span id="L1543"><span class="lineNum">    1543</span>              : /**</span>
<span id="L1544"><span class="lineNum">    1544</span>              :  * @brief Gets the information of required input data for the given handle.</span>
<span id="L1545"><span class="lineNum">    1545</span>              :  * @note information = (tensor dimension, type, name and so on)</span>
<span id="L1546"><span class="lineNum">    1546</span>              :  */</span>
<span id="L1547"><span class="lineNum">    1547</span>              : int</span>
<span id="L1548"><span class="lineNum">    1548</span> <span class="tlaGNC">          39 : ml_single_get_input_info (ml_single_h single, ml_tensors_info_h * info)</span></span>
<span id="L1549"><span class="lineNum">    1549</span>              : {</span>
<span id="L1550"><span class="lineNum">    1550</span> <span class="tlaGNC">          39 :   return ml_single_get_tensors_info (single, TRUE, info);</span></span>
<span id="L1551"><span class="lineNum">    1551</span>              : }</span>
<span id="L1552"><span class="lineNum">    1552</span>              : </span>
<span id="L1553"><span class="lineNum">    1553</span>              : /**</span>
<span id="L1554"><span class="lineNum">    1554</span>              :  * @brief Gets the information of output data for the given handle.</span>
<span id="L1555"><span class="lineNum">    1555</span>              :  * @note information = (tensor dimension, type, name and so on)</span>
<span id="L1556"><span class="lineNum">    1556</span>              :  */</span>
<span id="L1557"><span class="lineNum">    1557</span>              : int</span>
<span id="L1558"><span class="lineNum">    1558</span> <span class="tlaGNC">          22 : ml_single_get_output_info (ml_single_h single, ml_tensors_info_h * info)</span></span>
<span id="L1559"><span class="lineNum">    1559</span>              : {</span>
<span id="L1560"><span class="lineNum">    1560</span> <span class="tlaGNC">          22 :   return ml_single_get_tensors_info (single, FALSE, info);</span></span>
<span id="L1561"><span class="lineNum">    1561</span>              : }</span>
<span id="L1562"><span class="lineNum">    1562</span>              : </span>
<span id="L1563"><span class="lineNum">    1563</span>              : /**</span>
<span id="L1564"><span class="lineNum">    1564</span>              :  * @brief Sets the maximum amount of time to wait for an output, in milliseconds.</span>
<span id="L1565"><span class="lineNum">    1565</span>              :  */</span>
<span id="L1566"><span class="lineNum">    1566</span>              : int</span>
<span id="L1567"><span class="lineNum">    1567</span> <span class="tlaGNC">          19 : ml_single_set_timeout (ml_single_h single, unsigned int timeout)</span></span>
<span id="L1568"><span class="lineNum">    1568</span>              : {</span>
<span id="L1569"><span class="lineNum">    1569</span>              :   ml_single *single_h;</span>
<span id="L1570"><span class="lineNum">    1570</span>              : </span>
<span id="L1571"><span class="lineNum">    1571</span> <span class="tlaGNC">          19 :   check_feature_state (ML_FEATURE_INFERENCE);</span></span>
<span id="L1572"><span class="lineNum">    1572</span>              : </span>
<span id="L1573"><span class="lineNum">    1573</span> <span class="tlaGNC">          19 :   if (!single)</span></span>
<span id="L1574"><span class="lineNum">    1574</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1575"><span class="lineNum">    1575</span>              :         &quot;The parameter, single (ml_single_h), is NULL. It should be a valid instance of ml_single_h, which is usually created by ml_single_open().&quot;);</span>
<span id="L1576"><span class="lineNum">    1576</span>              : </span>
<span id="L1577"><span class="lineNum">    1577</span> <span class="tlaGNC tlaBgGNC">          19 :   ML_SINGLE_GET_VALID_HANDLE_LOCKED (single_h, single, 0);</span></span>
<span id="L1578"><span class="lineNum">    1578</span>              : </span>
<span id="L1579"><span class="lineNum">    1579</span> <span class="tlaGNC">          19 :   single_h-&gt;timeout = (guint) timeout;</span></span>
<span id="L1580"><span class="lineNum">    1580</span>              : </span>
<span id="L1581"><span class="lineNum">    1581</span> <span class="tlaGNC">          19 :   ML_SINGLE_HANDLE_UNLOCK (single_h);</span></span>
<span id="L1582"><span class="lineNum">    1582</span> <span class="tlaGNC">          19 :   return ML_ERROR_NONE;</span></span>
<span id="L1583"><span class="lineNum">    1583</span>              : }</span>
<span id="L1584"><span class="lineNum">    1584</span>              : </span>
<span id="L1585"><span class="lineNum">    1585</span>              : /**</span>
<span id="L1586"><span class="lineNum">    1586</span>              :  * @brief Sets the information (tensor dimension, type, name and so on) of required input data for the given model.</span>
<span id="L1587"><span class="lineNum">    1587</span>              :  */</span>
<span id="L1588"><span class="lineNum">    1588</span>              : int</span>
<span id="L1589"><span class="lineNum">    1589</span> <span class="tlaGNC">          17 : ml_single_set_input_info (ml_single_h single, const ml_tensors_info_h info)</span></span>
<span id="L1590"><span class="lineNum">    1590</span>              : {</span>
<span id="L1591"><span class="lineNum">    1591</span>              :   ml_single *single_h;</span>
<span id="L1592"><span class="lineNum">    1592</span>              :   GstTensorsInfo gst_info;</span>
<span id="L1593"><span class="lineNum">    1593</span> <span class="tlaGNC">          17 :   int status = ML_ERROR_NONE;</span></span>
<span id="L1594"><span class="lineNum">    1594</span>              : </span>
<span id="L1595"><span class="lineNum">    1595</span> <span class="tlaGNC">          34 :   check_feature_state (ML_FEATURE_INFERENCE);</span></span>
<span id="L1596"><span class="lineNum">    1596</span>              : </span>
<span id="L1597"><span class="lineNum">    1597</span> <span class="tlaGNC">          17 :   if (!single)</span></span>
<span id="L1598"><span class="lineNum">    1598</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1599"><span class="lineNum">    1599</span>              :         &quot;The parameter, single (ml_single_h), is NULL. It should be a valid instance of ml_single_h, which is usually created by ml_single_open().&quot;);</span>
<span id="L1600"><span class="lineNum">    1600</span> <span class="tlaGNC tlaBgGNC">          17 :   if (!info)</span></span>
<span id="L1601"><span class="lineNum">    1601</span> <span class="tlaGNC">           2 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1602"><span class="lineNum">    1602</span>              :         &quot;The parameter, info (const ml_tensors_info_h), is NULL. It should be a valid instance of ml_tensors_info_h, which is usually created by ml_tensors_info_create() or other APIs.&quot;);</span>
<span id="L1603"><span class="lineNum">    1603</span>              : </span>
<span id="L1604"><span class="lineNum">    1604</span> <span class="tlaGNC">          15 :   if (!ml_tensors_info_is_valid (info))</span></span>
<span id="L1605"><span class="lineNum">    1605</span> <span class="tlaGNC">           1 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1606"><span class="lineNum">    1606</span>              :         &quot;The parameter, info (const ml_tensors_info_h), is not valid. Although it is not NULL, the content of 'info' is invalid. If it is created by ml_tensors_info_create(), which creates an empty instance, it should be filled by users afterwards. Please check if 'info' has all elements filled with valid values.&quot;);</span>
<span id="L1607"><span class="lineNum">    1607</span>              : </span>
<span id="L1608"><span class="lineNum">    1608</span> <span class="tlaGNC">          14 :   ML_SINGLE_GET_VALID_HANDLE_LOCKED (single_h, single, 0);</span></span>
<span id="L1609"><span class="lineNum">    1609</span> <span class="tlaGNC">          14 :   _ml_tensors_info_copy_from_ml (&amp;gst_info, info);</span></span>
<span id="L1610"><span class="lineNum">    1610</span> <span class="tlaGNC">          14 :   status = ml_single_set_gst_info (single_h, &amp;gst_info);</span></span>
<span id="L1611"><span class="lineNum">    1611</span> <span class="tlaGNC">          14 :   gst_tensors_info_free (&amp;gst_info);</span></span>
<span id="L1612"><span class="lineNum">    1612</span> <span class="tlaGNC">          14 :   ML_SINGLE_HANDLE_UNLOCK (single_h);</span></span>
<span id="L1613"><span class="lineNum">    1613</span>              : </span>
<span id="L1614"><span class="lineNum">    1614</span> <span class="tlaGNC">          14 :   if (status != ML_ERROR_NONE)</span></span>
<span id="L1615"><span class="lineNum">    1615</span> <span class="tlaGNC">           5 :     _ml_error_report_continue</span></span>
<span id="L1616"><span class="lineNum">    1616</span>              :         (&quot;ml_single_set_gst_info() has failed to configure the single_h handle with the given info. Error code: %d&quot;,</span>
<span id="L1617"><span class="lineNum">    1617</span>              :         status);</span>
<span id="L1618"><span class="lineNum">    1618</span>              : </span>
<span id="L1619"><span class="lineNum">    1619</span> <span class="tlaGNC">          14 :   return status;</span></span>
<span id="L1620"><span class="lineNum">    1620</span>              : }</span>
<span id="L1621"><span class="lineNum">    1621</span>              : </span>
<span id="L1622"><span class="lineNum">    1622</span>              : /**</span>
<span id="L1623"><span class="lineNum">    1623</span>              :  * @brief Invokes the model with the given input data with the given info.</span>
<span id="L1624"><span class="lineNum">    1624</span>              :  */</span>
<span id="L1625"><span class="lineNum">    1625</span>              : int</span>
<span id="L1626"><span class="lineNum">    1626</span> <span class="tlaGNC">           9 : ml_single_invoke_dynamic (ml_single_h single,</span></span>
<span id="L1627"><span class="lineNum">    1627</span>              :     const ml_tensors_data_h input, const ml_tensors_info_h in_info,</span>
<span id="L1628"><span class="lineNum">    1628</span>              :     ml_tensors_data_h * output, ml_tensors_info_h * out_info)</span>
<span id="L1629"><span class="lineNum">    1629</span>              : {</span>
<span id="L1630"><span class="lineNum">    1630</span>              :   int status;</span>
<span id="L1631"><span class="lineNum">    1631</span> <span class="tlaGNC">           9 :   ml_tensors_info_h cur_in_info = NULL;</span></span>
<span id="L1632"><span class="lineNum">    1632</span>              : </span>
<span id="L1633"><span class="lineNum">    1633</span> <span class="tlaGNC">           9 :   if (!single)</span></span>
<span id="L1634"><span class="lineNum">    1634</span> <span class="tlaGNC">           9 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1635"><span class="lineNum">    1635</span>              :         &quot;The parameter, single (ml_single_h), is NULL. It should be a valid instance of ml_single_h, which is usually created by ml_single_open().&quot;);</span>
<span id="L1636"><span class="lineNum">    1636</span> <span class="tlaGNC">           8 :   if (!input)</span></span>
<span id="L1637"><span class="lineNum">    1637</span> <span class="tlaGNC">           1 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1638"><span class="lineNum">    1638</span>              :         &quot;The parameter, input (const ml_tensors_data_h), is NULL. It should be a valid instance of ml_tensors_data_h with input data frame for inference.&quot;);</span>
<span id="L1639"><span class="lineNum">    1639</span> <span class="tlaGNC">           7 :   if (!in_info)</span></span>
<span id="L1640"><span class="lineNum">    1640</span> <span class="tlaGNC">           1 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1641"><span class="lineNum">    1641</span>              :         &quot;The parameter, in_info (const ml_tensors_info_h), is NULL. It should be a valid instance of ml_tensor_info_h that describes metadata of the given input for inference (input).&quot;);</span>
<span id="L1642"><span class="lineNum">    1642</span> <span class="tlaGNC">           6 :   if (!output)</span></span>
<span id="L1643"><span class="lineNum">    1643</span> <span class="tlaGNC">           1 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1644"><span class="lineNum">    1644</span>              :         &quot;The parameter, output (ml_tensors_data_h *), is NULL. It should be a pointer to an empty (NULL or do-not-care) instance of ml_tensors_data_h, which is filled by this API with the result of inference.&quot;);</span>
<span id="L1645"><span class="lineNum">    1645</span> <span class="tlaGNC">           5 :   if (!out_info)</span></span>
<span id="L1646"><span class="lineNum">    1646</span> <span class="tlaGNC">           1 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1647"><span class="lineNum">    1647</span>              :         &quot;The parameter, out_info (ml_tensors_info_h *), is NULL. It should be a pointer to an empty (NULL or do-not-care) instance of ml_tensors_info_h, which is filled by this API with the neural network model info.&quot;);</span>
<span id="L1648"><span class="lineNum">    1648</span>              : </span>
<span id="L1649"><span class="lineNum">    1649</span>              :   /* init null */</span>
<span id="L1650"><span class="lineNum">    1650</span> <span class="tlaGNC">           4 :   *output = NULL;</span></span>
<span id="L1651"><span class="lineNum">    1651</span> <span class="tlaGNC">           4 :   *out_info = NULL;</span></span>
<span id="L1652"><span class="lineNum">    1652</span>              : </span>
<span id="L1653"><span class="lineNum">    1653</span> <span class="tlaGNC">           4 :   status = ml_single_get_input_info (single, &amp;cur_in_info);</span></span>
<span id="L1654"><span class="lineNum">    1654</span> <span class="tlaGNC">           4 :   if (status != ML_ERROR_NONE) {</span></span>
<span id="L1655"><span class="lineNum">    1655</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_continue</span></span>
<span id="L1656"><span class="lineNum">    1656</span>              :         (&quot;Failed to get input metadata configured by the opened single_h handle instance. Error code: %d.&quot;,</span>
<span id="L1657"><span class="lineNum">    1657</span>              :         status);</span>
<span id="L1658"><span class="lineNum">    1658</span> <span class="tlaUNC">           0 :     goto exit;</span></span>
<span id="L1659"><span class="lineNum">    1659</span>              :   }</span>
<span id="L1660"><span class="lineNum">    1660</span> <span class="tlaGNC tlaBgGNC">           4 :   status = ml_single_update_info (single, in_info, out_info);</span></span>
<span id="L1661"><span class="lineNum">    1661</span> <span class="tlaGNC">           4 :   if (status != ML_ERROR_NONE) {</span></span>
<span id="L1662"><span class="lineNum">    1662</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_continue</span></span>
<span id="L1663"><span class="lineNum">    1663</span>              :         (&quot;Failed to reconfigure the opened single_h handle instance with the updated input/output metadata. Error code: %d.&quot;,</span>
<span id="L1664"><span class="lineNum">    1664</span>              :         status);</span>
<span id="L1665"><span class="lineNum">    1665</span> <span class="tlaUNC">           0 :     goto exit;</span></span>
<span id="L1666"><span class="lineNum">    1666</span>              :   }</span>
<span id="L1667"><span class="lineNum">    1667</span>              : </span>
<span id="L1668"><span class="lineNum">    1668</span> <span class="tlaGNC tlaBgGNC">           4 :   status = ml_single_invoke (single, input, output);</span></span>
<span id="L1669"><span class="lineNum">    1669</span> <span class="tlaGNC">           4 :   if (status != ML_ERROR_NONE) {</span></span>
<span id="L1670"><span class="lineNum">    1670</span> <span class="tlaUNC tlaBgUNC">           0 :     ml_single_set_input_info (single, cur_in_info);</span></span>
<span id="L1671"><span class="lineNum">    1671</span> <span class="tlaUNC">           0 :     if (status != ML_ERROR_TRY_AGAIN) {</span></span>
<span id="L1672"><span class="lineNum">    1672</span>              :       /* If it's TRY_AGAIN, ml_single_invoke() has already gave enough info. */</span>
<span id="L1673"><span class="lineNum">    1673</span> <span class="tlaUNC">           0 :       _ml_error_report_continue</span></span>
<span id="L1674"><span class="lineNum">    1674</span>              :           (&quot;Invoking the given neural network has failed. Error code: %d.&quot;,</span>
<span id="L1675"><span class="lineNum">    1675</span>              :           status);</span>
<span id="L1676"><span class="lineNum">    1676</span>              :     }</span>
<span id="L1677"><span class="lineNum">    1677</span>              :   }</span>
<span id="L1678"><span class="lineNum">    1678</span>              : </span>
<span id="L1679"><span class="lineNum">    1679</span> <span class="tlaGNC tlaBgGNC">           4 : exit:</span></span>
<span id="L1680"><span class="lineNum">    1680</span> <span class="tlaGNC">           4 :   if (cur_in_info)</span></span>
<span id="L1681"><span class="lineNum">    1681</span> <span class="tlaGNC">           4 :     ml_tensors_info_destroy (cur_in_info);</span></span>
<span id="L1682"><span class="lineNum">    1682</span>              : </span>
<span id="L1683"><span class="lineNum">    1683</span> <span class="tlaGNC">           4 :   if (status != ML_ERROR_NONE) {</span></span>
<span id="L1684"><span class="lineNum">    1684</span> <span class="tlaUNC tlaBgUNC">           0 :     if (*out_info) {</span></span>
<span id="L1685"><span class="lineNum">    1685</span> <span class="tlaUNC">           0 :       ml_tensors_info_destroy (*out_info);</span></span>
<span id="L1686"><span class="lineNum">    1686</span> <span class="tlaUNC">           0 :       *out_info = NULL;</span></span>
<span id="L1687"><span class="lineNum">    1687</span>              :     }</span>
<span id="L1688"><span class="lineNum">    1688</span>              :   }</span>
<span id="L1689"><span class="lineNum">    1689</span>              : </span>
<span id="L1690"><span class="lineNum">    1690</span> <span class="tlaGNC tlaBgGNC">           4 :   return status;</span></span>
<span id="L1691"><span class="lineNum">    1691</span>              : }</span>
<span id="L1692"><span class="lineNum">    1692</span>              : </span>
<span id="L1693"><span class="lineNum">    1693</span>              : /**</span>
<span id="L1694"><span class="lineNum">    1694</span>              :  * @brief Sets the property value for the given model.</span>
<span id="L1695"><span class="lineNum">    1695</span>              :  */</span>
<span id="L1696"><span class="lineNum">    1696</span>              : int</span>
<span id="L1697"><span class="lineNum">    1697</span> <span class="tlaGNC">          13 : ml_single_set_property (ml_single_h single, const char *name, const char *value)</span></span>
<span id="L1698"><span class="lineNum">    1698</span>              : {</span>
<span id="L1699"><span class="lineNum">    1699</span>              :   ml_single *single_h;</span>
<span id="L1700"><span class="lineNum">    1700</span> <span class="tlaGNC">          13 :   int status = ML_ERROR_NONE;</span></span>
<span id="L1701"><span class="lineNum">    1701</span> <span class="tlaGNC">          13 :   char *old_value = NULL;</span></span>
<span id="L1702"><span class="lineNum">    1702</span>              : </span>
<span id="L1703"><span class="lineNum">    1703</span> <span class="tlaGNC">          26 :   check_feature_state (ML_FEATURE_INFERENCE);</span></span>
<span id="L1704"><span class="lineNum">    1704</span>              : </span>
<span id="L1705"><span class="lineNum">    1705</span> <span class="tlaGNC">          13 :   if (!single)</span></span>
<span id="L1706"><span class="lineNum">    1706</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1707"><span class="lineNum">    1707</span>              :         &quot;The parameter, single (ml_single_h), is NULL. It should be a valid instance of ml_single_h, which is usually created by ml_single_open().&quot;);</span>
<span id="L1708"><span class="lineNum">    1708</span> <span class="tlaGNC tlaBgGNC">          13 :   if (!name)</span></span>
<span id="L1709"><span class="lineNum">    1709</span> <span class="tlaGNC">           1 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1710"><span class="lineNum">    1710</span>              :         &quot;The parameter, name (const char *), is NULL. It should be a valid string representing a property key.&quot;);</span>
<span id="L1711"><span class="lineNum">    1711</span>              : </span>
<span id="L1712"><span class="lineNum">    1712</span>              :   /* get old value, also check the property is updatable. */</span>
<span id="L1713"><span class="lineNum">    1713</span> <span class="tlaGNC">          12 :   _ml_error_report_return_continue_iferr</span></span>
<span id="L1714"><span class="lineNum">    1714</span>              :       (ml_single_get_property (single, name, &amp;old_value),</span>
<span id="L1715"><span class="lineNum">    1715</span>              :       &quot;Cannot fetch the previous value for the given property name, '%s'. It appears that the property key, '%s', is invalid (not supported).&quot;,</span>
<span id="L1716"><span class="lineNum">    1716</span>              :       name, name);</span>
<span id="L1717"><span class="lineNum">    1717</span>              : </span>
<span id="L1718"><span class="lineNum">    1718</span>              :   /* if sets same value, do not change. */</span>
<span id="L1719"><span class="lineNum">    1719</span> <span class="tlaGNC">          11 :   if (old_value &amp;&amp; value &amp;&amp; g_ascii_strcasecmp (old_value, value) == 0) {</span></span>
<span id="L1720"><span class="lineNum">    1720</span> <span class="tlaGNC">           1 :     g_free (old_value);</span></span>
<span id="L1721"><span class="lineNum">    1721</span> <span class="tlaGNC">           1 :     return ML_ERROR_NONE;</span></span>
<span id="L1722"><span class="lineNum">    1722</span>              :   }</span>
<span id="L1723"><span class="lineNum">    1723</span>              : </span>
<span id="L1724"><span class="lineNum">    1724</span> <span class="tlaGNC">          10 :   ML_SINGLE_GET_VALID_HANDLE_LOCKED (single_h, single, 0);</span></span>
<span id="L1725"><span class="lineNum">    1725</span>              : </span>
<span id="L1726"><span class="lineNum">    1726</span>              :   /* update property */</span>
<span id="L1727"><span class="lineNum">    1727</span> <span class="tlaGNC">          10 :   if (g_str_equal (name, &quot;is-updatable&quot;)) {</span></span>
<span id="L1728"><span class="lineNum">    1728</span> <span class="tlaGNC">           2 :     if (!value)</span></span>
<span id="L1729"><span class="lineNum">    1729</span> <span class="tlaUNC tlaBgUNC">           0 :       goto error;</span></span>
<span id="L1730"><span class="lineNum">    1730</span>              : </span>
<span id="L1731"><span class="lineNum">    1731</span>              :     /* boolean */</span>
<span id="L1732"><span class="lineNum">    1732</span> <span class="tlaGNC tlaBgGNC">           2 :     if (g_ascii_strcasecmp (value, &quot;true&quot;) == 0) {</span></span>
<span id="L1733"><span class="lineNum">    1733</span> <span class="tlaGNC">           1 :       if (g_ascii_strcasecmp (old_value, &quot;true&quot;) != 0)</span></span>
<span id="L1734"><span class="lineNum">    1734</span> <span class="tlaGNC">           1 :         g_object_set (G_OBJECT (single_h-&gt;filter), name, (gboolean) TRUE, NULL);</span></span>
<span id="L1735"><span class="lineNum">    1735</span> <span class="tlaGNC">           1 :     } else if (g_ascii_strcasecmp (value, &quot;false&quot;) == 0) {</span></span>
<span id="L1736"><span class="lineNum">    1736</span> <span class="tlaGNC">           1 :       if (g_ascii_strcasecmp (old_value, &quot;false&quot;) != 0)</span></span>
<span id="L1737"><span class="lineNum">    1737</span> <span class="tlaGNC">           1 :         g_object_set (G_OBJECT (single_h-&gt;filter), name, (gboolean) FALSE,</span></span>
<span id="L1738"><span class="lineNum">    1738</span>              :             NULL);</span>
<span id="L1739"><span class="lineNum">    1739</span>              :     } else {</span>
<span id="L1740"><span class="lineNum">    1740</span> <span class="tlaUNC tlaBgUNC">           0 :       _ml_error_report</span></span>
<span id="L1741"><span class="lineNum">    1741</span>              :           (&quot;The property value, '%s', is not appropriate for a boolean property 'is-updatable'. It should be either 'true' or 'false'.&quot;,</span>
<span id="L1742"><span class="lineNum">    1742</span>              :           value);</span>
<span id="L1743"><span class="lineNum">    1743</span> <span class="tlaUNC">           0 :       status = ML_ERROR_INVALID_PARAMETER;</span></span>
<span id="L1744"><span class="lineNum">    1744</span>              :     }</span>
<span id="L1745"><span class="lineNum">    1745</span> <span class="tlaGNC tlaBgGNC">           8 :   } else if (g_str_equal (name, &quot;input&quot;) || g_str_equal (name, &quot;inputtype&quot;)</span></span>
<span id="L1746"><span class="lineNum">    1746</span> <span class="tlaUNC tlaBgUNC">           0 :       || g_str_equal (name, &quot;inputname&quot;) || g_str_equal (name, &quot;output&quot;)</span></span>
<span id="L1747"><span class="lineNum">    1747</span> <span class="tlaGNC tlaBgGNC">           7 :       || g_str_equal (name, &quot;outputtype&quot;) || g_str_equal (name, &quot;outputname&quot;)) {</span></span>
<span id="L1748"><span class="lineNum">    1748</span>              :     GstTensorsInfo gst_info;</span>
<span id="L1749"><span class="lineNum">    1749</span> <span class="tlaGNC">           8 :     gboolean is_input = g_str_has_prefix (name, &quot;input&quot;);</span></span>
<span id="L1750"><span class="lineNum">    1750</span>              :     guint num;</span>
<span id="L1751"><span class="lineNum">    1751</span>              : </span>
<span id="L1752"><span class="lineNum">    1752</span> <span class="tlaGNC">           8 :     if (!value)</span></span>
<span id="L1753"><span class="lineNum">    1753</span> <span class="tlaGNC">           1 :       goto error;</span></span>
<span id="L1754"><span class="lineNum">    1754</span>              : </span>
<span id="L1755"><span class="lineNum">    1755</span> <span class="tlaGNC">           7 :     ml_single_get_gst_info (single_h, is_input, &amp;gst_info);</span></span>
<span id="L1756"><span class="lineNum">    1756</span>              : </span>
<span id="L1757"><span class="lineNum">    1757</span> <span class="tlaGNC">           7 :     if (g_str_has_suffix (name, &quot;type&quot;))</span></span>
<span id="L1758"><span class="lineNum">    1758</span> <span class="tlaUNC tlaBgUNC">           0 :       num = gst_tensors_info_parse_types_string (&amp;gst_info, value);</span></span>
<span id="L1759"><span class="lineNum">    1759</span> <span class="tlaGNC tlaBgGNC">           7 :     else if (g_str_has_suffix (name, &quot;name&quot;))</span></span>
<span id="L1760"><span class="lineNum">    1760</span> <span class="tlaUNC tlaBgUNC">           0 :       num = gst_tensors_info_parse_names_string (&amp;gst_info, value);</span></span>
<span id="L1761"><span class="lineNum">    1761</span>              :     else</span>
<span id="L1762"><span class="lineNum">    1762</span> <span class="tlaGNC tlaBgGNC">           7 :       num = gst_tensors_info_parse_dimensions_string (&amp;gst_info, value);</span></span>
<span id="L1763"><span class="lineNum">    1763</span>              : </span>
<span id="L1764"><span class="lineNum">    1764</span> <span class="tlaGNC">           7 :     if (num == gst_info.num_tensors) {</span></span>
<span id="L1765"><span class="lineNum">    1765</span>              :       /* change configuration */</span>
<span id="L1766"><span class="lineNum">    1766</span> <span class="tlaGNC">           7 :       status = ml_single_set_gst_info (single_h, &amp;gst_info);</span></span>
<span id="L1767"><span class="lineNum">    1767</span>              :     } else {</span>
<span id="L1768"><span class="lineNum">    1768</span> <span class="tlaUNC tlaBgUNC">           0 :       _ml_error_report</span></span>
<span id="L1769"><span class="lineNum">    1769</span>              :           (&quot;The property value, '%s', is not appropriate for the given property key, '%s'. The API has failed to parse the given property value.&quot;,</span>
<span id="L1770"><span class="lineNum">    1770</span>              :           value, name);</span>
<span id="L1771"><span class="lineNum">    1771</span> <span class="tlaUNC">           0 :       status = ML_ERROR_INVALID_PARAMETER;</span></span>
<span id="L1772"><span class="lineNum">    1772</span>              :     }</span>
<span id="L1773"><span class="lineNum">    1773</span>              : </span>
<span id="L1774"><span class="lineNum">    1774</span> <span class="tlaGNC tlaBgGNC">           7 :     gst_tensors_info_free (&amp;gst_info);</span></span>
<span id="L1775"><span class="lineNum">    1775</span>              :   } else {</span>
<span id="L1776"><span class="lineNum">    1776</span> <span class="tlaUNC tlaBgUNC">           0 :     g_object_set (G_OBJECT (single_h-&gt;filter), name, value, NULL);</span></span>
<span id="L1777"><span class="lineNum">    1777</span>              :   }</span>
<span id="L1778"><span class="lineNum">    1778</span> <span class="tlaGNC tlaBgGNC">           9 :   goto done;</span></span>
<span id="L1779"><span class="lineNum">    1779</span> <span class="tlaGNC">           1 : error:</span></span>
<span id="L1780"><span class="lineNum">    1780</span> <span class="tlaGNC">           1 :   _ml_error_report</span></span>
<span id="L1781"><span class="lineNum">    1781</span>              :       (&quot;The parameter, value (const char *), is NULL. It should be a valid string representing the value to be set for the given property key, '%s'&quot;,</span>
<span id="L1782"><span class="lineNum">    1782</span>              :       name);</span>
<span id="L1783"><span class="lineNum">    1783</span> <span class="tlaGNC">           1 :   status = ML_ERROR_INVALID_PARAMETER;</span></span>
<span id="L1784"><span class="lineNum">    1784</span> <span class="tlaGNC">          10 : done:</span></span>
<span id="L1785"><span class="lineNum">    1785</span> <span class="tlaGNC">          10 :   ML_SINGLE_HANDLE_UNLOCK (single_h);</span></span>
<span id="L1786"><span class="lineNum">    1786</span>              : </span>
<span id="L1787"><span class="lineNum">    1787</span> <span class="tlaGNC">          10 :   g_free (old_value);</span></span>
<span id="L1788"><span class="lineNum">    1788</span> <span class="tlaGNC">          10 :   return status;</span></span>
<span id="L1789"><span class="lineNum">    1789</span>              : }</span>
<span id="L1790"><span class="lineNum">    1790</span>              : </span>
<span id="L1791"><span class="lineNum">    1791</span>              : /**</span>
<span id="L1792"><span class="lineNum">    1792</span>              :  * @brief Gets the property value for the given model.</span>
<span id="L1793"><span class="lineNum">    1793</span>              :  */</span>
<span id="L1794"><span class="lineNum">    1794</span>              : int</span>
<span id="L1795"><span class="lineNum">    1795</span> <span class="tlaGNC">          27 : ml_single_get_property (ml_single_h single, const char *name, char **value)</span></span>
<span id="L1796"><span class="lineNum">    1796</span>              : {</span>
<span id="L1797"><span class="lineNum">    1797</span>              :   ml_single *single_h;</span>
<span id="L1798"><span class="lineNum">    1798</span> <span class="tlaGNC">          27 :   int status = ML_ERROR_NONE;</span></span>
<span id="L1799"><span class="lineNum">    1799</span>              : </span>
<span id="L1800"><span class="lineNum">    1800</span> <span class="tlaGNC">          27 :   check_feature_state (ML_FEATURE_INFERENCE);</span></span>
<span id="L1801"><span class="lineNum">    1801</span>              : </span>
<span id="L1802"><span class="lineNum">    1802</span> <span class="tlaGNC">          27 :   if (!single)</span></span>
<span id="L1803"><span class="lineNum">    1803</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1804"><span class="lineNum">    1804</span>              :         &quot;The parameter, single (ml_single_h), is NULL. It should be a valid instance of ml_single_h, which is usually created by ml_single_open().&quot;);</span>
<span id="L1805"><span class="lineNum">    1805</span> <span class="tlaGNC tlaBgGNC">          27 :   if (!name)</span></span>
<span id="L1806"><span class="lineNum">    1806</span> <span class="tlaGNC">           1 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1807"><span class="lineNum">    1807</span>              :         &quot;The parameter, name (const char *), is NULL. It should be a valid string representing a property key.&quot;);</span>
<span id="L1808"><span class="lineNum">    1808</span> <span class="tlaGNC">          26 :   if (!value)</span></span>
<span id="L1809"><span class="lineNum">    1809</span> <span class="tlaGNC">           1 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1810"><span class="lineNum">    1810</span>              :         &quot;The parameter, value (const char *), is NULL. It should be a valid string representing the value to be set for the given property key, '%s'&quot;,</span>
<span id="L1811"><span class="lineNum">    1811</span>              :         name);</span>
<span id="L1812"><span class="lineNum">    1812</span>              : </span>
<span id="L1813"><span class="lineNum">    1813</span>              :   /* init null */</span>
<span id="L1814"><span class="lineNum">    1814</span> <span class="tlaGNC">          25 :   *value = NULL;</span></span>
<span id="L1815"><span class="lineNum">    1815</span>              : </span>
<span id="L1816"><span class="lineNum">    1816</span> <span class="tlaGNC">          25 :   ML_SINGLE_GET_VALID_HANDLE_LOCKED (single_h, single, 0);</span></span>
<span id="L1817"><span class="lineNum">    1817</span>              : </span>
<span id="L1818"><span class="lineNum">    1818</span> <span class="tlaGNC">          25 :   if (g_str_equal (name, &quot;input&quot;) || g_str_equal (name, &quot;output&quot;) ||</span></span>
<span id="L1819"><span class="lineNum">    1819</span> <span class="tlaGNC">           8 :       g_str_equal (name, &quot;inputtype&quot;) || g_str_equal (name, &quot;inputname&quot;) ||</span></span>
<span id="L1820"><span class="lineNum">    1820</span> <span class="tlaGNC">           8 :       g_str_equal (name, &quot;inputlayout&quot;) || g_str_equal (name, &quot;outputtype&quot;) ||</span></span>
<span id="L1821"><span class="lineNum">    1821</span> <span class="tlaGNC">           7 :       g_str_equal (name, &quot;outputname&quot;) || g_str_equal (name, &quot;outputlayout&quot;) ||</span></span>
<span id="L1822"><span class="lineNum">    1822</span> <span class="tlaGNC">           7 :       g_str_equal (name, &quot;accelerator&quot;) || g_str_equal (name, &quot;custom&quot;)) {</span></span>
<span id="L1823"><span class="lineNum">    1823</span>              :     /* string */</span>
<span id="L1824"><span class="lineNum">    1824</span> <span class="tlaGNC">          18 :     g_object_get (G_OBJECT (single_h-&gt;filter), name, value, NULL);</span></span>
<span id="L1825"><span class="lineNum">    1825</span> <span class="tlaGNC">           7 :   } else if (g_str_equal (name, &quot;is-updatable&quot;)) {</span></span>
<span id="L1826"><span class="lineNum">    1826</span> <span class="tlaGNC">           5 :     gboolean bool_value = FALSE;</span></span>
<span id="L1827"><span class="lineNum">    1827</span>              : </span>
<span id="L1828"><span class="lineNum">    1828</span>              :     /* boolean */</span>
<span id="L1829"><span class="lineNum">    1829</span> <span class="tlaGNC">           5 :     g_object_get (G_OBJECT (single_h-&gt;filter), name, &amp;bool_value, NULL);</span></span>
<span id="L1830"><span class="lineNum">    1830</span> <span class="tlaGNC">          10 :     *value = (bool_value) ? g_strdup (&quot;true&quot;) : g_strdup (&quot;false&quot;);</span></span>
<span id="L1831"><span class="lineNum">    1831</span>              :   } else {</span>
<span id="L1832"><span class="lineNum">    1832</span> <span class="tlaGNC">           2 :     _ml_error_report</span></span>
<span id="L1833"><span class="lineNum">    1833</span>              :         (&quot;The property key, '%s', is not available for get_property and not recognized by the API. It should be one of {input, inputtype, inputname, inputlayout, output, outputtype, outputname, outputlayout, accelerator, custom, is-updatable}.&quot;,</span>
<span id="L1834"><span class="lineNum">    1834</span>              :         name);</span>
<span id="L1835"><span class="lineNum">    1835</span> <span class="tlaGNC">           2 :     status = ML_ERROR_NOT_SUPPORTED;</span></span>
<span id="L1836"><span class="lineNum">    1836</span>              :   }</span>
<span id="L1837"><span class="lineNum">    1837</span>              : </span>
<span id="L1838"><span class="lineNum">    1838</span> <span class="tlaGNC">          25 :   ML_SINGLE_HANDLE_UNLOCK (single_h);</span></span>
<span id="L1839"><span class="lineNum">    1839</span> <span class="tlaGNC">          25 :   return status;</span></span>
<span id="L1840"><span class="lineNum">    1840</span>              : }</span>
<span id="L1841"><span class="lineNum">    1841</span>              : </span>
<span id="L1842"><span class="lineNum">    1842</span>              : /**</span>
<span id="L1843"><span class="lineNum">    1843</span>              :  * @brief Internal helper function to validate model files.</span>
<span id="L1844"><span class="lineNum">    1844</span>              :  */</span>
<span id="L1845"><span class="lineNum">    1845</span>              : static int</span>
<span id="L1846"><span class="lineNum">    1846</span> <span class="tlaGNC">          90 : __ml_validate_model_file (const char *const *model,</span></span>
<span id="L1847"><span class="lineNum">    1847</span>              :     const unsigned int num_models, gboolean * is_dir)</span>
<span id="L1848"><span class="lineNum">    1848</span>              : {</span>
<span id="L1849"><span class="lineNum">    1849</span>              :   guint i;</span>
<span id="L1850"><span class="lineNum">    1850</span>              : </span>
<span id="L1851"><span class="lineNum">    1851</span> <span class="tlaGNC">          90 :   if (!model)</span></span>
<span id="L1852"><span class="lineNum">    1852</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1853"><span class="lineNum">    1853</span>              :         &quot;The parameter, model, is NULL. It should be a valid array of strings, where each string is a valid file path for a neural network model file.&quot;);</span>
<span id="L1854"><span class="lineNum">    1854</span> <span class="tlaGNC tlaBgGNC">          90 :   if (num_models &lt; 1)</span></span>
<span id="L1855"><span class="lineNum">    1855</span> <span class="tlaUNC tlaBgUNC">           0 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1856"><span class="lineNum">    1856</span>              :         &quot;The parameter, num_models, is 0. It should be the number of files for the given neural network model.&quot;);</span>
<span id="L1857"><span class="lineNum">    1857</span>              : </span>
<span id="L1858"><span class="lineNum">    1858</span> <span class="tlaGNC tlaBgGNC">          90 :   if (g_file_test (model[0], G_FILE_TEST_IS_DIR)) {</span></span>
<span id="L1859"><span class="lineNum">    1859</span> <span class="tlaGNC">           4 :     *is_dir = TRUE;</span></span>
<span id="L1860"><span class="lineNum">    1860</span> <span class="tlaGNC">           4 :     return ML_ERROR_NONE;</span></span>
<span id="L1861"><span class="lineNum">    1861</span>              :   }</span>
<span id="L1862"><span class="lineNum">    1862</span>              : </span>
<span id="L1863"><span class="lineNum">    1863</span> <span class="tlaGNC">         169 :   for (i = 0; i &lt; num_models; i++) {</span></span>
<span id="L1864"><span class="lineNum">    1864</span> <span class="tlaGNC">          86 :     if (!model[i] ||</span></span>
<span id="L1865"><span class="lineNum">    1865</span> <span class="tlaGNC">          86 :         !g_file_test (model[i], G_FILE_TEST_EXISTS | G_FILE_TEST_IS_REGULAR)) {</span></span>
<span id="L1866"><span class="lineNum">    1866</span> <span class="tlaGNC">           3 :       _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1867"><span class="lineNum">    1867</span>              :           &quot;The given param, model path [%d] = \&quot;%s\&quot; is invalid or the file is not found or accessible.&quot;,</span>
<span id="L1868"><span class="lineNum">    1868</span>              :           i, _STR_NULL (model[i]));</span>
<span id="L1869"><span class="lineNum">    1869</span>              :     }</span>
<span id="L1870"><span class="lineNum">    1870</span>              :   }</span>
<span id="L1871"><span class="lineNum">    1871</span>              : </span>
<span id="L1872"><span class="lineNum">    1872</span> <span class="tlaGNC">          83 :   *is_dir = FALSE;</span></span>
<span id="L1873"><span class="lineNum">    1873</span>              : </span>
<span id="L1874"><span class="lineNum">    1874</span> <span class="tlaGNC">          83 :   return ML_ERROR_NONE;</span></span>
<span id="L1875"><span class="lineNum">    1875</span>              : }</span>
<span id="L1876"><span class="lineNum">    1876</span>              : </span>
<span id="L1877"><span class="lineNum">    1877</span>              : /**</span>
<span id="L1878"><span class="lineNum">    1878</span>              :  * @brief Validates the nnfw model file.</span>
<span id="L1879"><span class="lineNum">    1879</span>              :  * @since_tizen 5.5</span>
<span id="L1880"><span class="lineNum">    1880</span>              :  * @param[in] model The path of model file.</span>
<span id="L1881"><span class="lineNum">    1881</span>              :  * @param[in/out] nnfw The type of NNFW.</span>
<span id="L1882"><span class="lineNum">    1882</span>              :  * @return @c 0 on success. Otherwise a negative error value.</span>
<span id="L1883"><span class="lineNum">    1883</span>              :  * @retval #ML_ERROR_NONE Successful</span>
<span id="L1884"><span class="lineNum">    1884</span>              :  * @retval #ML_ERROR_NOT_SUPPORTED Not supported, or framework to support this model file is unavailable in the environment.</span>
<span id="L1885"><span class="lineNum">    1885</span>              :  * @retval #ML_ERROR_INVALID_PARAMETER Given parameter is invalid.</span>
<span id="L1886"><span class="lineNum">    1886</span>              :  */</span>
<span id="L1887"><span class="lineNum">    1887</span>              : int</span>
<span id="L1888"><span class="lineNum">    1888</span> <span class="tlaGNC">          90 : _ml_validate_model_file (const char *const *model,</span></span>
<span id="L1889"><span class="lineNum">    1889</span>              :     const unsigned int num_models, ml_nnfw_type_e * nnfw)</span>
<span id="L1890"><span class="lineNum">    1890</span>              : {</span>
<span id="L1891"><span class="lineNum">    1891</span> <span class="tlaGNC">          90 :   int status = ML_ERROR_NONE;</span></span>
<span id="L1892"><span class="lineNum">    1892</span> <span class="tlaGNC">          90 :   ml_nnfw_type_e detected = ML_NNFW_TYPE_ANY;</span></span>
<span id="L1893"><span class="lineNum">    1893</span> <span class="tlaGNC">          90 :   gboolean is_dir = FALSE;</span></span>
<span id="L1894"><span class="lineNum">    1894</span>              :   gchar *pos, *fw_name;</span>
<span id="L1895"><span class="lineNum">    1895</span> <span class="tlaGNC">          90 :   gchar **file_ext = NULL;</span></span>
<span id="L1896"><span class="lineNum">    1896</span>              :   guint i;</span>
<span id="L1897"><span class="lineNum">    1897</span>              : </span>
<span id="L1898"><span class="lineNum">    1898</span> <span class="tlaGNC">          90 :   if (!nnfw)</span></span>
<span id="L1899"><span class="lineNum">    1899</span> <span class="tlaGNC">          90 :     _ml_error_report_return (ML_ERROR_INVALID_PARAMETER,</span></span>
<span id="L1900"><span class="lineNum">    1900</span>              :         &quot;The parameter, nnfw, is NULL. It should be a valid pointer of ml_nnfw_type_e.&quot;);</span>
<span id="L1901"><span class="lineNum">    1901</span>              : </span>
<span id="L1902"><span class="lineNum">    1902</span> <span class="tlaGNC">          90 :   _ml_error_report_return_continue_iferr (__ml_validate_model_file (model,</span></span>
<span id="L1903"><span class="lineNum">    1903</span>              :           num_models, &amp;is_dir),</span>
<span id="L1904"><span class="lineNum">    1904</span>              :       &quot;The parameters, model and num_models, are not valid.&quot;);</span>
<span id="L1905"><span class="lineNum">    1905</span>              : </span>
<span id="L1906"><span class="lineNum">    1906</span>              :   /**</span>
<span id="L1907"><span class="lineNum">    1907</span>              :    * @note detect-fw checks the file ext and returns proper fw name for given models.</span>
<span id="L1908"><span class="lineNum">    1908</span>              :    * If detected fw and given nnfw are same, we don't need to check the file extension.</span>
<span id="L1909"><span class="lineNum">    1909</span>              :    * If any condition for auto detection is added later, below code also should be updated.</span>
<span id="L1910"><span class="lineNum">    1910</span>              :    */</span>
<span id="L1911"><span class="lineNum">    1911</span> <span class="tlaGNC">          87 :   fw_name = gst_tensor_filter_detect_framework (model, num_models, TRUE);</span></span>
<span id="L1912"><span class="lineNum">    1912</span> <span class="tlaGNC">          87 :   detected = _ml_get_nnfw_type_by_subplugin_name (fw_name);</span></span>
<span id="L1913"><span class="lineNum">    1913</span> <span class="tlaGNC">          87 :   g_free (fw_name);</span></span>
<span id="L1914"><span class="lineNum">    1914</span>              : </span>
<span id="L1915"><span class="lineNum">    1915</span> <span class="tlaGNC">          87 :   if (*nnfw == ML_NNFW_TYPE_ANY) {</span></span>
<span id="L1916"><span class="lineNum">    1916</span> <span class="tlaGNC">          37 :     if (detected == ML_NNFW_TYPE_ANY) {</span></span>
<span id="L1917"><span class="lineNum">    1917</span> <span class="tlaUNC tlaBgUNC">           0 :       _ml_error_report</span></span>
<span id="L1918"><span class="lineNum">    1918</span>              :           (&quot;The given neural network model (1st path is \&quot;%s\&quot;, and there are %d paths declared) has unknown or unsupported extension. Please check its corresponding neural network framework and try to specify it instead of \&quot;ML_NNFW_TYPE_ANY\&quot;.&quot;,</span>
<span id="L1919"><span class="lineNum">    1919</span>              :           model[0], num_models);</span>
<span id="L1920"><span class="lineNum">    1920</span> <span class="tlaUNC">           0 :       status = ML_ERROR_INVALID_PARAMETER;</span></span>
<span id="L1921"><span class="lineNum">    1921</span>              :     } else {</span>
<span id="L1922"><span class="lineNum">    1922</span> <span class="tlaGNC tlaBgGNC">          37 :       _ml_logi (&quot;The given model is supposed a %s model.&quot;,</span></span>
<span id="L1923"><span class="lineNum">    1923</span>              :           _ml_get_nnfw_subplugin_name (detected));</span>
<span id="L1924"><span class="lineNum">    1924</span> <span class="tlaGNC">          37 :       *nnfw = detected;</span></span>
<span id="L1925"><span class="lineNum">    1925</span>              :     }</span>
<span id="L1926"><span class="lineNum">    1926</span>              : </span>
<span id="L1927"><span class="lineNum">    1927</span> <span class="tlaGNC">          37 :     goto done;</span></span>
<span id="L1928"><span class="lineNum">    1928</span> <span class="tlaGNC">          50 :   } else if (is_dir &amp;&amp; *nnfw != ML_NNFW_TYPE_NNFW) {</span></span>
<span id="L1929"><span class="lineNum">    1929</span>              :     /* supposed it is ONE if given model is directory */</span>
<span id="L1930"><span class="lineNum">    1930</span> <span class="tlaGNC">           2 :     _ml_error_report</span></span>
<span id="L1931"><span class="lineNum">    1931</span>              :         (&quot;The given model (1st path is \&quot;%s\&quot;, and there are %d paths declared) is directory, which is allowed by \&quot;NNFW (One Runtime)\&quot; only, Please check the model and framework.&quot;,</span>
<span id="L1932"><span class="lineNum">    1932</span>              :         model[0], num_models);</span>
<span id="L1933"><span class="lineNum">    1933</span> <span class="tlaGNC">           2 :     status = ML_ERROR_INVALID_PARAMETER;</span></span>
<span id="L1934"><span class="lineNum">    1934</span> <span class="tlaGNC">           2 :     goto done;</span></span>
<span id="L1935"><span class="lineNum">    1935</span> <span class="tlaGNC">          48 :   } else if (detected == *nnfw) {</span></span>
<span id="L1936"><span class="lineNum">    1936</span>              :     /* Expected framework, nothing to do. */</span>
<span id="L1937"><span class="lineNum">    1937</span> <span class="tlaGNC">          43 :     goto done;</span></span>
<span id="L1938"><span class="lineNum">    1938</span>              :   }</span>
<span id="L1939"><span class="lineNum">    1939</span>              : </span>
<span id="L1940"><span class="lineNum">    1940</span>              :   /* Handle mismatched case, check file extension. */</span>
<span id="L1941"><span class="lineNum">    1941</span> <span class="tlaGNC">           5 :   file_ext = g_malloc0 (sizeof (char *) * (num_models + 1));</span></span>
<span id="L1942"><span class="lineNum">    1942</span> <span class="tlaGNC">          10 :   for (i = 0; i &lt; num_models; i++) {</span></span>
<span id="L1943"><span class="lineNum">    1943</span> <span class="tlaGNC">           5 :     if ((pos = strrchr (model[i], '.')) == NULL) {</span></span>
<span id="L1944"><span class="lineNum">    1944</span> <span class="tlaUNC tlaBgUNC">           0 :       _ml_error_report (&quot;The given model [%d]=\&quot;%s\&quot; has invalid extension.&quot;, i,</span></span>
<span id="L1945"><span class="lineNum">    1945</span>              :           model[i]);</span>
<span id="L1946"><span class="lineNum">    1946</span> <span class="tlaUNC">           0 :       status = ML_ERROR_INVALID_PARAMETER;</span></span>
<span id="L1947"><span class="lineNum">    1947</span> <span class="tlaUNC">           0 :       goto done;</span></span>
<span id="L1948"><span class="lineNum">    1948</span>              :     }</span>
<span id="L1949"><span class="lineNum">    1949</span>              : </span>
<span id="L1950"><span class="lineNum">    1950</span> <span class="tlaGNC tlaBgGNC">           5 :     file_ext[i] = g_ascii_strdown (pos, -1);</span></span>
<span id="L1951"><span class="lineNum">    1951</span>              :   }</span>
<span id="L1952"><span class="lineNum">    1952</span>              : </span>
<span id="L1953"><span class="lineNum">    1953</span>              :   /** @todo Make sure num_models is correct for each nnfw type */</span>
<span id="L1954"><span class="lineNum">    1954</span> <span class="tlaGNC">           5 :   switch (*nnfw) {</span></span>
<span id="L1955"><span class="lineNum">    1955</span> <span class="tlaGNC">           4 :     case ML_NNFW_TYPE_NNFW:</span></span>
<span id="L1956"><span class="lineNum">    1956</span>              :     case ML_NNFW_TYPE_TVM:</span>
<span id="L1957"><span class="lineNum">    1957</span>              :     case ML_NNFW_TYPE_ONNX_RUNTIME:</span>
<span id="L1958"><span class="lineNum">    1958</span>              :     case ML_NNFW_TYPE_NCNN:</span>
<span id="L1959"><span class="lineNum">    1959</span>              :     case ML_NNFW_TYPE_TENSORRT:</span>
<span id="L1960"><span class="lineNum">    1960</span>              :     case ML_NNFW_TYPE_QNN:</span>
<span id="L1961"><span class="lineNum">    1961</span>              :       /**</span>
<span id="L1962"><span class="lineNum">    1962</span>              :        * We cannot check the file ext with NNFW.</span>
<span id="L1963"><span class="lineNum">    1963</span>              :        * NNFW itself will validate metadata and model file.</span>
<span id="L1964"><span class="lineNum">    1964</span>              :        */</span>
<span id="L1965"><span class="lineNum">    1965</span> <span class="tlaGNC">           4 :       break;</span></span>
<span id="L1966"><span class="lineNum">    1966</span> <span class="tlaUNC tlaBgUNC">           0 :     case ML_NNFW_TYPE_MVNC:</span></span>
<span id="L1967"><span class="lineNum">    1967</span>              :     case ML_NNFW_TYPE_OPENVINO:</span>
<span id="L1968"><span class="lineNum">    1968</span>              :     case ML_NNFW_TYPE_EDGE_TPU:</span>
<span id="L1969"><span class="lineNum">    1969</span>              :       /**</span>
<span id="L1970"><span class="lineNum">    1970</span>              :        * @todo Need to check method to validate model</span>
<span id="L1971"><span class="lineNum">    1971</span>              :        * Although nnstreamer supports these frameworks,</span>
<span id="L1972"><span class="lineNum">    1972</span>              :        * ML-API implementation is not ready.</span>
<span id="L1973"><span class="lineNum">    1973</span>              :        */</span>
<span id="L1974"><span class="lineNum">    1974</span> <span class="tlaUNC">           0 :       _ml_error_report</span></span>
<span id="L1975"><span class="lineNum">    1975</span>              :           (&quot;Given NNFW is not supported by ML-API Inference.Single, yet, although it is supported by NNStreamer. If you have such NNFW integrated into your machine and want to access via ML-API, please update the corresponding implementation or report and discuss at github.com/nnstreamer/nnstreamer/issues.&quot;);</span>
<span id="L1976"><span class="lineNum">    1976</span> <span class="tlaUNC">           0 :       status = ML_ERROR_NOT_SUPPORTED;</span></span>
<span id="L1977"><span class="lineNum">    1977</span> <span class="tlaUNC">           0 :       break;</span></span>
<span id="L1978"><span class="lineNum">    1978</span> <span class="tlaUNC">           0 :     case ML_NNFW_TYPE_VD_AIFW:</span></span>
<span id="L1979"><span class="lineNum">    1979</span> <span class="tlaUNC">           0 :       if (!g_str_equal (file_ext[0], &quot;.nb&quot;) &amp;&amp;</span></span>
<span id="L1980"><span class="lineNum">    1980</span> <span class="tlaUNC">           0 :           !g_str_equal (file_ext[0], &quot;.ncp&quot;) &amp;&amp;</span></span>
<span id="L1981"><span class="lineNum">    1981</span> <span class="tlaUNC">           0 :           !g_str_equal (file_ext[0], &quot;.tvn&quot;) &amp;&amp;</span></span>
<span id="L1982"><span class="lineNum">    1982</span> <span class="tlaUNC">           0 :           !g_str_equal (file_ext[0], &quot;.bin&quot;)) {</span></span>
<span id="L1983"><span class="lineNum">    1983</span> <span class="tlaUNC">           0 :         status = ML_ERROR_INVALID_PARAMETER;</span></span>
<span id="L1984"><span class="lineNum">    1984</span>              :       }</span>
<span id="L1985"><span class="lineNum">    1985</span> <span class="tlaUNC">           0 :       break;</span></span>
<span id="L1986"><span class="lineNum">    1986</span> <span class="tlaUNC">           0 :     case ML_NNFW_TYPE_SNAP:</span></span>
<span id="L1987"><span class="lineNum">    1987</span>              : #if !defined (__ANDROID__)</span>
<span id="L1988"><span class="lineNum">    1988</span> <span class="tlaUNC">           0 :       _ml_error_report (&quot;SNAP is supported by Android/arm64-v8a devices only.&quot;);</span></span>
<span id="L1989"><span class="lineNum">    1989</span> <span class="tlaUNC">           0 :       status = ML_ERROR_NOT_SUPPORTED;</span></span>
<span id="L1990"><span class="lineNum">    1990</span>              : #endif</span>
<span id="L1991"><span class="lineNum">    1991</span>              :       /* SNAP requires multiple files, set supported if model file exists. */</span>
<span id="L1992"><span class="lineNum">    1992</span> <span class="tlaUNC">           0 :       break;</span></span>
<span id="L1993"><span class="lineNum">    1993</span> <span class="tlaUNC">           0 :     case ML_NNFW_TYPE_ARMNN:</span></span>
<span id="L1994"><span class="lineNum">    1994</span> <span class="tlaUNC">           0 :       if (!g_str_equal (file_ext[0], &quot;.caffemodel&quot;) &amp;&amp;</span></span>
<span id="L1995"><span class="lineNum">    1995</span> <span class="tlaUNC">           0 :           !g_str_equal (file_ext[0], &quot;.tflite&quot;) &amp;&amp;</span></span>
<span id="L1996"><span class="lineNum">    1996</span> <span class="tlaUNC">           0 :           !g_str_equal (file_ext[0], &quot;.pb&quot;) &amp;&amp;</span></span>
<span id="L1997"><span class="lineNum">    1997</span> <span class="tlaUNC">           0 :           !g_str_equal (file_ext[0], &quot;.prototxt&quot;)) {</span></span>
<span id="L1998"><span class="lineNum">    1998</span> <span class="tlaUNC">           0 :         _ml_error_report</span></span>
<span id="L1999"><span class="lineNum">    1999</span>              :             (&quot;ARMNN accepts .caffemodel, .tflite, .pb, and .prototxt files only. Please support correct file extension. You have specified: \&quot;%s\&quot;&quot;,</span>
<span id="L2000"><span class="lineNum">    2000</span>              :             file_ext[0]);</span>
<span id="L2001"><span class="lineNum">    2001</span> <span class="tlaUNC">           0 :         status = ML_ERROR_INVALID_PARAMETER;</span></span>
<span id="L2002"><span class="lineNum">    2002</span>              :       }</span>
<span id="L2003"><span class="lineNum">    2003</span> <span class="tlaUNC">           0 :       break;</span></span>
<span id="L2004"><span class="lineNum">    2004</span> <span class="tlaUNC">           0 :     case ML_NNFW_TYPE_MXNET:</span></span>
<span id="L2005"><span class="lineNum">    2005</span> <span class="tlaUNC">           0 :       if (!g_str_equal (file_ext[0], &quot;.params&quot;) &amp;&amp;</span></span>
<span id="L2006"><span class="lineNum">    2006</span> <span class="tlaUNC">           0 :           !g_str_equal (file_ext[0], &quot;.json&quot;)) {</span></span>
<span id="L2007"><span class="lineNum">    2007</span> <span class="tlaUNC">           0 :         status = ML_ERROR_INVALID_PARAMETER;</span></span>
<span id="L2008"><span class="lineNum">    2008</span>              :       }</span>
<span id="L2009"><span class="lineNum">    2009</span> <span class="tlaUNC">           0 :       break;</span></span>
<span id="L2010"><span class="lineNum">    2010</span> <span class="tlaGNC tlaBgGNC">           1 :     default:</span></span>
<span id="L2011"><span class="lineNum">    2011</span> <span class="tlaGNC">           1 :       _ml_error_report</span></span>
<span id="L2012"><span class="lineNum">    2012</span>              :           (&quot;You have designated an incorrect neural network framework (out of bound).&quot;);</span>
<span id="L2013"><span class="lineNum">    2013</span> <span class="tlaGNC">           1 :       status = ML_ERROR_INVALID_PARAMETER;</span></span>
<span id="L2014"><span class="lineNum">    2014</span> <span class="tlaGNC">           1 :       break;</span></span>
<span id="L2015"><span class="lineNum">    2015</span>              :   }</span>
<span id="L2016"><span class="lineNum">    2016</span>              : </span>
<span id="L2017"><span class="lineNum">    2017</span> <span class="tlaGNC">          87 : done:</span></span>
<span id="L2018"><span class="lineNum">    2018</span> <span class="tlaGNC">          87 :   if (status == ML_ERROR_NONE) {</span></span>
<span id="L2019"><span class="lineNum">    2019</span> <span class="tlaGNC">          84 :     if (!_ml_nnfw_is_available (*nnfw, ML_NNFW_HW_ANY)) {</span></span>
<span id="L2020"><span class="lineNum">    2020</span> <span class="tlaGNC">           1 :       status = ML_ERROR_NOT_SUPPORTED;</span></span>
<span id="L2021"><span class="lineNum">    2021</span> <span class="tlaGNC">           1 :       _ml_error_report</span></span>
<span id="L2022"><span class="lineNum">    2022</span>              :           (&quot;The subplugin for tensor-filter \&quot;%s\&quot; is not available. Please install the corresponding tensor-filter subplugin file (usually, \&quot;libnnstreamer_filter_${NAME}.so\&quot;) at the correct path. Please use \&quot;nnstreamer-check\&quot; utility to check related configurations. If you do not have the utility ready, build and install \&quot;confchk\&quot;, which is located at ${nnstreamer_source}/tools/development/confchk/ .&quot;,</span>
<span id="L2023"><span class="lineNum">    2023</span>              :           _ml_get_nnfw_subplugin_name (*nnfw));</span>
<span id="L2024"><span class="lineNum">    2024</span>              :     }</span>
<span id="L2025"><span class="lineNum">    2025</span>              :   } else {</span>
<span id="L2026"><span class="lineNum">    2026</span> <span class="tlaGNC">           3 :     _ml_error_report</span></span>
<span id="L2027"><span class="lineNum">    2027</span>              :         (&quot;The given model file, \&quot;%s\&quot; (1st of %d files), is invalid.&quot;,</span>
<span id="L2028"><span class="lineNum">    2028</span>              :         model[0], num_models);</span>
<span id="L2029"><span class="lineNum">    2029</span>              :   }</span>
<span id="L2030"><span class="lineNum">    2030</span>              : </span>
<span id="L2031"><span class="lineNum">    2031</span> <span class="tlaGNC">          87 :   g_strfreev (file_ext);</span></span>
<span id="L2032"><span class="lineNum">    2032</span> <span class="tlaGNC">          87 :   return status;</span></span>
<span id="L2033"><span class="lineNum">    2033</span>              : }</span>
        </pre>
              </td>
            </tr>
          </table>
          <br>

          <table width="100%" border=0 cellspacing=0 cellpadding=0>
            <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
            <tr><td class="versionInfo">Generated by: <a href="https://github.com//linux-test-project/lcov" target="_parent">LCOV version 2.0-1</a></td></tr>
          </table>
          <br>

</body>
</html>
